<?xml version="1.0" encoding="UTF-8"?>
<afmXmlView>
	<preferences>
		<viewTitleBar show="false"/>
	</preferences>
	<title translatable="true">Project, Months by Year</title>
	<afmTableGroup type="report" format="table">
		<afmAction name="test" type="render" response="true" state="">
			<title translatable="true">Edit Move</title>
		</afmAction>
		<title translatable="true">Project, Months by Year</title>
		<dataSource>
			<database>
				<tables>
					<table name="afm_cal_dates" role="main"/>
				</tables>
				<fields>
					<field name="cal_date" table="afm_cal_dates"/>
				</fields>
					<restrictions>
          <restriction type="parsed">
            <message name="mssql" translatable="false" />
          </restriction>
        </restrictions> 
			</database>
			<mdx>
				<preferences dimensions="1" format="Table">
					<query>
						<queryParameters>
							<queryParameter name="stateid" type="java.lang.String" value="ABCDEFG"/>
							<queryParameter name="siteid" type="java.lang.String" value="ABCDEFG"/>
							<queryParameter name="cityid" type="java.lang.String" value="ABCDEFG"/>
							<queryParameter name="blid" type="java.lang.String" value="ABCDEFG"/>
							<queryParameter name="dvid" type="java.lang.String" value="ABCDEFG"/>
							<queryParameter name="dpid" type="java.lang.String" value="ABCDEFG"/>
							<queryParameter name="programid" type="java.lang.String" value="ABCDEFG"/>
							<queryParameter name="activitytype" type="java.lang.String" value="ABCDEFG"/>
							<queryParameter name="apprvmgr1" type="java.lang.String" value="ABCDEFG"/>
							<queryParameter name="projectid" type="java.lang.String" value="ABCDEFG"/>
							<queryParameter name="projecttype" type="java.lang.String" value="ABCDEFG"/>
							<queryParameter name="sRestyear" type="java.lang.String" value="1979"/>
							<queryParameter name="sRestmonth" type="java.lang.String" value="01"/>
						</queryParameters>
						<sql dialect="generic">
SELECT  distinct DATEPART( month, cal_date)  as dateformated, 
	(SELECT TOP 1 project_id FROM project
	left outer join bl on bl.bl_id=project.bl_id 
	WHERE 	(DATEPART( month, date_start)  &lt;= DATEPART( month, cal_date) and DATEPART( year, date_start) =#SqlParameter%sRestyear% OR
			DATEPART( year, date_start) &lt; #SqlParameter%sRestyear% ) 
		and ( DATEPART( month, cal_date) &lt;= DATEPART( month, date_end) and DATEPART( year, date_end) = #SqlParameter%sRestyear%  OR
			DATEPART( year, date_end) &gt; #SqlParameter%sRestyear% )
		and (  bl.state_id LIKE #SqlParameter%stateid% OR ( #SqlParameter%stateid% = '%' and bl.state_id IS NULL )  )
		and (  bl.city_id LIKE #SqlParameter%cityid% OR ( #SqlParameter%cityid% = '%' and  bl.city_id  IS NULL )  )
		and (  bl.site_id LIKE #SqlParameter%siteid% OR ( #SqlParameter%siteid% = '%' and  bl.site_id IS NULL )  )
		and (  project.bl_id LIKE #SqlParameter%blid% OR ( #SqlParameter%blid% = '%' and project.bl_id IS NULL )  )
		and (  project.dv_id LIKE #SqlParameter%dvid% OR ( #SqlParameter%dvid% = '%' and project.dv_id IS NULL )  )
		and (  project.dp_id LIKE #SqlParameter%dpid% OR ( #SqlParameter%dpid% = '%' and project.dp_id IS NULL )  )
		and   project.project_id LIKE #SqlParameter%projectid%
		and ( project.project_type LIKE #SqlParameter%projecttype% OR ( #SqlParameter%projecttype% = '%' and project.project_type IS NULL )  )
		and (  project.apprv_mgr1 LIKE #SqlParameter%apprvmgr1% OR ( #SqlParameter%apprvmgr1% = '%' and project.apprv_mgr1 IS NULL )  )
		and EXISTS(SELECT 1 FROM activity_log WHERE activity_log.project_id=project.project_id and ( activity_log.activity_type  LIKE #SqlParameter%activitytype% OR ( #SqlParameter%activitytype% = '%' and activity_log.activity_type IS NULL )  ))
		and (  project.program_id LIKE #SqlParameter%programid% OR ( #SqlParameter%programid% = '%' and project.program_id IS NULL )  )	
	ORDER BY project_id				 				 
	) AS task1,
	(SELECT TOP 1 project_id 
	FROM 	(SELECT  '1' seq,NULL project_id FROM 
		(SELECT count(project_id) countp FROM project
		left outer join bl on bl.bl_id=project.bl_id 
		WHERE 	(DATEPART( month, date_start)  &lt;= DATEPART( month, cal_date) and DATEPART( year, date_start) =#SqlParameter%sRestyear% OR
			DATEPART( year, date_start) &lt; #SqlParameter%sRestyear% ) 
		and ( DATEPART( month, cal_date) &lt;= DATEPART( month, date_end) and DATEPART( year, date_end) = #SqlParameter%sRestyear%  OR
			DATEPART( year, date_end) &gt; #SqlParameter%sRestyear% )
			and (  bl.state_id LIKE #SqlParameter%stateid% OR ( #SqlParameter%stateid% = '%' and bl.state_id IS NULL )  )
			and (  bl.city_id LIKE #SqlParameter%cityid% OR ( #SqlParameter%cityid% = '%' and  bl.city_id  IS NULL )  )
			and (  bl.site_id LIKE #SqlParameter%siteid% OR ( #SqlParameter%siteid% = '%' and  bl.site_id IS NULL )  )
			and (  project.bl_id LIKE #SqlParameter%blid% OR ( #SqlParameter%blid% = '%' and project.bl_id IS NULL )  )
			and (  project.dv_id LIKE #SqlParameter%dvid% OR ( #SqlParameter%dvid% = '%' and project.dv_id IS NULL )  )
			and (  project.dp_id LIKE #SqlParameter%dpid% OR ( #SqlParameter%dpid% = '%' and project.dp_id IS NULL )  )
			and   project.project_id LIKE #SqlParameter%projectid%
			and ( project.project_type LIKE #SqlParameter%projecttype% OR ( #SqlParameter%projecttype% = '%' and project.project_type IS NULL )  )
			and (  project.apprv_mgr1 LIKE #SqlParameter%apprvmgr1% OR ( #SqlParameter%apprvmgr1% = '%' and project.apprv_mgr1 IS NULL )  )
			and EXISTS(SELECT 1 FROM activity_log WHERE activity_log.project_id=project.project_id and ( activity_log.activity_type  LIKE #SqlParameter%activitytype% OR ( #SqlParameter%activitytype% = '%' and activity_log.activity_type IS NULL )  ))
			and (  project.program_id LIKE #SqlParameter%programid% OR ( #SqlParameter%programid% = '%' and project.program_id IS NULL )  ))a
		WHERE countp &lt; 2
		UNION
		SELECT TOP 2 '2' seq,project_id FROM project
		left outer join bl on bl.bl_id=project.bl_id 
		WHERE 	(DATEPART( month, date_start)  &lt;= DATEPART( month, cal_date) and DATEPART( year, date_start) =#SqlParameter%sRestyear% OR
			DATEPART( year, date_start) &lt; #SqlParameter%sRestyear% ) 
		and ( DATEPART( month, cal_date) &lt;= DATEPART( month, date_end) and DATEPART( year, date_end) = #SqlParameter%sRestyear%  OR
			DATEPART( year, date_end) &gt; #SqlParameter%sRestyear% )
			and (  bl.state_id LIKE #SqlParameter%stateid% OR ( #SqlParameter%stateid% = '%' and bl.state_id IS NULL )  )
			and (  bl.city_id LIKE #SqlParameter%cityid% OR ( #SqlParameter%cityid% = '%' and  bl.city_id  IS NULL )  )
			and (  bl.site_id LIKE #SqlParameter%siteid% OR ( #SqlParameter%siteid% = '%' and  bl.site_id IS NULL )  )
			and (  project.bl_id LIKE #SqlParameter%blid% OR ( #SqlParameter%blid% = '%' and project.bl_id IS NULL )  )
			and (  project.dv_id LIKE #SqlParameter%dvid% OR ( #SqlParameter%dvid% = '%' and project.dv_id IS NULL )  )
			and (  project.dp_id LIKE #SqlParameter%dpid% OR ( #SqlParameter%dpid% = '%' and project.dp_id IS NULL )  )
			and   project.project_id LIKE #SqlParameter%projectid%
			and ( project.project_type LIKE #SqlParameter%projecttype% OR ( #SqlParameter%projecttype% = '%' and project.project_type IS NULL )  )
			and (  project.apprv_mgr1 LIKE #SqlParameter%apprvmgr1% OR ( #SqlParameter%apprvmgr1% = '%' and project.apprv_mgr1 IS NULL )  )
			and EXISTS(SELECT 1 FROM activity_log WHERE activity_log.project_id=project.project_id and ( activity_log.activity_type  LIKE #SqlParameter%activitytype% OR ( #SqlParameter%activitytype% = '%' and activity_log.activity_type IS NULL )  ))
			and (  project.program_id LIKE #SqlParameter%programid% OR ( #SqlParameter%programid% = '%' and project.program_id IS NULL )  )	
		ORDER BY project_id ASC) AS foo
	ORDER BY seq,project_id DESC) AS task2,				 				 
	(SELECT TOP 1 project_id 
	FROM 	(SELECT  '1' seq,NULL project_id FROM 
		(SELECT count(project_id) countp FROM project
		left outer join bl on bl.bl_id=project.bl_id 
		WHERE 	(DATEPART( month, date_start)  &lt;= DATEPART( month, cal_date) and DATEPART( year, date_start) =#SqlParameter%sRestyear% OR
			DATEPART( year, date_start) &lt; #SqlParameter%sRestyear% ) 
		and ( DATEPART( month, cal_date) &lt;= DATEPART( month, date_end) and DATEPART( year, date_end) = #SqlParameter%sRestyear%  OR
			DATEPART( year, date_end) &gt; #SqlParameter%sRestyear% )
			and (  bl.state_id LIKE #SqlParameter%stateid% OR ( #SqlParameter%stateid% = '%' and bl.state_id IS NULL )  )
			and (  bl.city_id LIKE #SqlParameter%cityid% OR ( #SqlParameter%cityid% = '%' and  bl.city_id  IS NULL )  )
			and (  bl.site_id LIKE #SqlParameter%siteid% OR ( #SqlParameter%siteid% = '%' and  bl.site_id IS NULL )  )
			and (  project.bl_id LIKE #SqlParameter%blid% OR ( #SqlParameter%blid% = '%' and project.bl_id IS NULL )  )
			and (  project.dv_id LIKE #SqlParameter%dvid% OR ( #SqlParameter%dvid% = '%' and project.dv_id IS NULL )  )
			and (  project.dp_id LIKE #SqlParameter%dpid% OR ( #SqlParameter%dpid% = '%' and project.dp_id IS NULL )  )
			and   project.project_id LIKE #SqlParameter%projectid%
			and ( project.project_type LIKE #SqlParameter%projecttype% OR ( #SqlParameter%projecttype% = '%' and project.project_type IS NULL )  )
			and (  project.apprv_mgr1 LIKE #SqlParameter%apprvmgr1% OR ( #SqlParameter%apprvmgr1% = '%' and project.apprv_mgr1 IS NULL )  )
			and EXISTS(SELECT 1 FROM activity_log WHERE activity_log.project_id=project.project_id and ( activity_log.activity_type  LIKE #SqlParameter%activitytype% OR ( #SqlParameter%activitytype% = '%' and activity_log.activity_type IS NULL )  ))
			and (  project.program_id LIKE #SqlParameter%programid% OR ( #SqlParameter%programid% = '%' and project.program_id IS NULL )  ))a
		WHERE countp &lt; 3
		UNION
		SELECT TOP 3 '2' seq,project_id FROM project
		left outer join bl on bl.bl_id=project.bl_id 
		WHERE 	(DATEPART( month, date_start)  &lt;= DATEPART( month, cal_date) and DATEPART( year, date_start) =#SqlParameter%sRestyear% OR
			DATEPART( year, date_start) &lt; #SqlParameter%sRestyear% ) 
		and ( DATEPART( month, cal_date) &lt;= DATEPART( month, date_end) and DATEPART( year, date_end) = #SqlParameter%sRestyear%  OR
			DATEPART( year, date_end) &gt; #SqlParameter%sRestyear% )
			and (  bl.state_id LIKE #SqlParameter%stateid% OR ( #SqlParameter%stateid% = '%' and bl.state_id IS NULL )  )
			and (  bl.city_id LIKE #SqlParameter%cityid% OR ( #SqlParameter%cityid% = '%' and  bl.city_id  IS NULL )  )
			and (  bl.site_id LIKE #SqlParameter%siteid% OR ( #SqlParameter%siteid% = '%' and  bl.site_id IS NULL )  )
			and (  project.bl_id LIKE #SqlParameter%blid% OR ( #SqlParameter%blid% = '%' and project.bl_id IS NULL )  )
			and (  project.dv_id LIKE #SqlParameter%dvid% OR ( #SqlParameter%dvid% = '%' and project.dv_id IS NULL )  )
			and (  project.dp_id LIKE #SqlParameter%dpid% OR ( #SqlParameter%dpid% = '%' and project.dp_id IS NULL )  )
			and   project.project_id LIKE #SqlParameter%projectid%
			and ( project.project_type LIKE #SqlParameter%projecttype% OR ( #SqlParameter%projecttype% = '%' and project.project_type IS NULL )  )
			and (  project.apprv_mgr1 LIKE #SqlParameter%apprvmgr1% OR ( #SqlParameter%apprvmgr1% = '%' and project.apprv_mgr1 IS NULL )  )
			and EXISTS(SELECT 1 FROM activity_log WHERE activity_log.project_id=project.project_id and ( activity_log.activity_type  LIKE #SqlParameter%activitytype% OR ( #SqlParameter%activitytype% = '%' and activity_log.activity_type IS NULL )  ))
			and (  project.program_id LIKE #SqlParameter%programid% OR ( #SqlParameter%programid% = '%' and project.program_id IS NULL )  )	
		ORDER BY project_id ASC) AS foo
	ORDER BY seq,project_id DESC) AS    task3,
	(SELECT TOP 1 project_id 
	FROM 	(SELECT  '1' seq,NULL project_id FROM 
		(SELECT count(project_id) countp FROM project
		left outer join bl on bl.bl_id=project.bl_id 
		WHERE 	(DATEPART( month, date_start)  &lt;= DATEPART( month, cal_date) and DATEPART( year, date_start) =#SqlParameter%sRestyear% OR
			DATEPART( year, date_start) &lt; #SqlParameter%sRestyear% ) 
		and ( DATEPART( month, cal_date) &lt;= DATEPART( month, date_end) and DATEPART( year, date_end) = #SqlParameter%sRestyear%  OR
			DATEPART( year, date_end) &gt; #SqlParameter%sRestyear% )
			and (  bl.state_id LIKE #SqlParameter%stateid% OR ( #SqlParameter%stateid% = '%' and bl.state_id IS NULL )  )
			and (  bl.city_id LIKE #SqlParameter%cityid% OR ( #SqlParameter%cityid% = '%' and  bl.city_id  IS NULL )  )
			and (  bl.site_id LIKE #SqlParameter%siteid% OR ( #SqlParameter%siteid% = '%' and  bl.site_id IS NULL )  )
			and (  project.bl_id LIKE #SqlParameter%blid% OR ( #SqlParameter%blid% = '%' and project.bl_id IS NULL )  )
			and (  project.dv_id LIKE #SqlParameter%dvid% OR ( #SqlParameter%dvid% = '%' and project.dv_id IS NULL )  )
			and (  project.dp_id LIKE #SqlParameter%dpid% OR ( #SqlParameter%dpid% = '%' and project.dp_id IS NULL )  )
			and   project.project_id LIKE #SqlParameter%projectid%
			and ( project.project_type LIKE #SqlParameter%projecttype% OR ( #SqlParameter%projecttype% = '%' and project.project_type IS NULL )  )
			and (  project.apprv_mgr1 LIKE #SqlParameter%apprvmgr1% OR ( #SqlParameter%apprvmgr1% = '%' and project.apprv_mgr1 IS NULL )  )
			and EXISTS(SELECT 1 FROM activity_log WHERE activity_log.project_id=project.project_id and ( activity_log.activity_type  LIKE #SqlParameter%activitytype% OR ( #SqlParameter%activitytype% = '%' and activity_log.activity_type IS NULL )  ))
			and (  project.program_id LIKE #SqlParameter%programid% OR ( #SqlParameter%programid% = '%' and project.program_id IS NULL )  ))a
		WHERE countp &lt; 4
		UNION
		SELECT TOP 4 '2' seq,project_id FROM project
		left outer join bl on bl.bl_id=project.bl_id 
		WHERE 	(DATEPART( month, date_start)  &lt;= DATEPART( month, cal_date) and DATEPART( year, date_start) =#SqlParameter%sRestyear% OR
			DATEPART( year, date_start) &lt; #SqlParameter%sRestyear% ) 
		and ( DATEPART( month, cal_date) &lt;= DATEPART( month, date_end) and DATEPART( year, date_end) = #SqlParameter%sRestyear%  OR
			DATEPART( year, date_end) &gt; #SqlParameter%sRestyear% )
			and (  bl.state_id LIKE #SqlParameter%stateid% OR ( #SqlParameter%stateid% = '%' and bl.state_id IS NULL )  )
			and (  bl.city_id LIKE #SqlParameter%cityid% OR ( #SqlParameter%cityid% = '%' and  bl.city_id  IS NULL )  )
			and (  bl.site_id LIKE #SqlParameter%siteid% OR ( #SqlParameter%siteid% = '%' and  bl.site_id IS NULL )  )
			and (  project.bl_id LIKE #SqlParameter%blid% OR ( #SqlParameter%blid% = '%' and project.bl_id IS NULL )  )
			and (  project.dv_id LIKE #SqlParameter%dvid% OR ( #SqlParameter%dvid% = '%' and project.dv_id IS NULL )  )
			and (  project.dp_id LIKE #SqlParameter%dpid% OR ( #SqlParameter%dpid% = '%' and project.dp_id IS NULL )  )
			and   project.project_id LIKE #SqlParameter%projectid%
			and ( project.project_type LIKE #SqlParameter%projecttype% OR ( #SqlParameter%projecttype% = '%' and project.project_type IS NULL )  )
			and (  project.apprv_mgr1 LIKE #SqlParameter%apprvmgr1% OR ( #SqlParameter%apprvmgr1% = '%' and project.apprv_mgr1 IS NULL )  )
			and EXISTS(SELECT 1 FROM activity_log WHERE activity_log.project_id=project.project_id and ( activity_log.activity_type  LIKE #SqlParameter%activitytype% OR ( #SqlParameter%activitytype% = '%' and activity_log.activity_type IS NULL )  ))
			and (  project.program_id LIKE #SqlParameter%programid% OR ( #SqlParameter%programid% = '%' and project.program_id IS NULL )  )	
		ORDER BY project_id ASC) AS foo
	ORDER BY seq,project_id DESC) AS   task4,
	(SELECT TOP 1 project_id 
	FROM 	(SELECT  '1' seq,NULL project_id FROM 
		(SELECT count(project_id) countp FROM project
		left outer join bl on bl.bl_id=project.bl_id 
		WHERE 	(DATEPART( month, date_start)  &lt;= DATEPART( month, cal_date) and DATEPART( year, date_start) =#SqlParameter%sRestyear% OR
			DATEPART( year, date_start) &lt; #SqlParameter%sRestyear% ) 
		and ( DATEPART( month, cal_date) &lt;= DATEPART( month, date_end) and DATEPART( year, date_end) = #SqlParameter%sRestyear%  OR
			DATEPART( year, date_end) &gt; #SqlParameter%sRestyear% )
			and (  bl.state_id LIKE #SqlParameter%stateid% OR ( #SqlParameter%stateid% = '%' and bl.state_id IS NULL )  )
			and (  bl.city_id LIKE #SqlParameter%cityid% OR ( #SqlParameter%cityid% = '%' and  bl.city_id  IS NULL )  )
			and (  bl.site_id LIKE #SqlParameter%siteid% OR ( #SqlParameter%siteid% = '%' and  bl.site_id IS NULL )  )
			and (  project.bl_id LIKE #SqlParameter%blid% OR ( #SqlParameter%blid% = '%' and project.bl_id IS NULL )  )
			and (  project.dv_id LIKE #SqlParameter%dvid% OR ( #SqlParameter%dvid% = '%' and project.dv_id IS NULL )  )
			and (  project.dp_id LIKE #SqlParameter%dpid% OR ( #SqlParameter%dpid% = '%' and project.dp_id IS NULL )  )
			and   project.project_id LIKE #SqlParameter%projectid%
			and ( project.project_type LIKE #SqlParameter%projecttype% OR ( #SqlParameter%projecttype% = '%' and project.project_type IS NULL )  )
			and (  project.apprv_mgr1 LIKE #SqlParameter%apprvmgr1% OR ( #SqlParameter%apprvmgr1% = '%' and project.apprv_mgr1 IS NULL )  )
			and EXISTS(SELECT 1 FROM activity_log WHERE activity_log.project_id=project.project_id and ( activity_log.activity_type  LIKE #SqlParameter%activitytype% OR ( #SqlParameter%activitytype% = '%' and activity_log.activity_type IS NULL )  ))
			and (  project.program_id LIKE #SqlParameter%programid% OR ( #SqlParameter%programid% = '%' and project.program_id IS NULL )  ))a
		WHERE countp &lt; 5
		UNION
		SELECT TOP 5 '2' seq,project_id FROM project
		left outer join bl on bl.bl_id=project.bl_id 
		WHERE 	(DATEPART( month, date_start)  &lt;= DATEPART( month, cal_date) and DATEPART( year, date_start) =#SqlParameter%sRestyear% OR
			DATEPART( year, date_start) &lt; #SqlParameter%sRestyear% ) 
		and ( DATEPART( month, cal_date) &lt;= DATEPART( month, date_end) and DATEPART( year, date_end) = #SqlParameter%sRestyear%  OR
			DATEPART( year, date_end) &gt; #SqlParameter%sRestyear% )
			and (  bl.state_id LIKE #SqlParameter%stateid% OR ( #SqlParameter%stateid% = '%' and bl.state_id IS NULL )  )
			and (  bl.city_id LIKE #SqlParameter%cityid% OR ( #SqlParameter%cityid% = '%' and  bl.city_id  IS NULL )  )
			and (  bl.site_id LIKE #SqlParameter%siteid% OR ( #SqlParameter%siteid% = '%' and  bl.site_id IS NULL )  )
			and (  project.bl_id LIKE #SqlParameter%blid% OR ( #SqlParameter%blid% = '%' and project.bl_id IS NULL )  )
			and (  project.dv_id LIKE #SqlParameter%dvid% OR ( #SqlParameter%dvid% = '%' and project.dv_id IS NULL )  )
			and (  project.dp_id LIKE #SqlParameter%dpid% OR ( #SqlParameter%dpid% = '%' and project.dp_id IS NULL )  )
			and   project.project_id LIKE #SqlParameter%projectid%
			and ( project.project_type LIKE #SqlParameter%projecttype% OR ( #SqlParameter%projecttype% = '%' and project.project_type IS NULL )  )
			and (  project.apprv_mgr1 LIKE #SqlParameter%apprvmgr1% OR ( #SqlParameter%apprvmgr1% = '%' and project.apprv_mgr1 IS NULL )  )
			and EXISTS(SELECT 1 FROM activity_log WHERE activity_log.project_id=project.project_id and ( activity_log.activity_type  LIKE #SqlParameter%activitytype% OR ( #SqlParameter%activitytype% = '%' and activity_log.activity_type IS NULL )  ))
			and (  project.program_id LIKE #SqlParameter%programid% OR ( #SqlParameter%programid% = '%' and project.program_id IS NULL )  )	
		ORDER BY project_id ASC) AS foo
	ORDER BY seq,project_id DESC) AS   task5,
	(SELECT TOP 1 project_id 
	FROM 	(SELECT  '1' seq,NULL project_id FROM 
		(SELECT count(project_id) countp FROM project
		left outer join bl on bl.bl_id=project.bl_id 
		WHERE 	(DATEPART( month, date_start)  &lt;= DATEPART( month, cal_date) and DATEPART( year, date_start) =#SqlParameter%sRestyear% OR
			DATEPART( year, date_start) &lt; #SqlParameter%sRestyear% ) 
		and ( DATEPART( month, cal_date) &lt;= DATEPART( month, date_end) and DATEPART( year, date_end) = #SqlParameter%sRestyear%  OR
			DATEPART( year, date_end) &gt; #SqlParameter%sRestyear% )
			and (  bl.state_id LIKE #SqlParameter%stateid% OR ( #SqlParameter%stateid% = '%' and bl.state_id IS NULL )  )
			and (  bl.city_id LIKE #SqlParameter%cityid% OR ( #SqlParameter%cityid% = '%' and  bl.city_id  IS NULL )  )
			and (  bl.site_id LIKE #SqlParameter%siteid% OR ( #SqlParameter%siteid% = '%' and  bl.site_id IS NULL )  )
			and (  project.bl_id LIKE #SqlParameter%blid% OR ( #SqlParameter%blid% = '%' and project.bl_id IS NULL )  )
			and (  project.dv_id LIKE #SqlParameter%dvid% OR ( #SqlParameter%dvid% = '%' and project.dv_id IS NULL )  )
			and (  project.dp_id LIKE #SqlParameter%dpid% OR ( #SqlParameter%dpid% = '%' and project.dp_id IS NULL )  )
			and   project.project_id LIKE #SqlParameter%projectid%
			and ( project.project_type LIKE #SqlParameter%projecttype% OR ( #SqlParameter%projecttype% = '%' and project.project_type IS NULL )  )
			and (  project.apprv_mgr1 LIKE #SqlParameter%apprvmgr1% OR ( #SqlParameter%apprvmgr1% = '%' and project.apprv_mgr1 IS NULL )  )
			and EXISTS(SELECT 1 FROM activity_log WHERE activity_log.project_id=project.project_id and ( activity_log.activity_type  LIKE #SqlParameter%activitytype% OR ( #SqlParameter%activitytype% = '%' and activity_log.activity_type IS NULL )  ))
			and (  project.program_id LIKE #SqlParameter%programid% OR ( #SqlParameter%programid% = '%' and project.program_id IS NULL )  ))a
		WHERE countp &lt; 6
		UNION
		SELECT TOP 6 '2' seq,project_id FROM project
		left outer join bl on bl.bl_id=project.bl_id 
		WHERE 	(DATEPART( month, date_start)  &lt;= DATEPART( month, cal_date) and DATEPART( year, date_start) =#SqlParameter%sRestyear% OR
			DATEPART( year, date_start) &lt; #SqlParameter%sRestyear% ) 
		and ( DATEPART( month, cal_date) &lt;= DATEPART( month, date_end) and DATEPART( year, date_end) = #SqlParameter%sRestyear%  OR
			DATEPART( year, date_end) &gt; #SqlParameter%sRestyear% )
			and (  bl.state_id LIKE #SqlParameter%stateid% OR ( #SqlParameter%stateid% = '%' and bl.state_id IS NULL )  )
			and (  bl.city_id LIKE #SqlParameter%cityid% OR ( #SqlParameter%cityid% = '%' and  bl.city_id  IS NULL )  )
			and (  bl.site_id LIKE #SqlParameter%siteid% OR ( #SqlParameter%siteid% = '%' and  bl.site_id IS NULL )  )
			and (  project.bl_id LIKE #SqlParameter%blid% OR ( #SqlParameter%blid% = '%' and project.bl_id IS NULL )  )
			and (  project.dv_id LIKE #SqlParameter%dvid% OR ( #SqlParameter%dvid% = '%' and project.dv_id IS NULL )  )
			and (  project.dp_id LIKE #SqlParameter%dpid% OR ( #SqlParameter%dpid% = '%' and project.dp_id IS NULL )  )
			and   project.project_id LIKE #SqlParameter%projectid%
			and ( project.project_type LIKE #SqlParameter%projecttype% OR ( #SqlParameter%projecttype% = '%' and project.project_type IS NULL )  )
			and (  project.apprv_mgr1 LIKE #SqlParameter%apprvmgr1% OR ( #SqlParameter%apprvmgr1% = '%' and project.apprv_mgr1 IS NULL )  )
			and EXISTS(SELECT 1 FROM activity_log WHERE activity_log.project_id=project.project_id and ( activity_log.activity_type  LIKE #SqlParameter%activitytype% OR ( #SqlParameter%activitytype% = '%' and activity_log.activity_type IS NULL )  ))
			and (  project.program_id LIKE #SqlParameter%programid% OR ( #SqlParameter%programid% = '%' and project.program_id IS NULL )  )	
		ORDER BY project_id ASC) AS foo
	ORDER BY seq,project_id DESC) AS   task6,
	(SELECT TOP 1 project_id 
	FROM 	(SELECT  '1' seq,NULL project_id FROM 
		(SELECT count(project_id) countp FROM project
		left outer join bl on bl.bl_id=project.bl_id 
		WHERE 	(DATEPART( month, date_start)  &lt;= DATEPART( month, cal_date) and DATEPART( year, date_start) =#SqlParameter%sRestyear% OR
			DATEPART( year, date_start) &lt; #SqlParameter%sRestyear% ) 
		and ( DATEPART( month, cal_date) &lt;= DATEPART( month, date_end) and DATEPART( year, date_end) = #SqlParameter%sRestyear%  OR
			DATEPART( year, date_end) &gt; #SqlParameter%sRestyear% )
			and (  bl.state_id LIKE #SqlParameter%stateid% OR ( #SqlParameter%stateid% = '%' and bl.state_id IS NULL )  )
			and (  bl.city_id LIKE #SqlParameter%cityid% OR ( #SqlParameter%cityid% = '%' and  bl.city_id  IS NULL )  )
			and (  bl.site_id LIKE #SqlParameter%siteid% OR ( #SqlParameter%siteid% = '%' and  bl.site_id IS NULL )  )
			and (  project.bl_id LIKE #SqlParameter%blid% OR ( #SqlParameter%blid% = '%' and project.bl_id IS NULL )  )
			and (  project.dv_id LIKE #SqlParameter%dvid% OR ( #SqlParameter%dvid% = '%' and project.dv_id IS NULL )  )
			and (  project.dp_id LIKE #SqlParameter%dpid% OR ( #SqlParameter%dpid% = '%' and project.dp_id IS NULL )  )
			and   project.project_id LIKE #SqlParameter%projectid%
			and ( project.project_type LIKE #SqlParameter%projecttype% OR ( #SqlParameter%projecttype% = '%' and project.project_type IS NULL )  )
			and (  project.apprv_mgr1 LIKE #SqlParameter%apprvmgr1% OR ( #SqlParameter%apprvmgr1% = '%' and project.apprv_mgr1 IS NULL )  )
			and EXISTS(SELECT 1 FROM activity_log WHERE activity_log.project_id=project.project_id and ( activity_log.activity_type  LIKE #SqlParameter%activitytype% OR ( #SqlParameter%activitytype% = '%' and activity_log.activity_type IS NULL )  ))
			and (  project.program_id LIKE #SqlParameter%programid% OR ( #SqlParameter%programid% = '%' and project.program_id IS NULL )  ))a
		WHERE countp &lt; 7
		UNION
		SELECT TOP 7 '2' seq,project_id FROM project
		left outer join bl on bl.bl_id=project.bl_id 
		WHERE 	(DATEPART( month, date_start)  &lt;= DATEPART( month, cal_date) and DATEPART( year, date_start) =#SqlParameter%sRestyear% OR
			DATEPART( year, date_start) &lt; #SqlParameter%sRestyear% ) 
		and ( DATEPART( month, cal_date) &lt;= DATEPART( month, date_end) and DATEPART( year, date_end) = #SqlParameter%sRestyear%  OR
			DATEPART( year, date_end) &gt; #SqlParameter%sRestyear% )
			and (  bl.state_id LIKE #SqlParameter%stateid% OR ( #SqlParameter%stateid% = '%' and bl.state_id IS NULL )  )
			and (  bl.city_id LIKE #SqlParameter%cityid% OR ( #SqlParameter%cityid% = '%' and  bl.city_id  IS NULL )  )
			and (  bl.site_id LIKE #SqlParameter%siteid% OR ( #SqlParameter%siteid% = '%' and  bl.site_id IS NULL )  )
			and (  project.bl_id LIKE #SqlParameter%blid% OR ( #SqlParameter%blid% = '%' and project.bl_id IS NULL )  )
			and (  project.dv_id LIKE #SqlParameter%dvid% OR ( #SqlParameter%dvid% = '%' and project.dv_id IS NULL )  )
			and (  project.dp_id LIKE #SqlParameter%dpid% OR ( #SqlParameter%dpid% = '%' and project.dp_id IS NULL )  )
			and   project.project_id LIKE #SqlParameter%projectid%
			and ( project.project_type LIKE #SqlParameter%projecttype% OR ( #SqlParameter%projecttype% = '%' and project.project_type IS NULL )  )
			and (  project.apprv_mgr1 LIKE #SqlParameter%apprvmgr1% OR ( #SqlParameter%apprvmgr1% = '%' and project.apprv_mgr1 IS NULL )  )
			and EXISTS(SELECT 1 FROM activity_log WHERE activity_log.project_id=project.project_id and ( activity_log.activity_type  LIKE #SqlParameter%activitytype% OR ( #SqlParameter%activitytype% = '%' and activity_log.activity_type IS NULL )  ))
			and (  project.program_id LIKE #SqlParameter%programid% OR ( #SqlParameter%programid% = '%' and project.program_id IS NULL )  )	
		ORDER BY project_id ASC) AS foo
	ORDER BY seq,project_id DESC) AS   task7,
	(SELECT TOP 1 project_id 
	FROM 	(SELECT  '1' seq,NULL project_id FROM 
		(SELECT count(project_id) countp FROM project
		left outer join bl on bl.bl_id=project.bl_id 
		WHERE 	(DATEPART( month, date_start)  &lt;= DATEPART( month, cal_date) and DATEPART( year, date_start) =#SqlParameter%sRestyear% OR
			DATEPART( year, date_start) &lt; #SqlParameter%sRestyear% ) 
		and ( DATEPART( month, cal_date) &lt;= DATEPART( month, date_end) and DATEPART( year, date_end) = #SqlParameter%sRestyear%  OR
			DATEPART( year, date_end) &gt; #SqlParameter%sRestyear% )
			and (  bl.state_id LIKE #SqlParameter%stateid% OR ( #SqlParameter%stateid% = '%' and bl.state_id IS NULL )  )
			and (  bl.city_id LIKE #SqlParameter%cityid% OR ( #SqlParameter%cityid% = '%' and  bl.city_id  IS NULL )  )
			and (  bl.site_id LIKE #SqlParameter%siteid% OR ( #SqlParameter%siteid% = '%' and  bl.site_id IS NULL )  )
			and (  project.bl_id LIKE #SqlParameter%blid% OR ( #SqlParameter%blid% = '%' and project.bl_id IS NULL )  )
			and (  project.dv_id LIKE #SqlParameter%dvid% OR ( #SqlParameter%dvid% = '%' and project.dv_id IS NULL )  )
			and (  project.dp_id LIKE #SqlParameter%dpid% OR ( #SqlParameter%dpid% = '%' and project.dp_id IS NULL )  )
			and   project.project_id LIKE #SqlParameter%projectid%
			and ( project.project_type LIKE #SqlParameter%projecttype% OR ( #SqlParameter%projecttype% = '%' and project.project_type IS NULL )  )
			and (  project.apprv_mgr1 LIKE #SqlParameter%apprvmgr1% OR ( #SqlParameter%apprvmgr1% = '%' and project.apprv_mgr1 IS NULL )  )
			and EXISTS(SELECT 1 FROM activity_log WHERE activity_log.project_id=project.project_id and ( activity_log.activity_type  LIKE #SqlParameter%activitytype% OR ( #SqlParameter%activitytype% = '%' and activity_log.activity_type IS NULL )  ))
			and (  project.program_id LIKE #SqlParameter%programid% OR ( #SqlParameter%programid% = '%' and project.program_id IS NULL )  ))a
		WHERE countp &lt; 8
		UNION
		SELECT TOP 8 '2' seq,project_id FROM project
		left outer join bl on bl.bl_id=project.bl_id 
		WHERE 	(DATEPART( month, date_start)  &lt;= DATEPART( month, cal_date) and DATEPART( year, date_start) =#SqlParameter%sRestyear% OR
			DATEPART( year, date_start) &lt; #SqlParameter%sRestyear% ) 
		and ( DATEPART( month, cal_date) &lt;= DATEPART( month, date_end) and DATEPART( year, date_end) = #SqlParameter%sRestyear%  OR
			DATEPART( year, date_end) &gt; #SqlParameter%sRestyear% )
			and (  bl.state_id LIKE #SqlParameter%stateid% OR ( #SqlParameter%stateid% = '%' and bl.state_id IS NULL )  )
			and (  bl.city_id LIKE #SqlParameter%cityid% OR ( #SqlParameter%cityid% = '%' and  bl.city_id  IS NULL )  )
			and (  bl.site_id LIKE #SqlParameter%siteid% OR ( #SqlParameter%siteid% = '%' and  bl.site_id IS NULL )  )
			and (  project.bl_id LIKE #SqlParameter%blid% OR ( #SqlParameter%blid% = '%' and project.bl_id IS NULL )  )
			and (  project.dv_id LIKE #SqlParameter%dvid% OR ( #SqlParameter%dvid% = '%' and project.dv_id IS NULL )  )
			and (  project.dp_id LIKE #SqlParameter%dpid% OR ( #SqlParameter%dpid% = '%' and project.dp_id IS NULL )  )
			and   project.project_id LIKE #SqlParameter%projectid%
			and ( project.project_type LIKE #SqlParameter%projecttype% OR ( #SqlParameter%projecttype% = '%' and project.project_type IS NULL )  )
			and (  project.apprv_mgr1 LIKE #SqlParameter%apprvmgr1% OR ( #SqlParameter%apprvmgr1% = '%' and project.apprv_mgr1 IS NULL )  )
			and EXISTS(SELECT 1 FROM activity_log WHERE activity_log.project_id=project.project_id and ( activity_log.activity_type  LIKE #SqlParameter%activitytype% OR ( #SqlParameter%activitytype% = '%' and activity_log.activity_type IS NULL )  ))
			and (  project.program_id LIKE #SqlParameter%programid% OR ( #SqlParameter%programid% = '%' and project.program_id IS NULL )  )	
		ORDER BY project_id ASC) AS foo
	ORDER BY seq,project_id DESC) AS   task8,
	(SELECT TOP 1 project_id 
	FROM 	(SELECT  '1' seq,NULL project_id FROM 
		(SELECT count(project_id) countp FROM project
		left outer join bl on bl.bl_id=project.bl_id 
		WHERE 	(DATEPART( month, date_start)  &lt;= DATEPART( month, cal_date) and DATEPART( year, date_start) =#SqlParameter%sRestyear% OR
			DATEPART( year, date_start) &lt; #SqlParameter%sRestyear% ) 
		and ( DATEPART( month, cal_date) &lt;= DATEPART( month, date_end) and DATEPART( year, date_end) = #SqlParameter%sRestyear%  OR
			DATEPART( year, date_end) &gt; #SqlParameter%sRestyear% )
			and (  bl.state_id LIKE #SqlParameter%stateid% OR ( #SqlParameter%stateid% = '%' and bl.state_id IS NULL )  )
			and (  bl.city_id LIKE #SqlParameter%cityid% OR ( #SqlParameter%cityid% = '%' and  bl.city_id  IS NULL )  )
			and (  bl.site_id LIKE #SqlParameter%siteid% OR ( #SqlParameter%siteid% = '%' and  bl.site_id IS NULL )  )
			and (  project.bl_id LIKE #SqlParameter%blid% OR ( #SqlParameter%blid% = '%' and project.bl_id IS NULL )  )
			and (  project.dv_id LIKE #SqlParameter%dvid% OR ( #SqlParameter%dvid% = '%' and project.dv_id IS NULL )  )
			and (  project.dp_id LIKE #SqlParameter%dpid% OR ( #SqlParameter%dpid% = '%' and project.dp_id IS NULL )  )
			and   project.project_id LIKE #SqlParameter%projectid%
			and ( project.project_type LIKE #SqlParameter%projecttype% OR ( #SqlParameter%projecttype% = '%' and project.project_type IS NULL )  )
			and (  project.apprv_mgr1 LIKE #SqlParameter%apprvmgr1% OR ( #SqlParameter%apprvmgr1% = '%' and project.apprv_mgr1 IS NULL )  )
			and EXISTS(SELECT 1 FROM activity_log WHERE activity_log.project_id=project.project_id and ( activity_log.activity_type  LIKE #SqlParameter%activitytype% OR ( #SqlParameter%activitytype% = '%' and activity_log.activity_type IS NULL )  ))
			and (  project.program_id LIKE #SqlParameter%programid% OR ( #SqlParameter%programid% = '%' and project.program_id IS NULL )  ))a
		WHERE countp &lt; 9
		UNION
		SELECT TOP 9 '2' seq,project_id FROM project
		left outer join bl on bl.bl_id=project.bl_id 
		WHERE 	(DATEPART( month, date_start)  &lt;= DATEPART( month, cal_date) and DATEPART( year, date_start) =#SqlParameter%sRestyear% OR
			DATEPART( year, date_start) &lt; #SqlParameter%sRestyear% ) 
		and ( DATEPART( month, cal_date) &lt;= DATEPART( month, date_end) and DATEPART( year, date_end) = #SqlParameter%sRestyear%  OR
			DATEPART( year, date_end) &gt; #SqlParameter%sRestyear% )
			and (  bl.state_id LIKE #SqlParameter%stateid% OR ( #SqlParameter%stateid% = '%' and bl.state_id IS NULL )  )
			and (  bl.city_id LIKE #SqlParameter%cityid% OR ( #SqlParameter%cityid% = '%' and  bl.city_id  IS NULL )  )
			and (  bl.site_id LIKE #SqlParameter%siteid% OR ( #SqlParameter%siteid% = '%' and  bl.site_id IS NULL )  )
			and (  project.bl_id LIKE #SqlParameter%blid% OR ( #SqlParameter%blid% = '%' and project.bl_id IS NULL )  )
			and (  project.dv_id LIKE #SqlParameter%dvid% OR ( #SqlParameter%dvid% = '%' and project.dv_id IS NULL )  )
			and (  project.dp_id LIKE #SqlParameter%dpid% OR ( #SqlParameter%dpid% = '%' and project.dp_id IS NULL )  )
			and   project.project_id LIKE #SqlParameter%projectid%
			and ( project.project_type LIKE #SqlParameter%projecttype% OR ( #SqlParameter%projecttype% = '%' and project.project_type IS NULL )  )
			and (  project.apprv_mgr1 LIKE #SqlParameter%apprvmgr1% OR ( #SqlParameter%apprvmgr1% = '%' and project.apprv_mgr1 IS NULL )  )
			and EXISTS(SELECT 1 FROM activity_log WHERE activity_log.project_id=project.project_id and ( activity_log.activity_type  LIKE #SqlParameter%activitytype% OR ( #SqlParameter%activitytype% = '%' and activity_log.activity_type IS NULL )  ))
			and (  project.program_id LIKE #SqlParameter%programid% OR ( #SqlParameter%programid% = '%' and project.program_id IS NULL )  )	
		ORDER BY project_id ASC) AS foo
	ORDER BY seq,project_id DESC) AS   task9,
	(SELECT TOP 1 project_id 
	FROM 	(SELECT  '1' seq,NULL project_id FROM 
		(SELECT count(project_id) countp FROM project
		left outer join bl on bl.bl_id=project.bl_id 
		WHERE 	(DATEPART( month, date_start)  &lt;= DATEPART( month, cal_date) and DATEPART( year, date_start) =#SqlParameter%sRestyear% OR
			DATEPART( year, date_start) &lt; #SqlParameter%sRestyear% ) 
		and ( DATEPART( month, cal_date) &lt;= DATEPART( month, date_end) and DATEPART( year, date_end) = #SqlParameter%sRestyear%  OR
			DATEPART( year, date_end) &gt; #SqlParameter%sRestyear% )
			and (  bl.state_id LIKE #SqlParameter%stateid% OR ( #SqlParameter%stateid% = '%' and bl.state_id IS NULL )  )
			and (  bl.city_id LIKE #SqlParameter%cityid% OR ( #SqlParameter%cityid% = '%' and  bl.city_id  IS NULL )  )
			and (  bl.site_id LIKE #SqlParameter%siteid% OR ( #SqlParameter%siteid% = '%' and  bl.site_id IS NULL )  )
			and (  project.bl_id LIKE #SqlParameter%blid% OR ( #SqlParameter%blid% = '%' and project.bl_id IS NULL )  )
			and (  project.dv_id LIKE #SqlParameter%dvid% OR ( #SqlParameter%dvid% = '%' and project.dv_id IS NULL )  )
			and (  project.dp_id LIKE #SqlParameter%dpid% OR ( #SqlParameter%dpid% = '%' and project.dp_id IS NULL )  )
			and   project.project_id LIKE #SqlParameter%projectid%
			and ( project.project_type LIKE #SqlParameter%projecttype% OR ( #SqlParameter%projecttype% = '%' and project.project_type IS NULL )  )
			and (  project.apprv_mgr1 LIKE #SqlParameter%apprvmgr1% OR ( #SqlParameter%apprvmgr1% = '%' and project.apprv_mgr1 IS NULL )  )
			and EXISTS(SELECT 1 FROM activity_log WHERE activity_log.project_id=project.project_id and ( activity_log.activity_type  LIKE #SqlParameter%activitytype% OR ( #SqlParameter%activitytype% = '%' and activity_log.activity_type IS NULL )  ))
			and (  project.program_id LIKE #SqlParameter%programid% OR ( #SqlParameter%programid% = '%' and project.program_id IS NULL )  ))a
		WHERE countp &lt; 10
		UNION
		SELECT TOP 10 '2' seq,project_id FROM project
		left outer join bl on bl.bl_id=project.bl_id 
		WHERE 	(DATEPART( month, date_start)  &lt;= DATEPART( month, cal_date) and DATEPART( year, date_start) =#SqlParameter%sRestyear% OR
			DATEPART( year, date_start) &lt; #SqlParameter%sRestyear% ) 
		and ( DATEPART( month, cal_date) &lt;= DATEPART( month, date_end) and DATEPART( year, date_end) = #SqlParameter%sRestyear%  OR
			DATEPART( year, date_end) &gt; #SqlParameter%sRestyear% )
			and (  bl.state_id LIKE #SqlParameter%stateid% OR ( #SqlParameter%stateid% = '%' and bl.state_id IS NULL )  )
			and (  bl.city_id LIKE #SqlParameter%cityid% OR ( #SqlParameter%cityid% = '%' and  bl.city_id  IS NULL )  )
			and (  bl.site_id LIKE #SqlParameter%siteid% OR ( #SqlParameter%siteid% = '%' and  bl.site_id IS NULL )  )
			and (  project.bl_id LIKE #SqlParameter%blid% OR ( #SqlParameter%blid% = '%' and project.bl_id IS NULL )  )
			and (  project.dv_id LIKE #SqlParameter%dvid% OR ( #SqlParameter%dvid% = '%' and project.dv_id IS NULL )  )
			and (  project.dp_id LIKE #SqlParameter%dpid% OR ( #SqlParameter%dpid% = '%' and project.dp_id IS NULL )  )
			and   project.project_id LIKE #SqlParameter%projectid%
			and ( project.project_type LIKE #SqlParameter%projecttype% OR ( #SqlParameter%projecttype% = '%' and project.project_type IS NULL )  )
			and (  project.apprv_mgr1 LIKE #SqlParameter%apprvmgr1% OR ( #SqlParameter%apprvmgr1% = '%' and project.apprv_mgr1 IS NULL )  )
			and EXISTS(SELECT 1 FROM activity_log WHERE activity_log.project_id=project.project_id and ( activity_log.activity_type  LIKE #SqlParameter%activitytype% OR ( #SqlParameter%activitytype% = '%' and activity_log.activity_type IS NULL )  ))
			and (  project.program_id LIKE #SqlParameter%programid% OR ( #SqlParameter%programid% = '%' and project.program_id IS NULL )  )	
		ORDER BY project_id ASC) AS foo
	ORDER BY seq,project_id DESC)  AS  task10, 
	(SELECT project.days_per_week FROM project 
	WHERE project_id = 	(SELECT TOP 1 project_id FROM project
				left outer join bl on bl.bl_id=project.bl_id 
				WHERE 	(DATEPART( month, date_start)  &lt;= DATEPART( month, cal_date) and DATEPART( year, date_start) =#SqlParameter%sRestyear% OR
			DATEPART( year, date_start) &lt; #SqlParameter%sRestyear% ) 
		and ( DATEPART( month, cal_date) &lt;= DATEPART( month, date_end) and DATEPART( year, date_end) = #SqlParameter%sRestyear%  OR
			DATEPART( year, date_end) &gt; #SqlParameter%sRestyear% )
					and (  bl.state_id LIKE #SqlParameter%stateid% OR ( #SqlParameter%stateid% = '%' and bl.state_id IS NULL )  )
					and (  bl.city_id LIKE #SqlParameter%cityid% OR ( #SqlParameter%cityid% = '%' and  bl.city_id  IS NULL )  )
					and (  bl.site_id LIKE #SqlParameter%siteid% OR ( #SqlParameter%siteid% = '%' and  bl.site_id IS NULL )  )
					and (  project.bl_id LIKE #SqlParameter%blid% OR ( #SqlParameter%blid% = '%' and project.bl_id IS NULL )  )
					and (  project.dv_id LIKE #SqlParameter%dvid% OR ( #SqlParameter%dvid% = '%' and project.dv_id IS NULL )  )
					and (  project.dp_id LIKE #SqlParameter%dpid% OR ( #SqlParameter%dpid% = '%' and project.dp_id IS NULL )  )
					and   project.project_id LIKE #SqlParameter%projectid%
					and ( project.project_type LIKE #SqlParameter%projecttype% OR ( #SqlParameter%projecttype% = '%' and project.project_type IS NULL )  )
					and (  project.apprv_mgr1 LIKE #SqlParameter%apprvmgr1% OR ( #SqlParameter%apprvmgr1% = '%' and project.apprv_mgr1 IS NULL )  )
					and EXISTS(SELECT 1 FROM activity_log WHERE activity_log.project_id=project.project_id and ( activity_log.activity_type  LIKE #SqlParameter%activitytype% OR ( #SqlParameter%activitytype% = '%' and activity_log.activity_type IS NULL )  ))
					and (  project.program_id LIKE #SqlParameter%programid% OR ( #SqlParameter%programid% = '%' and project.program_id IS NULL )  )	
				ORDER BY project_id				 				 
				)
	) AS daysPerWeekProj1 ,
	(SELECT project.days_per_week FROM project 
	WHERE project_id = 	(SELECT TOP 1 * 
				FROM 	(SELECT TOP 2 project_id FROM project
					left outer join bl on bl.bl_id=project.bl_id 
					WHERE 	(DATEPART( month, date_start)  &lt;= DATEPART( month, cal_date) and DATEPART( year, date_start) =#SqlParameter%sRestyear% OR
			DATEPART( year, date_start) &lt; #SqlParameter%sRestyear% ) 
		and ( DATEPART( month, cal_date) &lt;= DATEPART( month, date_end) and DATEPART( year, date_end) = #SqlParameter%sRestyear%  OR
			DATEPART( year, date_end) &gt; #SqlParameter%sRestyear% )
						and (  bl.state_id LIKE #SqlParameter%stateid% OR ( #SqlParameter%stateid% = '%' and bl.state_id IS NULL )  )
						and (  bl.city_id LIKE #SqlParameter%cityid% OR ( #SqlParameter%cityid% = '%' and  bl.city_id  IS NULL )  )
						and (  bl.site_id LIKE #SqlParameter%siteid% OR ( #SqlParameter%siteid% = '%' and  bl.site_id IS NULL )  )
						and (  project.bl_id LIKE #SqlParameter%blid% OR ( #SqlParameter%blid% = '%' and project.bl_id IS NULL )  )
						and (  project.dv_id LIKE #SqlParameter%dvid% OR ( #SqlParameter%dvid% = '%' and project.dv_id IS NULL )  )
						and (  project.dp_id LIKE #SqlParameter%dpid% OR ( #SqlParameter%dpid% = '%' and project.dp_id IS NULL )  )
						and   project.project_id LIKE #SqlParameter%projectid%
						and ( project.project_type LIKE #SqlParameter%projecttype% OR ( #SqlParameter%projecttype% = '%' and project.project_type IS NULL )  )
						and (  project.apprv_mgr1 LIKE #SqlParameter%apprvmgr1% OR ( #SqlParameter%apprvmgr1% = '%' and project.apprv_mgr1 IS NULL )  )
						and EXISTS(SELECT 1 FROM activity_log WHERE activity_log.project_id=project.project_id and ( activity_log.activity_type  LIKE #SqlParameter%activitytype% OR ( #SqlParameter%activitytype% = '%' and activity_log.activity_type IS NULL )  ))
						and (  project.program_id LIKE #SqlParameter%programid% OR ( #SqlParameter%programid% = '%' and project.program_id IS NULL )  )	
					ORDER BY project_id ASC) AS foo
				ORDER BY project_id DESC)
	)  AS daysPerWeekProj2,
	(SELECT project.days_per_week FROM project 
	WHERE project_id = 	(SELECT TOP 1 * 
				FROM 	(SELECT TOP 3 project_id FROM project
					left outer join bl on bl.bl_id=project.bl_id 
					WHERE 	(DATEPART( month, date_start)  &lt;= DATEPART( month, cal_date) and DATEPART( year, date_start) =#SqlParameter%sRestyear% OR
			DATEPART( year, date_start) &lt; #SqlParameter%sRestyear% ) 
		and ( DATEPART( month, cal_date) &lt;= DATEPART( month, date_end) and DATEPART( year, date_end) = #SqlParameter%sRestyear%  OR
			DATEPART( year, date_end) &gt; #SqlParameter%sRestyear% )
						and (  bl.state_id LIKE #SqlParameter%stateid% OR ( #SqlParameter%stateid% = '%' and bl.state_id IS NULL )  )
						and (  bl.city_id LIKE #SqlParameter%cityid% OR ( #SqlParameter%cityid% = '%' and  bl.city_id  IS NULL )  )
						and (  bl.site_id LIKE #SqlParameter%siteid% OR ( #SqlParameter%siteid% = '%' and  bl.site_id IS NULL )  )
						and (  project.bl_id LIKE #SqlParameter%blid% OR ( #SqlParameter%blid% = '%' and project.bl_id IS NULL )  )
						and (  project.dv_id LIKE #SqlParameter%dvid% OR ( #SqlParameter%dvid% = '%' and project.dv_id IS NULL )  )
						and (  project.dp_id LIKE #SqlParameter%dpid% OR ( #SqlParameter%dpid% = '%' and project.dp_id IS NULL )  )
						and   project.project_id LIKE #SqlParameter%projectid%
						and ( project.project_type LIKE #SqlParameter%projecttype% OR ( #SqlParameter%projecttype% = '%' and project.project_type IS NULL )  )
						and (  project.apprv_mgr1 LIKE #SqlParameter%apprvmgr1% OR ( #SqlParameter%apprvmgr1% = '%' and project.apprv_mgr1 IS NULL )  )
						and EXISTS(SELECT 1 FROM activity_log WHERE activity_log.project_id=project.project_id and ( activity_log.activity_type  LIKE #SqlParameter%activitytype% OR ( #SqlParameter%activitytype% = '%' and activity_log.activity_type IS NULL )  ))
						and (  project.program_id LIKE #SqlParameter%programid% OR ( #SqlParameter%programid% = '%' and project.program_id IS NULL )  )	
					ORDER BY project_id ASC) AS foo
				ORDER BY project_id DESC)
	) AS   daysPerWeekProj3,
	(SELECT project.days_per_week FROM project 
	WHERE project_id = 	(SELECT TOP 1 * 
				FROM 	(SELECT TOP 4 project_id FROM project
					left outer join bl on bl.bl_id=project.bl_id 
					WHERE 	(DATEPART( month, date_start)  &lt;= DATEPART( month, cal_date) and DATEPART( year, date_start) =#SqlParameter%sRestyear% OR
			DATEPART( year, date_start) &lt; #SqlParameter%sRestyear% ) 
		and ( DATEPART( month, cal_date) &lt;= DATEPART( month, date_end) and DATEPART( year, date_end) = #SqlParameter%sRestyear%  OR
			DATEPART( year, date_end) &gt; #SqlParameter%sRestyear% ) 
						and (  bl.state_id LIKE #SqlParameter%stateid% OR ( #SqlParameter%stateid% = '%' and bl.state_id IS NULL )  )
						and (  bl.city_id LIKE #SqlParameter%cityid% OR ( #SqlParameter%cityid% = '%' and  bl.city_id  IS NULL )  )
						and (  bl.site_id LIKE #SqlParameter%siteid% OR ( #SqlParameter%siteid% = '%' and  bl.site_id IS NULL )  )
						and (  project.bl_id LIKE #SqlParameter%blid% OR ( #SqlParameter%blid% = '%' and project.bl_id IS NULL )  )
						and (  project.dv_id LIKE #SqlParameter%dvid% OR ( #SqlParameter%dvid% = '%' and project.dv_id IS NULL )  )
						and (  project.dp_id LIKE #SqlParameter%dpid% OR ( #SqlParameter%dpid% = '%' and project.dp_id IS NULL )  )
						and   project.project_id LIKE #SqlParameter%projectid%
						and ( project.project_type LIKE #SqlParameter%projecttype% OR ( #SqlParameter%projecttype% = '%' and project.project_type IS NULL )  )
						and (  project.apprv_mgr1 LIKE #SqlParameter%apprvmgr1% OR ( #SqlParameter%apprvmgr1% = '%' and project.apprv_mgr1 IS NULL )  )
						and EXISTS(SELECT 1 FROM activity_log WHERE activity_log.project_id=project.project_id and ( activity_log.activity_type  LIKE #SqlParameter%activitytype% OR ( #SqlParameter%activitytype% = '%' and activity_log.activity_type IS NULL )  ))
						and (  project.program_id LIKE #SqlParameter%programid% OR ( #SqlParameter%programid% = '%' and project.program_id IS NULL )  )	
					ORDER BY project_id ASC) AS foo
				ORDER BY project_id DESC)
	)  AS  daysPerWeekProj4,
	(SELECT project.days_per_week FROM project 
	WHERE project_id = 	(SELECT TOP 1 * 
				FROM 	(SELECT TOP 5 project_id FROM project
					left outer join bl on bl.bl_id=project.bl_id 
					WHERE 	(DATEPART( month, date_start)  &lt;= DATEPART( month, cal_date) and DATEPART( year, date_start) =#SqlParameter%sRestyear% OR
			DATEPART( year, date_start) &lt; #SqlParameter%sRestyear% ) 
		and ( DATEPART( month, cal_date) &lt;= DATEPART( month, date_end) and DATEPART( year, date_end) = #SqlParameter%sRestyear%  OR
			DATEPART( year, date_end) &gt; #SqlParameter%sRestyear% )
						and (  bl.state_id LIKE #SqlParameter%stateid% OR ( #SqlParameter%stateid% = '%' and bl.state_id IS NULL )  )
						and (  bl.city_id LIKE #SqlParameter%cityid% OR ( #SqlParameter%cityid% = '%' and  bl.city_id  IS NULL )  )
						and (  bl.site_id LIKE #SqlParameter%siteid% OR ( #SqlParameter%siteid% = '%' and  bl.site_id IS NULL )  )
						and (  project.bl_id LIKE #SqlParameter%blid% OR ( #SqlParameter%blid% = '%' and project.bl_id IS NULL )  )
						and (  project.dv_id LIKE #SqlParameter%dvid% OR ( #SqlParameter%dvid% = '%' and project.dv_id IS NULL )  )
						and (  project.dp_id LIKE #SqlParameter%dpid% OR ( #SqlParameter%dpid% = '%' and project.dp_id IS NULL )  )
						and   project.project_id LIKE #SqlParameter%projectid%
						and ( project.project_type LIKE #SqlParameter%projecttype% OR ( #SqlParameter%projecttype% = '%' and project.project_type IS NULL )  )
						and (  project.apprv_mgr1 LIKE #SqlParameter%apprvmgr1% OR ( #SqlParameter%apprvmgr1% = '%' and project.apprv_mgr1 IS NULL )  )
						and EXISTS(SELECT 1 FROM activity_log WHERE activity_log.project_id=project.project_id and ( activity_log.activity_type  LIKE #SqlParameter%activitytype% OR ( #SqlParameter%activitytype% = '%' and activity_log.activity_type IS NULL )  ))
						and (  project.program_id LIKE #SqlParameter%programid% OR ( #SqlParameter%programid% = '%' and project.program_id IS NULL )  )	
					ORDER BY project_id ASC) AS foo
				ORDER BY project_id DESC)
	) AS   daysPerWeekProj5,
	(SELECT project.days_per_week FROM project 
	WHERE project_id = 	(SELECT TOP 1 * 
				FROM 	(SELECT TOP 6 project_id FROM project
					left outer join bl on bl.bl_id=project.bl_id 
					WHERE 	(DATEPART( month, date_start)  &lt;= DATEPART( month, cal_date) and DATEPART( year, date_start) =#SqlParameter%sRestyear% OR
			DATEPART( year, date_start) &lt; #SqlParameter%sRestyear% ) 
		and ( DATEPART( month, cal_date) &lt;= DATEPART( month, date_end) and DATEPART( year, date_end) = #SqlParameter%sRestyear%  OR
			DATEPART( year, date_end) &gt; #SqlParameter%sRestyear% ) 
						and (  bl.state_id LIKE #SqlParameter%stateid% OR ( #SqlParameter%stateid% = '%' and bl.state_id IS NULL )  )
						and (  bl.city_id LIKE #SqlParameter%cityid% OR ( #SqlParameter%cityid% = '%' and  bl.city_id  IS NULL )  )
						and (  bl.site_id LIKE #SqlParameter%siteid% OR ( #SqlParameter%siteid% = '%' and  bl.site_id IS NULL )  )
						and (  project.bl_id LIKE #SqlParameter%blid% OR ( #SqlParameter%blid% = '%' and project.bl_id IS NULL )  )
						and (  project.dv_id LIKE #SqlParameter%dvid% OR ( #SqlParameter%dvid% = '%' and project.dv_id IS NULL )  )
						and (  project.dp_id LIKE #SqlParameter%dpid% OR ( #SqlParameter%dpid% = '%' and project.dp_id IS NULL )  )
						and   project.project_id LIKE #SqlParameter%projectid%
						and ( project.project_type LIKE #SqlParameter%projecttype% OR ( #SqlParameter%projecttype% = '%' and project.project_type IS NULL )  )
						and (  project.apprv_mgr1 LIKE #SqlParameter%apprvmgr1% OR ( #SqlParameter%apprvmgr1% = '%' and project.apprv_mgr1 IS NULL )  )
						and EXISTS(SELECT 1 FROM activity_log WHERE activity_log.project_id=project.project_id and ( activity_log.activity_type  LIKE #SqlParameter%activitytype% OR ( #SqlParameter%activitytype% = '%' and activity_log.activity_type IS NULL )  ))
						and (  project.program_id LIKE #SqlParameter%programid% OR ( #SqlParameter%programid% = '%' and project.program_id IS NULL )  )	
					ORDER BY project_id ASC) AS foo
				ORDER BY project_id DESC)
	) AS   daysPerWeekProj6,
	(SELECT project.days_per_week FROM project 
	WHERE project_id = 	(SELECT TOP 1 * 
				FROM 	(SELECT TOP 7 project_id FROM project
					left outer join bl on bl.bl_id=project.bl_id 
					WHERE 	(DATEPART( month, date_start)  &lt;= DATEPART( month, cal_date) and DATEPART( year, date_start) =#SqlParameter%sRestyear% OR
			DATEPART( year, date_start) &lt; #SqlParameter%sRestyear% ) 
		and ( DATEPART( month, cal_date) &lt;= DATEPART( month, date_end) and DATEPART( year, date_end) = #SqlParameter%sRestyear%  OR
			DATEPART( year, date_end) &gt; #SqlParameter%sRestyear% ) 
						and (  bl.state_id LIKE #SqlParameter%stateid% OR ( #SqlParameter%stateid% = '%' and bl.state_id IS NULL )  )
						and (  bl.city_id LIKE #SqlParameter%cityid% OR ( #SqlParameter%cityid% = '%' and  bl.city_id  IS NULL )  )
						and (  bl.site_id LIKE #SqlParameter%siteid% OR ( #SqlParameter%siteid% = '%' and  bl.site_id IS NULL )  )
						and (  project.bl_id LIKE #SqlParameter%blid% OR ( #SqlParameter%blid% = '%' and project.bl_id IS NULL )  )
						and (  project.dv_id LIKE #SqlParameter%dvid% OR ( #SqlParameter%dvid% = '%' and project.dv_id IS NULL )  )
						and (  project.dp_id LIKE #SqlParameter%dpid% OR ( #SqlParameter%dpid% = '%' and project.dp_id IS NULL )  )
						and   project.project_id LIKE #SqlParameter%projectid%
						and ( project.project_type LIKE #SqlParameter%projecttype% OR ( #SqlParameter%projecttype% = '%' and project.project_type IS NULL )  )
						and (  project.apprv_mgr1 LIKE #SqlParameter%apprvmgr1% OR ( #SqlParameter%apprvmgr1% = '%' and project.apprv_mgr1 IS NULL )  )
						and EXISTS(SELECT 1 FROM activity_log WHERE activity_log.project_id=project.project_id and ( activity_log.activity_type  LIKE #SqlParameter%activitytype% OR ( #SqlParameter%activitytype% = '%' and activity_log.activity_type IS NULL )  ))
						and (  project.program_id LIKE #SqlParameter%programid% OR ( #SqlParameter%programid% = '%' and project.program_id IS NULL )  )	
					ORDER BY project_id ASC) AS foo
				ORDER BY project_id DESC)
	) AS   daysPerWeekProj7,
	(SELECT project.days_per_week FROM project 
	WHERE project_id = 	(SELECT TOP 1 * 
				FROM 	(SELECT TOP 8 project_id FROM project
					left outer join bl on bl.bl_id=project.bl_id 
					WHERE 	(DATEPART( month, date_start)  &lt;= DATEPART( month, cal_date) and DATEPART( year, date_start) =#SqlParameter%sRestyear% OR
			DATEPART( year, date_start) &lt; #SqlParameter%sRestyear% ) 
		and ( DATEPART( month, cal_date) &lt;= DATEPART( month, date_end) and DATEPART( year, date_end) = #SqlParameter%sRestyear%  OR
			DATEPART( year, date_end) &gt; #SqlParameter%sRestyear% ) 
						and (  bl.state_id LIKE #SqlParameter%stateid% OR ( #SqlParameter%stateid% = '%' and bl.state_id IS NULL )  )
						and (  bl.city_id LIKE #SqlParameter%cityid% OR ( #SqlParameter%cityid% = '%' and  bl.city_id  IS NULL )  )
						and (  bl.site_id LIKE #SqlParameter%siteid% OR ( #SqlParameter%siteid% = '%' and  bl.site_id IS NULL )  )
						and (  project.bl_id LIKE #SqlParameter%blid% OR ( #SqlParameter%blid% = '%' and project.bl_id IS NULL )  )
						and (  project.dv_id LIKE #SqlParameter%dvid% OR ( #SqlParameter%dvid% = '%' and project.dv_id IS NULL )  )
						and (  project.dp_id LIKE #SqlParameter%dpid% OR ( #SqlParameter%dpid% = '%' and project.dp_id IS NULL )  )
						and   project.project_id LIKE #SqlParameter%projectid%
						and ( project.project_type LIKE #SqlParameter%projecttype% OR ( #SqlParameter%projecttype% = '%' and project.project_type IS NULL )  )
						and (  project.apprv_mgr1 LIKE #SqlParameter%apprvmgr1% OR ( #SqlParameter%apprvmgr1% = '%' and project.apprv_mgr1 IS NULL )  )
						and EXISTS(SELECT 1 FROM activity_log WHERE activity_log.project_id=project.project_id and ( activity_log.activity_type  LIKE #SqlParameter%activitytype% OR ( #SqlParameter%activitytype% = '%' and activity_log.activity_type IS NULL )  ))
						and (  project.program_id LIKE #SqlParameter%programid% OR ( #SqlParameter%programid% = '%' and project.program_id IS NULL )  )	
					ORDER BY project_id ASC) AS foo
				ORDER BY project_id DESC)
	) AS   daysPerWeekProj8,
	(SELECT project.days_per_week FROM project 
	WHERE project_id = 	(SELECT TOP 1 * 
				FROM 	(SELECT TOP 9 project_id FROM project
					left outer join bl on bl.bl_id=project.bl_id 
					WHERE 	(DATEPART( month, date_start)  &lt;= DATEPART( month, cal_date) and DATEPART( year, date_start) =#SqlParameter%sRestyear% OR
			DATEPART( year, date_start) &lt; #SqlParameter%sRestyear% ) 
		and ( DATEPART( month, cal_date) &lt;= DATEPART( month, date_end) and DATEPART( year, date_end) = #SqlParameter%sRestyear%  OR
			DATEPART( year, date_end) &gt; #SqlParameter%sRestyear% )
						and (  bl.state_id LIKE #SqlParameter%stateid% OR ( #SqlParameter%stateid% = '%' and bl.state_id IS NULL )  )
						and (  bl.city_id LIKE #SqlParameter%cityid% OR ( #SqlParameter%cityid% = '%' and  bl.city_id  IS NULL )  )
						and (  bl.site_id LIKE #SqlParameter%siteid% OR ( #SqlParameter%siteid% = '%' and  bl.site_id IS NULL )  )
						and (  project.bl_id LIKE #SqlParameter%blid% OR ( #SqlParameter%blid% = '%' and project.bl_id IS NULL )  )
						and (  project.dv_id LIKE #SqlParameter%dvid% OR ( #SqlParameter%dvid% = '%' and project.dv_id IS NULL )  )
						and (  project.dp_id LIKE #SqlParameter%dpid% OR ( #SqlParameter%dpid% = '%' and project.dp_id IS NULL )  )
						and   project.project_id LIKE #SqlParameter%projectid%
						and ( project.project_type LIKE #SqlParameter%projecttype% OR ( #SqlParameter%projecttype% = '%' and project.project_type IS NULL )  )
						and (  project.apprv_mgr1 LIKE #SqlParameter%apprvmgr1% OR ( #SqlParameter%apprvmgr1% = '%' and project.apprv_mgr1 IS NULL )  )
						and EXISTS(SELECT 1 FROM activity_log WHERE activity_log.project_id=project.project_id and ( activity_log.activity_type  LIKE #SqlParameter%activitytype% OR ( #SqlParameter%activitytype% = '%' and activity_log.activity_type IS NULL )  ))
						and (  project.program_id LIKE #SqlParameter%programid% OR ( #SqlParameter%programid% = '%' and project.program_id IS NULL )  )	
					ORDER BY project_id ASC) AS foo
				ORDER BY project_id DESC)
	) AS   daysPerWeekProj9,
	(SELECT project.days_per_week FROM project 
	WHERE project_id = 	(SELECT TOP 1 * 
				FROM 	(SELECT TOP 10 project_id FROM project
					left outer join bl on bl.bl_id=project.bl_id 
					WHERE 	(DATEPART( month, date_start)  &lt;= DATEPART( month, cal_date) and DATEPART( year, date_start) =#SqlParameter%sRestyear% OR
			DATEPART( year, date_start) &lt; #SqlParameter%sRestyear% ) 
		and ( DATEPART( month, cal_date) &lt;= DATEPART( month, date_end) and DATEPART( year, date_end) = #SqlParameter%sRestyear%  OR
			DATEPART( year, date_end) &gt; #SqlParameter%sRestyear% ) 
						and (  bl.state_id LIKE #SqlParameter%stateid% OR ( #SqlParameter%stateid% = '%' and bl.state_id IS NULL )  )
						and (  bl.city_id LIKE #SqlParameter%cityid% OR ( #SqlParameter%cityid% = '%' and  bl.city_id  IS NULL )  )
						and (  bl.site_id LIKE #SqlParameter%siteid% OR ( #SqlParameter%siteid% = '%' and  bl.site_id IS NULL )  )
						and (  project.bl_id LIKE #SqlParameter%blid% OR ( #SqlParameter%blid% = '%' and project.bl_id IS NULL )  )
						and (  project.dv_id LIKE #SqlParameter%dvid% OR ( #SqlParameter%dvid% = '%' and project.dv_id IS NULL )  )
						and (  project.dp_id LIKE #SqlParameter%dpid% OR ( #SqlParameter%dpid% = '%' and project.dp_id IS NULL )  )
						and   project.project_id LIKE #SqlParameter%projectid%
						and ( project.project_type LIKE #SqlParameter%projecttype% OR ( #SqlParameter%projecttype% = '%' and project.project_type IS NULL )  )
						and (  project.apprv_mgr1 LIKE #SqlParameter%apprvmgr1% OR ( #SqlParameter%apprvmgr1% = '%' and project.apprv_mgr1 IS NULL )  )
						and EXISTS(SELECT 1 FROM activity_log WHERE activity_log.project_id=project.project_id and ( activity_log.activity_type  LIKE #SqlParameter%activitytype% OR ( #SqlParameter%activitytype% = '%' and activity_log.activity_type IS NULL )  ))
						and (  project.program_id LIKE #SqlParameter%programid% OR ( #SqlParameter%programid% = '%' and project.program_id IS NULL )  )	
					ORDER BY project_id ASC) AS foo
				ORDER BY project_id DESC)
	) AS   daysPerWeekProj10,
	(SELECT project_id FROM project 
	WHERE project_id = 	(SELECT TOP 1 project_id FROM project
				left outer join bl on bl.bl_id=project.bl_id 
				WHERE 	(DATEPART( month, date_start)  &lt;= DATEPART( month, cal_date) and DATEPART( year, date_start) =#SqlParameter%sRestyear% OR
			DATEPART( year, date_start) &lt; #SqlParameter%sRestyear% ) 
		and ( DATEPART( month, cal_date) &lt;= DATEPART( month, date_end) and DATEPART( year, date_end) = #SqlParameter%sRestyear%  OR
			DATEPART( year, date_end) &gt; #SqlParameter%sRestyear% )
					and (  bl.state_id LIKE #SqlParameter%stateid% OR ( #SqlParameter%stateid% = '%' and bl.state_id IS NULL )  )
					and (  bl.city_id LIKE #SqlParameter%cityid% OR ( #SqlParameter%cityid% = '%' and  bl.city_id  IS NULL )  )
					and (  bl.site_id LIKE #SqlParameter%siteid% OR ( #SqlParameter%siteid% = '%' and  bl.site_id IS NULL )  )
					and (  project.bl_id LIKE #SqlParameter%blid% OR ( #SqlParameter%blid% = '%' and project.bl_id IS NULL )  )
					and (  project.dv_id LIKE #SqlParameter%dvid% OR ( #SqlParameter%dvid% = '%' and project.dv_id IS NULL )  )
					and (  project.dp_id LIKE #SqlParameter%dpid% OR ( #SqlParameter%dpid% = '%' and project.dp_id IS NULL )  )
					and   project.project_id LIKE #SqlParameter%projectid%
					and ( project.project_type LIKE #SqlParameter%projecttype% OR ( #SqlParameter%projecttype% = '%' and project.project_type IS NULL )  )
					and (  project.apprv_mgr1 LIKE #SqlParameter%apprvmgr1% OR ( #SqlParameter%apprvmgr1% = '%' and project.apprv_mgr1 IS NULL )  )
					and EXISTS(SELECT 1 FROM activity_log WHERE activity_log.project_id=project.project_id and ( activity_log.activity_type  LIKE #SqlParameter%activitytype% OR ( #SqlParameter%activitytype% = '%' and activity_log.activity_type IS NULL )  ))
					and (  project.program_id LIKE #SqlParameter%programid% OR ( #SqlParameter%programid% = '%' and project.program_id IS NULL )  )	
				ORDER BY project_id				 				 
				) 
	) AS desc1 ,
	(SELECT project_id FROM project 
	WHERE project_id = 	(SELECT TOP 1 * 
				FROM 	(SELECT TOP 2 project_id FROM project
					left outer join bl on bl.bl_id=project.bl_id 
					WHERE 	(DATEPART( month, date_start)  &lt;= DATEPART( month, cal_date) and DATEPART( year, date_start) =#SqlParameter%sRestyear% OR
			DATEPART( year, date_start) &lt; #SqlParameter%sRestyear% ) 
		and ( DATEPART( month, cal_date) &lt;= DATEPART( month, date_end) and DATEPART( year, date_end) = #SqlParameter%sRestyear%  OR
			DATEPART( year, date_end) &gt; #SqlParameter%sRestyear% ) 
						and (  bl.state_id LIKE #SqlParameter%stateid% OR ( #SqlParameter%stateid% = '%' and bl.state_id IS NULL )  )
						and (  bl.city_id LIKE #SqlParameter%cityid% OR ( #SqlParameter%cityid% = '%' and  bl.city_id  IS NULL )  )
						and (  bl.site_id LIKE #SqlParameter%siteid% OR ( #SqlParameter%siteid% = '%' and  bl.site_id IS NULL )  )
						and (  project.bl_id LIKE #SqlParameter%blid% OR ( #SqlParameter%blid% = '%' and project.bl_id IS NULL )  )
						and (  project.dv_id LIKE #SqlParameter%dvid% OR ( #SqlParameter%dvid% = '%' and project.dv_id IS NULL )  )
						and (  project.dp_id LIKE #SqlParameter%dpid% OR ( #SqlParameter%dpid% = '%' and project.dp_id IS NULL )  )
						and   project.project_id LIKE #SqlParameter%projectid%
						and ( project.project_type LIKE #SqlParameter%projecttype% OR ( #SqlParameter%projecttype% = '%' and project.project_type IS NULL )  )
						and (  project.apprv_mgr1 LIKE #SqlParameter%apprvmgr1% OR ( #SqlParameter%apprvmgr1% = '%' and project.apprv_mgr1 IS NULL )  )
						and EXISTS(SELECT 1 FROM activity_log WHERE activity_log.project_id=project.project_id and ( activity_log.activity_type  LIKE #SqlParameter%activitytype% OR ( #SqlParameter%activitytype% = '%' and activity_log.activity_type IS NULL )  ))
						and (  project.program_id LIKE #SqlParameter%programid% OR ( #SqlParameter%programid% = '%' and project.program_id IS NULL )  )	
					ORDER BY project_id ASC) AS foo
				ORDER BY project_id DESC) 
	) AS  desc2,
	(SELECT project_id FROM project 
	WHERE project_id = 	(SELECT TOP 1 * 
				FROM 	(SELECT TOP 3 project_id FROM project
					left outer join bl on bl.bl_id=project.bl_id 
					WHERE 	(DATEPART( month, date_start)  &lt;= DATEPART( month, cal_date) and DATEPART( year, date_start) =#SqlParameter%sRestyear% OR
			DATEPART( year, date_start) &lt; #SqlParameter%sRestyear% ) 
		and ( DATEPART( month, cal_date) &lt;= DATEPART( month, date_end) and DATEPART( year, date_end) = #SqlParameter%sRestyear%  OR
			DATEPART( year, date_end) &gt; #SqlParameter%sRestyear% )
						and (  bl.state_id LIKE #SqlParameter%stateid% OR ( #SqlParameter%stateid% = '%' and bl.state_id IS NULL )  )
						and (  bl.city_id LIKE #SqlParameter%cityid% OR ( #SqlParameter%cityid% = '%' and  bl.city_id  IS NULL )  )
						and (  bl.site_id LIKE #SqlParameter%siteid% OR ( #SqlParameter%siteid% = '%' and  bl.site_id IS NULL )  )
						and (  project.bl_id LIKE #SqlParameter%blid% OR ( #SqlParameter%blid% = '%' and project.bl_id IS NULL )  )
						and (  project.dv_id LIKE #SqlParameter%dvid% OR ( #SqlParameter%dvid% = '%' and project.dv_id IS NULL )  )
						and (  project.dp_id LIKE #SqlParameter%dpid% OR ( #SqlParameter%dpid% = '%' and project.dp_id IS NULL )  )
						and   project.project_id LIKE #SqlParameter%projectid%
						and ( project.project_type LIKE #SqlParameter%projecttype% OR ( #SqlParameter%projecttype% = '%' and project.project_type IS NULL )  )
						and (  project.apprv_mgr1 LIKE #SqlParameter%apprvmgr1% OR ( #SqlParameter%apprvmgr1% = '%' and project.apprv_mgr1 IS NULL )  )
						and EXISTS(SELECT 1 FROM activity_log WHERE activity_log.project_id=project.project_id and ( activity_log.activity_type  LIKE #SqlParameter%activitytype% OR ( #SqlParameter%activitytype% = '%' and activity_log.activity_type IS NULL )  ))
						and (  project.program_id LIKE #SqlParameter%programid% OR ( #SqlParameter%programid% = '%' and project.program_id IS NULL )  )	
					ORDER BY project_id ASC) AS foo
				ORDER BY project_id DESC) 
	)  AS  desc3,
	(SELECT project_id FROM project 
	WHERE project_id = 	(SELECT TOP 1 * 
				FROM 	(SELECT TOP 4 project_id FROM project
					left outer join bl on bl.bl_id=project.bl_id 
					WHERE 	(DATEPART( month, date_start)  &lt;= DATEPART( month, cal_date) and DATEPART( year, date_start) =#SqlParameter%sRestyear% OR
			DATEPART( year, date_start) &lt; #SqlParameter%sRestyear% ) 
		and ( DATEPART( month, cal_date) &lt;= DATEPART( month, date_end) and DATEPART( year, date_end) = #SqlParameter%sRestyear%  OR
			DATEPART( year, date_end) &gt; #SqlParameter%sRestyear% )  
						and (  bl.state_id LIKE #SqlParameter%stateid% OR ( #SqlParameter%stateid% = '%' and bl.state_id IS NULL )  )
						and (  bl.city_id LIKE #SqlParameter%cityid% OR ( #SqlParameter%cityid% = '%' and  bl.city_id  IS NULL )  )
						and (  bl.site_id LIKE #SqlParameter%siteid% OR ( #SqlParameter%siteid% = '%' and  bl.site_id IS NULL )  )
						and (  project.bl_id LIKE #SqlParameter%blid% OR ( #SqlParameter%blid% = '%' and project.bl_id IS NULL )  )
						and (  project.dv_id LIKE #SqlParameter%dvid% OR ( #SqlParameter%dvid% = '%' and project.dv_id IS NULL )  )
						and (  project.dp_id LIKE #SqlParameter%dpid% OR ( #SqlParameter%dpid% = '%' and project.dp_id IS NULL )  )
						and   project.project_id LIKE #SqlParameter%projectid%
						and ( project.project_type LIKE #SqlParameter%projecttype% OR ( #SqlParameter%projecttype% = '%' and project.project_type IS NULL )  )
						and (  project.apprv_mgr1 LIKE #SqlParameter%apprvmgr1% OR ( #SqlParameter%apprvmgr1% = '%' and project.apprv_mgr1 IS NULL )  )
						and EXISTS(SELECT 1 FROM activity_log WHERE activity_log.project_id=project.project_id and ( activity_log.activity_type  LIKE #SqlParameter%activitytype% OR ( #SqlParameter%activitytype% = '%' and activity_log.activity_type IS NULL )  ))
						and (  project.program_id LIKE #SqlParameter%programid% OR ( #SqlParameter%programid% = '%' and project.program_id IS NULL )  )	
					ORDER BY project_id ASC) AS foo
				ORDER BY project_id DESC) 
	)  AS  desc4,
	(SELECT project_id FROM project 
	WHERE project_id = 	(SELECT TOP 1 * 
				FROM 	(SELECT TOP 5 project_id FROM project
					left outer join bl on bl.bl_id=project.bl_id 
					WHERE 	(DATEPART( month, date_start)  &lt;= DATEPART( month, cal_date) and DATEPART( year, date_start) =#SqlParameter%sRestyear% OR
			DATEPART( year, date_start) &lt; #SqlParameter%sRestyear% ) 
		and ( DATEPART( month, cal_date) &lt;= DATEPART( month, date_end) and DATEPART( year, date_end) = #SqlParameter%sRestyear%  OR
			DATEPART( year, date_end) &gt; #SqlParameter%sRestyear% )
						and (  bl.state_id LIKE #SqlParameter%stateid% OR ( #SqlParameter%stateid% = '%' and bl.state_id IS NULL )  )
						and (  bl.city_id LIKE #SqlParameter%cityid% OR ( #SqlParameter%cityid% = '%' and  bl.city_id  IS NULL )  )
						and (  bl.site_id LIKE #SqlParameter%siteid% OR ( #SqlParameter%siteid% = '%' and  bl.site_id IS NULL )  )
						and (  project.bl_id LIKE #SqlParameter%blid% OR ( #SqlParameter%blid% = '%' and project.bl_id IS NULL )  )
						and (  project.dv_id LIKE #SqlParameter%dvid% OR ( #SqlParameter%dvid% = '%' and project.dv_id IS NULL )  )
						and (  project.dp_id LIKE #SqlParameter%dpid% OR ( #SqlParameter%dpid% = '%' and project.dp_id IS NULL )  )
						and   project.project_id LIKE #SqlParameter%projectid%
						and ( project.project_type LIKE #SqlParameter%projecttype% OR ( #SqlParameter%projecttype% = '%' and project.project_type IS NULL )  )
						and (  project.apprv_mgr1 LIKE #SqlParameter%apprvmgr1% OR ( #SqlParameter%apprvmgr1% = '%' and project.apprv_mgr1 IS NULL )  )
						and EXISTS(SELECT 1 FROM activity_log WHERE activity_log.project_id=project.project_id and ( activity_log.activity_type  LIKE #SqlParameter%activitytype% OR ( #SqlParameter%activitytype% = '%' and activity_log.activity_type IS NULL )  ))
						and (  project.program_id LIKE #SqlParameter%programid% OR ( #SqlParameter%programid% = '%' and project.program_id IS NULL )  )	
					ORDER BY project_id ASC) AS foo
				ORDER BY project_id DESC) 
	)  AS  desc5,
	(SELECT project_id FROM project 
	WHERE project_id = 	(SELECT TOP 1 * 
				FROM 	(SELECT TOP 6 project_id FROM project
					left outer join bl on bl.bl_id=project.bl_id 
					WHERE 	(DATEPART( month, date_start)  &lt;= DATEPART( month, cal_date) and DATEPART( year, date_start) =#SqlParameter%sRestyear% OR
			DATEPART( year, date_start) &lt; #SqlParameter%sRestyear% ) 
		and ( DATEPART( month, cal_date) &lt;= DATEPART( month, date_end) and DATEPART( year, date_end) = #SqlParameter%sRestyear%  OR
			DATEPART( year, date_end) &gt; #SqlParameter%sRestyear% )
						and (  bl.state_id LIKE #SqlParameter%stateid% OR ( #SqlParameter%stateid% = '%' and bl.state_id IS NULL )  )
						and (  bl.city_id LIKE #SqlParameter%cityid% OR ( #SqlParameter%cityid% = '%' and  bl.city_id  IS NULL )  )
						and (  bl.site_id LIKE #SqlParameter%siteid% OR ( #SqlParameter%siteid% = '%' and  bl.site_id IS NULL )  )
						and (  project.bl_id LIKE #SqlParameter%blid% OR ( #SqlParameter%blid% = '%' and project.bl_id IS NULL )  )
						and (  project.dv_id LIKE #SqlParameter%dvid% OR ( #SqlParameter%dvid% = '%' and project.dv_id IS NULL )  )
						and (  project.dp_id LIKE #SqlParameter%dpid% OR ( #SqlParameter%dpid% = '%' and project.dp_id IS NULL )  )
						and   project.project_id LIKE #SqlParameter%projectid%
						and ( project.project_type LIKE #SqlParameter%projecttype% OR ( #SqlParameter%projecttype% = '%' and project.project_type IS NULL )  )
						and (  project.apprv_mgr1 LIKE #SqlParameter%apprvmgr1% OR ( #SqlParameter%apprvmgr1% = '%' and project.apprv_mgr1 IS NULL )  )
						and EXISTS(SELECT 1 FROM activity_log WHERE activity_log.project_id=project.project_id and ( activity_log.activity_type  LIKE #SqlParameter%activitytype% OR ( #SqlParameter%activitytype% = '%' and activity_log.activity_type IS NULL )  ))
						and (  project.program_id LIKE #SqlParameter%programid% OR ( #SqlParameter%programid% = '%' and project.program_id IS NULL )  )	
					ORDER BY project_id ASC) AS foo
				ORDER BY project_id DESC) 
	)  AS  desc6,
	(SELECT project_id FROM project 
	WHERE project_id = 	(SELECT TOP 1 * 
				FROM 	(SELECT TOP 7 project_id FROM project
					left outer join bl on bl.bl_id=project.bl_id 
					WHERE 	(DATEPART( month, date_start)  &lt;= DATEPART( month, cal_date) and DATEPART( year, date_start) =#SqlParameter%sRestyear% OR
			DATEPART( year, date_start) &lt; #SqlParameter%sRestyear% ) 
		and ( DATEPART( month, cal_date) &lt;= DATEPART( month, date_end) and DATEPART( year, date_end) = #SqlParameter%sRestyear%  OR
			DATEPART( year, date_end) &gt; #SqlParameter%sRestyear% )
						and (  bl.state_id LIKE #SqlParameter%stateid% OR ( #SqlParameter%stateid% = '%' and bl.state_id IS NULL )  )
						and (  bl.city_id LIKE #SqlParameter%cityid% OR ( #SqlParameter%cityid% = '%' and  bl.city_id  IS NULL )  )
						and (  bl.site_id LIKE #SqlParameter%siteid% OR ( #SqlParameter%siteid% = '%' and  bl.site_id IS NULL )  )
						and (  project.bl_id LIKE #SqlParameter%blid% OR ( #SqlParameter%blid% = '%' and project.bl_id IS NULL )  )
						and (  project.dv_id LIKE #SqlParameter%dvid% OR ( #SqlParameter%dvid% = '%' and project.dv_id IS NULL )  )
						and (  project.dp_id LIKE #SqlParameter%dpid% OR ( #SqlParameter%dpid% = '%' and project.dp_id IS NULL )  )
						and   project.project_id LIKE #SqlParameter%projectid%
						and ( project.project_type LIKE #SqlParameter%projecttype% OR ( #SqlParameter%projecttype% = '%' and project.project_type IS NULL )  )
						and (  project.apprv_mgr1 LIKE #SqlParameter%apprvmgr1% OR ( #SqlParameter%apprvmgr1% = '%' and project.apprv_mgr1 IS NULL )  )
						and EXISTS(SELECT 1 FROM activity_log WHERE activity_log.project_id=project.project_id and ( activity_log.activity_type  LIKE #SqlParameter%activitytype% OR ( #SqlParameter%activitytype% = '%' and activity_log.activity_type IS NULL )  ))
						and (  project.program_id LIKE #SqlParameter%programid% OR ( #SqlParameter%programid% = '%' and project.program_id IS NULL )  )	
					ORDER BY project_id ASC) AS foo
				ORDER BY project_id DESC) 
	)   AS desc7,
	(SELECT project_id FROM project 
	WHERE project_id = 	(SELECT TOP 1 * 
				FROM 	(SELECT TOP 8 project_id FROM project
					left outer join bl on bl.bl_id=project.bl_id 
					WHERE 	(DATEPART( month, date_start)  &lt;= DATEPART( month, cal_date) and DATEPART( year, date_start) =#SqlParameter%sRestyear% OR
			DATEPART( year, date_start) &lt; #SqlParameter%sRestyear% ) 
		and ( DATEPART( month, cal_date) &lt;= DATEPART( month, date_end) and DATEPART( year, date_end) = #SqlParameter%sRestyear%  OR
			DATEPART( year, date_end) &gt; #SqlParameter%sRestyear% )
						and (  bl.state_id LIKE #SqlParameter%stateid% OR ( #SqlParameter%stateid% = '%' and bl.state_id IS NULL )  )
						and (  bl.city_id LIKE #SqlParameter%cityid% OR ( #SqlParameter%cityid% = '%' and  bl.city_id  IS NULL )  )
						and (  bl.site_id LIKE #SqlParameter%siteid% OR ( #SqlParameter%siteid% = '%' and  bl.site_id IS NULL )  )
						and (  project.bl_id LIKE #SqlParameter%blid% OR ( #SqlParameter%blid% = '%' and project.bl_id IS NULL )  )
						and (  project.dv_id LIKE #SqlParameter%dvid% OR ( #SqlParameter%dvid% = '%' and project.dv_id IS NULL )  )
						and (  project.dp_id LIKE #SqlParameter%dpid% OR ( #SqlParameter%dpid% = '%' and project.dp_id IS NULL )  )
						and   project.project_id LIKE #SqlParameter%projectid%
						and ( project.project_type LIKE #SqlParameter%projecttype% OR ( #SqlParameter%projecttype% = '%' and project.project_type IS NULL )  )
						and (  project.apprv_mgr1 LIKE #SqlParameter%apprvmgr1% OR ( #SqlParameter%apprvmgr1% = '%' and project.apprv_mgr1 IS NULL )  )
						and EXISTS(SELECT 1 FROM activity_log WHERE activity_log.project_id=project.project_id and ( activity_log.activity_type  LIKE #SqlParameter%activitytype% OR ( #SqlParameter%activitytype% = '%' and activity_log.activity_type IS NULL )  ))
						and (  project.program_id LIKE #SqlParameter%programid% OR ( #SqlParameter%programid% = '%' and project.program_id IS NULL )  )	
					ORDER BY project_id ASC) AS foo
				ORDER BY project_id DESC) 
	)  AS  desc8,
	(SELECT project_id FROM project 
	WHERE project_id = 	(SELECT TOP 1 * 
				FROM 	(SELECT TOP 9 project_id FROM project
					left outer join bl on bl.bl_id=project.bl_id 
					WHERE 	(DATEPART( month, date_start)  &lt;= DATEPART( month, cal_date) and DATEPART( year, date_start) =#SqlParameter%sRestyear% OR
			DATEPART( year, date_start) &lt; #SqlParameter%sRestyear% ) 
		and ( DATEPART( month, cal_date) &lt;= DATEPART( month, date_end) and DATEPART( year, date_end) = #SqlParameter%sRestyear%  OR
			DATEPART( year, date_end) &gt; #SqlParameter%sRestyear% ) 
						and (  bl.state_id LIKE #SqlParameter%stateid% OR ( #SqlParameter%stateid% = '%' and bl.state_id IS NULL )  )
						and (  bl.city_id LIKE #SqlParameter%cityid% OR ( #SqlParameter%cityid% = '%' and  bl.city_id  IS NULL )  )
						and (  bl.site_id LIKE #SqlParameter%siteid% OR ( #SqlParameter%siteid% = '%' and  bl.site_id IS NULL )  )
						and (  project.bl_id LIKE #SqlParameter%blid% OR ( #SqlParameter%blid% = '%' and project.bl_id IS NULL )  )
						and (  project.dv_id LIKE #SqlParameter%dvid% OR ( #SqlParameter%dvid% = '%' and project.dv_id IS NULL )  )
						and (  project.dp_id LIKE #SqlParameter%dpid% OR ( #SqlParameter%dpid% = '%' and project.dp_id IS NULL )  )
						and   project.project_id LIKE #SqlParameter%projectid%
						and ( project.project_type LIKE #SqlParameter%projecttype% OR ( #SqlParameter%projecttype% = '%' and project.project_type IS NULL )  )
						and (  project.apprv_mgr1 LIKE #SqlParameter%apprvmgr1% OR ( #SqlParameter%apprvmgr1% = '%' and project.apprv_mgr1 IS NULL )  )
						and EXISTS(SELECT 1 FROM activity_log WHERE activity_log.project_id=project.project_id and ( activity_log.activity_type  LIKE #SqlParameter%activitytype% OR ( #SqlParameter%activitytype% = '%' and activity_log.activity_type IS NULL )  ))
						and (  project.program_id LIKE #SqlParameter%programid% OR ( #SqlParameter%programid% = '%' and project.program_id IS NULL )  )	
					ORDER BY project_id ASC) AS foo
				ORDER BY project_id DESC) 
	)  AS  desc9,
	(SELECT project_id FROM project 
	WHERE project_id = 	(SELECT TOP 1 * 
				FROM 	(SELECT TOP 10 project_id FROM project
					left outer join bl on bl.bl_id=project.bl_id 
					WHERE 	(DATEPART( month, date_start)  &lt;= DATEPART( month, cal_date) and DATEPART( year, date_start) =#SqlParameter%sRestyear% OR
			DATEPART( year, date_start) &lt; #SqlParameter%sRestyear% ) 
		and ( DATEPART( month, cal_date) &lt;= DATEPART( month, date_end) and DATEPART( year, date_end) = #SqlParameter%sRestyear%  OR
			DATEPART( year, date_end) &gt; #SqlParameter%sRestyear% ) 
						and (  bl.state_id LIKE #SqlParameter%stateid% OR ( #SqlParameter%stateid% = '%' and bl.state_id IS NULL )  )
						and (  bl.city_id LIKE #SqlParameter%cityid% OR ( #SqlParameter%cityid% = '%' and  bl.city_id  IS NULL )  )
						and (  bl.site_id LIKE #SqlParameter%siteid% OR ( #SqlParameter%siteid% = '%' and  bl.site_id IS NULL )  )
						and (  project.bl_id LIKE #SqlParameter%blid% OR ( #SqlParameter%blid% = '%' and project.bl_id IS NULL )  )
						and (  project.dv_id LIKE #SqlParameter%dvid% OR ( #SqlParameter%dvid% = '%' and project.dv_id IS NULL )  )
						and (  project.dp_id LIKE #SqlParameter%dpid% OR ( #SqlParameter%dpid% = '%' and project.dp_id IS NULL )  )
						and   project.project_id LIKE #SqlParameter%projectid%
						and ( project.project_type LIKE #SqlParameter%projecttype% OR ( #SqlParameter%projecttype% = '%' and project.project_type IS NULL )  )
						and (  project.apprv_mgr1 LIKE #SqlParameter%apprvmgr1% OR ( #SqlParameter%apprvmgr1% = '%' and project.apprv_mgr1 IS NULL )  )
						and EXISTS(SELECT 1 FROM activity_log WHERE activity_log.project_id=project.project_id and ( activity_log.activity_type  LIKE #SqlParameter%activitytype% OR ( #SqlParameter%activitytype% = '%' and activity_log.activity_type IS NULL )  ))
						and (  project.program_id LIKE #SqlParameter%programid% OR ( #SqlParameter%programid% = '%' and project.program_id IS NULL )  )	
					ORDER BY project_id ASC) AS foo
				ORDER BY project_id DESC) 
	)  AS  desc10,
	(SELECT ( CASE WHEN COUNT(*) > 10 THEN COUNT(*)-10 ELSE 0 END )  
	FROM project 
	left outer join bl on bl.bl_id=project.bl_id 
	WHERE 	(DATEPART( month, date_start)  &lt;= DATEPART( month, cal_date) and DATEPART( year, date_start) =#SqlParameter%sRestyear% OR
			DATEPART( year, date_start) &lt; #SqlParameter%sRestyear% ) 
		and ( DATEPART( month, cal_date) &lt;= DATEPART( month, date_end) and DATEPART( year, date_end) = #SqlParameter%sRestyear%  OR
			DATEPART( year, date_end) &gt; #SqlParameter%sRestyear% )
		and (  bl.state_id LIKE #SqlParameter%stateid% OR ( #SqlParameter%stateid% = '%' and bl.state_id IS NULL )  )
		and (  bl.city_id LIKE #SqlParameter%cityid% OR ( #SqlParameter%cityid% = '%' and  bl.city_id  IS NULL )  )
		and (  bl.site_id LIKE #SqlParameter%siteid% OR ( #SqlParameter%siteid% = '%' and  bl.site_id IS NULL )  )
		and (  project.bl_id LIKE #SqlParameter%blid% OR ( #SqlParameter%blid% = '%' and project.bl_id IS NULL )  )
		and (  project.dv_id LIKE #SqlParameter%dvid% OR ( #SqlParameter%dvid% = '%' and project.dv_id IS NULL )  )
		and (  project.dp_id LIKE #SqlParameter%dpid% OR ( #SqlParameter%dpid% = '%' and project.dp_id IS NULL )  )
		and   project.project_id LIKE #SqlParameter%projectid%
		and ( project.project_type LIKE #SqlParameter%projecttype% OR ( #SqlParameter%projecttype% = '%' and project.project_type IS NULL )  )
		and (  project.apprv_mgr1 LIKE #SqlParameter%apprvmgr1% OR ( #SqlParameter%apprvmgr1% = '%' and project.apprv_mgr1 IS NULL )  )
		and EXISTS(SELECT 1 FROM activity_log WHERE activity_log.project_id=project.project_id and ( activity_log.activity_type  LIKE #SqlParameter%activitytype% OR ( #SqlParameter%activitytype% = '%' and activity_log.activity_type IS NULL )  ))
		and (  project.program_id LIKE #SqlParameter%programid% OR ( #SqlParameter%programid% = '%' and project.program_id IS NULL )  )			
	) AS moretasks 					
FROM afm_cal_dates 
WHERE DATEPART( year, cal_date ) =#SqlParameter%sRestyear%  
					   </sql>


					</query>
					<dimensions>
						<dimension name="Date" table="afm_cal_dates" column="dateformated" type="calculated" hasAll="true"/>
					</dimensions>
					<measures>
						<measure name="task1" aggregator="min" column="task1" type="calculated" datatype="string" />
						<measure name="task2" aggregator="min" column="task2" type="calculated" datatype="string" />
						<measure name="task3" aggregator="min" column="task3" type="calculated" datatype="string" />
						<measure name="task4" aggregator="min" column="task4" type="calculated" datatype="string" />
						<measure name="task5" aggregator="min" column="task5" type="calculated" datatype="string" />
						<measure name="task6" aggregator="min" column="task6" type="calculated" datatype="string" />
						<measure name="task7" aggregator="min" column="task7" type="calculated" datatype="string" />
						<measure name="task8" aggregator="min" column="task8" type="calculated" datatype="string" />
						<measure name="task9" aggregator="min" column="task9" type="calculated" datatype="string" />
						<measure name="task10" aggregator="min" column="task10" type="calculated" datatype="string" />
						<measure name="desc1" aggregator="min" column="desc1" type="calculated" datatype="string" />
						<measure name="desc2" aggregator="min" column="desc2" type="calculated" datatype="string" />
						<measure name="desc3" aggregator="min" column="desc3" type="calculated" datatype="string" />
						<measure name="desc4" aggregator="min" column="desc4" type="calculated" datatype="string" />
						<measure name="desc5" aggregator="min" column="desc5" type="calculated" datatype="string" />
						<measure name="desc6" aggregator="min" column="desc6" type="calculated" datatype="string" />
						<measure name="desc7" aggregator="min" column="desc7" type="calculated" datatype="string" />
						<measure name="desc8" aggregator="min" column="desc8" type="calculated" datatype="string" />
						<measure name="desc9" aggregator="min" column="desc9" type="calculated" datatype="string" />
						<measure name="desc10" aggregator="min" column="desc10" type="calculated" datatype="string" />
						<measure name="daysPerWeekProj1" aggregator="min" column="daysPerWeekProj1" type="calculated" decimals="0"/>
						<measure name="daysPerWeekProj2" aggregator="min" column="daysPerWeekProj2" type="calculated" decimals="0"/>
						<measure name="daysPerWeekProj3" aggregator="min" column="daysPerWeekProj3" type="calculated" decimals="0"/>
						<measure name="daysPerWeekProj4" aggregator="min" column="daysPerWeekProj4" type="calculated" decimals="0"/>
						<measure name="daysPerWeekProj5" aggregator="min" column="daysPerWeekProj5" type="calculated" decimals="0"/>
						<measure name="daysPerWeekProj6" aggregator="min" column="daysPerWeekProj6" type="calculated" decimals="0"/>
						<measure name="daysPerWeekProj7" aggregator="min" column="daysPerWeekProj7" type="calculated" decimals="0"/>
						<measure name="daysPerWeekProj8" aggregator="min" column="daysPerWeekProj8" type="calculated" decimals="0"/>
						<measure name="daysPerWeekProj9" aggregator="min" column="daysPerWeekProj9" type="calculated" decimals="0"/>
						<measure name="daysPerWeekProj10" aggregator="min" column="daysPerWeekProj10" type="calculated" decimals="0"/>										
						<measure name="moretasks" aggregator="min" column="moretasks" type="calculated" decimals="0"/>	
						
					</measures>
				</preferences>
			</mdx>
		</dataSource>
	</afmTableGroup>
	<formatting>
		<xsl file="ab-proj-projects-calendar.xsl"/>
	</formatting>
	<message name="viewtype" translatable="false">Month</message>
</afmXmlView>
