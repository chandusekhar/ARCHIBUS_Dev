<view version="2.0">
																																												 
	<!-- highlight datasources -->
	<!-- Highlight By Divisions for Export Report-->
	<dataSource id="highlightDivisionsDs" type="DrawingControlHighlight">
		 <title>Divisions</title>
		 <table name="rm" role="main"/>
		 <table name="dv" role="standard"/>
		 <table name="rmcat" role="standard"/>
		 <field table="rm" name = "bl_id"/>
		 <field table="rm" name = "fl_id"/>
		 <field table="rm" name = "rm_id"/>
		 <field table="dv" name="name" legendKey="true"/>
		 <field table="dv" name="hpattern_acad"/>
		 
		<restriction type="sql" sql="
         ${parameters['bl_id']} AND ${parameters['fl_id']} AND ${parameters['rm_id']}
        AND ${parameters['dp_id']} AND ${parameters['dv_id']} AND ${parameters['organizationUnassigned']} 
        AND ${parameters['rm_cat']} AND ${parameters['rm_type']} AND ${parameters['typeUnassigned']} 
        AND ${parameters['occupancy']}  
        AND exists ( select 1 from fl 
												where rm.bl_id=fl.bl_id and rm.fl_id=fl.fl_id 
												and (select sum(r.area) from rm ${sql.as} r
																	where r.bl_id=fl.bl_id and r.fl_id=fl.fl_id 
																	and ${parameters['bl_idForTotalCal']} AND ${parameters['fl_idForTotalCal']} AND ${parameters['rm_idForTotalCal']}
																	and ${parameters['dp_idForTotalCal']} AND ${parameters['dv_idForTotalCal']} AND ${parameters['organizationUnassignedForTotalCal']} 
																	and ${parameters['rm_catForTotalCal']} AND ${parameters['rm_typeForTotalCal']} AND ${parameters['typeUnassignedForTotalCal']} 
																	and  ${parameters['occupancyForTotalCal']}
																	and (rm.rm_cat IS NULL OR EXISTS (SELECT 1 FROM rmcat WHERE  rm.rm_cat= rmcat.rm_cat AND rmcat.used_in_calcs !='no_totals'))
														)${parameters['totalArea']} 
				)  
        AND exists ( select 1 from fl 
											where rm.bl_id=fl.bl_id and rm.fl_id=fl.fl_id 
											and (select count(1) from rm ${sql.as} r  
																	where r.bl_id=fl.bl_id and r.fl_id=fl.fl_id 
																	and ${parameters['bl_idForTotalCal']} AND ${parameters['fl_idForTotalCal']} AND ${parameters['rm_idForTotalCal']}
																	and ${parameters['dp_idForTotalCal']} AND ${parameters['dv_idForTotalCal']} AND ${parameters['organizationUnassignedForTotalCal']} 
																	and ${parameters['rm_catForTotalCal']} AND ${parameters['rm_typeForTotalCal']} AND ${parameters['typeUnassignedForTotalCal']} 
																	and  ${parameters['occupancyForTotalCal']}
																	and (rm.rm_cat IS NULL OR EXISTS (SELECT 1 FROM rmcat WHERE  rm.rm_cat= rmcat.rm_cat AND rmcat.used_in_calcs !='no_totals'))
													)${parameters['totalCount']} 
				)  
		AND ( rm.rm_cat IS NULL 
					OR EXISTS (SELECT 1 FROM rmcat WHERE rm.rm_cat= rmcat.rm_cat AND rmcat.used_in_calcs !='no_totals')
			 )
		"/>
		<!-- Restriction parameters for rooms-->
		<parameter name="bl_id" dataType="verbatim" value="1=1"/>
		<parameter name="fl_id" dataType="verbatim" value="1=1"/>
		<parameter name="rm_id" dataType="verbatim" value="1=1"/>
		<parameter name="dv_id" dataType="verbatim" value="1=1"/>
		<parameter name="dp_id" dataType="verbatim" value="1=1"/>
		<parameter name="organizationUnassigned" dataType="verbatim" value="1=1"/>
		<parameter name="rm_cat" dataType="verbatim" value="1=1"/>
		<parameter name="rm_type" dataType="verbatim" value="1=1"/>
		<parameter name="typeUnassigned" dataType="verbatim" value="1=1"/>
		<parameter name="totalArea" dataType="verbatim" value="&gt;-1"/>
		<parameter name="totalCount" dataType="verbatim" value="&gt;-1"/>

		<!-- Below restriction parameters are for total area and room count calculation -->
		<parameter name="occupancy" dataType="verbatim" value="1=1"/>
		<parameter name="bl_idForTotalCal" dataType="verbatim" value="1=1"/>
		<parameter name="fl_idForTotalCal" dataType="verbatim" value="1=1"/>
		<parameter name="rm_idForTotalCal" dataType="verbatim" value="1=1"/>
		<parameter name="dv_idForTotalCal" dataType="verbatim" value="1=1"/>
		<parameter name="dp_idForTotalCal" dataType="verbatim" value="1=1"/>
		<parameter name="organizationUnassignedForTotalCal" dataType="verbatim" value="1=1"/>
		<parameter name="rm_catForTotalCal" dataType="verbatim" value="1=1"/>
		<parameter name="rm_typeForTotalCal" dataType="verbatim" value="1=1"/>
		<parameter name="typeUnassignedForTotalCal" dataType="verbatim" value="1=1"/>
		<parameter name="occupancyForTotalCal" dataType="verbatim" value="1=1"/>
	</dataSource>

	<!-- Highlight By Departments for Export Report-->
    <dataSource id="highlightDepartmentsDs" type="DrawingControlHighlight">
        <title>Departments</title>
        <table name="rm" role="main"/>
        <table name="dp" role="standard"/>
        <field table="rm" name = "bl_id"/>
        <field table="rm" name = "fl_id"/>
        <field table="rm" name = "rm_id"/>
        <field table="dp" name="dv_id"/>
        <field table="dp" name="name" legendKey="true"/>
        <field table="dp" name="hpattern_acad"/>

		<restriction type="sql" sql="
			 ${parameters['bl_id']} AND ${parameters['fl_id']} AND ${parameters['rm_id']}
			AND ${parameters['dp_id']} AND ${parameters['dv_id']} AND ${parameters['organizationUnassigned']} 
			AND ${parameters['rm_cat']} AND ${parameters['rm_type']} AND ${parameters['typeUnassigned']} 
			AND ${parameters['occupancy']}  
			AND exists ( select 1 from fl 
													where rm.bl_id=fl.bl_id and rm.fl_id=fl.fl_id 
													and (select sum(r.area) from rm ${sql.as} r
																		where r.bl_id=fl.bl_id and r.fl_id=fl.fl_id 
																		and ${parameters['bl_idForTotalCal']} AND ${parameters['fl_idForTotalCal']} AND ${parameters['rm_idForTotalCal']}
																		and ${parameters['dp_idForTotalCal']} AND ${parameters['dv_idForTotalCal']} AND ${parameters['organizationUnassignedForTotalCal']} 
																		and ${parameters['rm_catForTotalCal']} AND ${parameters['rm_typeForTotalCal']} AND ${parameters['typeUnassignedForTotalCal']} 
																		and  ${parameters['occupancyForTotalCal']}
																		and (rm.rm_cat IS NULL OR EXISTS (SELECT 1 FROM rmcat WHERE  rm.rm_cat= rmcat.rm_cat AND rmcat.used_in_calcs !='no_totals'))
															)${parameters['totalArea']} 
					)  
			AND exists ( select 1 from fl 
												where rm.bl_id=fl.bl_id and rm.fl_id=fl.fl_id 
												and (select count(1) from rm ${sql.as} r  
																		where r.bl_id=fl.bl_id and r.fl_id=fl.fl_id 
																		and ${parameters['bl_idForTotalCal']} AND ${parameters['fl_idForTotalCal']} AND ${parameters['rm_idForTotalCal']}
																		and ${parameters['dp_idForTotalCal']} AND ${parameters['dv_idForTotalCal']} AND ${parameters['organizationUnassignedForTotalCal']} 
																		and ${parameters['rm_catForTotalCal']} AND ${parameters['rm_typeForTotalCal']} AND ${parameters['typeUnassignedForTotalCal']} 
																		and  ${parameters['occupancyForTotalCal']}
																		and (rm.rm_cat IS NULL OR EXISTS (SELECT 1 FROM rmcat WHERE  rm.rm_cat= rmcat.rm_cat AND rmcat.used_in_calcs !='no_totals'))
														)${parameters['totalCount']} 
					)  
			AND ( rm.rm_cat IS NULL 
						OR EXISTS (SELECT 1 FROM rmcat WHERE rm.rm_cat= rmcat.rm_cat AND rmcat.used_in_calcs !='no_totals')
				 )
		"/>
		<!-- Restriction parameters for rooms-->
		<parameter name="bl_id" dataType="verbatim" value="1=1"/>
		<parameter name="fl_id" dataType="verbatim" value="1=1"/>
		<parameter name="rm_id" dataType="verbatim" value="1=1"/>
		<parameter name="dv_id" dataType="verbatim" value="1=1"/>
		<parameter name="dp_id" dataType="verbatim" value="1=1"/>
		<parameter name="organizationUnassigned" dataType="verbatim" value="1=1"/>
		<parameter name="rm_cat" dataType="verbatim" value="1=1"/>
		<parameter name="rm_type" dataType="verbatim" value="1=1"/>
		<parameter name="typeUnassigned" dataType="verbatim" value="1=1"/>
		<parameter name="totalArea" dataType="verbatim" value="&gt;-1"/>
		<parameter name="totalCount" dataType="verbatim" value="&gt;-1"/>

		<!-- Below restriction parameters are for total area and room count calculation -->
		<parameter name="occupancy" dataType="verbatim" value="1=1"/>
		<parameter name="bl_idForTotalCal" dataType="verbatim" value="1=1"/>
		<parameter name="fl_idForTotalCal" dataType="verbatim" value="1=1"/>
		<parameter name="rm_idForTotalCal" dataType="verbatim" value="1=1"/>
		<parameter name="dv_idForTotalCal" dataType="verbatim" value="1=1"/>
		<parameter name="dp_idForTotalCal" dataType="verbatim" value="1=1"/>
		<parameter name="organizationUnassignedForTotalCal" dataType="verbatim" value="1=1"/>
		<parameter name="rm_catForTotalCal" dataType="verbatim" value="1=1"/>
		<parameter name="rm_typeForTotalCal" dataType="verbatim" value="1=1"/>
		<parameter name="typeUnassignedForTotalCal" dataType="verbatim" value="1=1"/>
		<parameter name="occupancyForTotalCal" dataType="verbatim" value="1=1"/>
	</dataSource>

    <dataSource id="highlightRoomStandard" type="DrawingControlHighlight">
        <title>Room Standards</title>
        <table name="rm" role="main"/>
        <table name="rmstd" role="standard"/>
        <field table="rm" name = "bl_id"/>
        <field table="rm" name = "fl_id"/>
        <field table="rm" name = "rm_id"/>
        <field table="rmstd" name = "rm_std" legendKey="true"/>
        <field table="rmstd" name="hpattern_acad"/>

        <restriction type="sql" sql="
           ( (${parameters['dp_id']} AND ${parameters['dv_id']} ) AND (${parameters['organizationUnassigned']})
                )
            AND ${parameters['bl_id']}
            AND ${parameters['fl_id']}
            AND ${parameters['rm_id']}
            AND
             (
               (${parameters['rm_cat']} AND ${parameters['rm_type']} ) AND (${parameters['typeUnassigned']})
            )
            
            AND ${parameters['occupancy']} AND ${parameters['rm_std']} AND ${parameters['excludedHotalableRm']}
        "/>
   
		<!-- Restriction parameters for rooms-->
        <parameter name="dv_id" dataType="verbatim" value="1=1"/>
        <parameter name="dp_id" dataType="verbatim" value="1=1"/>
        <parameter name="bl_id" dataType="verbatim" value="1=1"/>
        <parameter name="fl_id" dataType="verbatim" value="1=1"/>
        <parameter name="rm_id" dataType="verbatim" value="1=1"/>
        <parameter name="rm_cat" dataType="verbatim" value="1=1"/>
        <parameter name="rm_type" dataType="verbatim" value="1=1"/>
        <parameter name="occupancy" dataType="verbatim" value="1=1"/>
        <parameter name="rm_std" dataType="verbatim" value="1=1"/>
        <parameter name="organizationUnassigned" dataType="verbatim" value="1=1"/>
        <parameter name="typeUnassigned" dataType="verbatim" value="1=1"/>
        <parameter name="excludedHotalableRm" dataType="verbatim" value="5=5"/>
        <parameter name="having" dataType="verbatim" value=""/>

		<parameter name="totalArea" dataType="verbatim" value="&gt;-1"/>
		<parameter name="totalCount" dataType="verbatim" value="&gt;-1"/>

		<!-- Below restriction parameters are for total area and room count calculation -->
		<parameter name="occupancy" dataType="verbatim" value="1=1"/>
		<parameter name="bl_idForTotalCal" dataType="verbatim" value="1=1"/>
		<parameter name="fl_idForTotalCal" dataType="verbatim" value="1=1"/>
		<parameter name="rm_idForTotalCal" dataType="verbatim" value="1=1"/>
		<parameter name="dv_idForTotalCal" dataType="verbatim" value="1=1"/>
		<parameter name="dp_idForTotalCal" dataType="verbatim" value="1=1"/>
		<parameter name="organizationUnassignedForTotalCal" dataType="verbatim" value="1=1"/>
		<parameter name="rm_catForTotalCal" dataType="verbatim" value="1=1"/>
		<parameter name="rm_typeForTotalCal" dataType="verbatim" value="1=1"/>
		<parameter name="typeUnassignedForTotalCal" dataType="verbatim" value="1=1"/>
		<parameter name="occupancyForTotalCal" dataType="verbatim" value="1=1"/>
    </dataSource>

	<!-- Highlight By Room Super-categories for Export Report-->
    <dataSource id="highlightSuperCategoriesDs" type="DrawingControlHighlight">
        <title>Room Super Categories</title>
        <table name="rm" role="main"/>
        <table name="rmcat" role="standard"/>
        <field table="rm" name = "bl_id"/>
        <field table="rm" name = "fl_id"/>
        <field table="rm" name = "rm_id"/>
        <field table="rmcat" name = "supercat" legendKey="true"/>
        <field table="rm" name="hpattern_acad" dataType="text">
            <sql dialect="generic">
                case 
                 when rmcat.supercat = 'USBL' then '14 0 3 65280' 
                 when rmcat.supercat = 'VERT' then '14 0 2 16776960' 
                 when rmcat.supercat = 'SERV' then '14 0 5 255'
                 else  '14 0 7 10066329' 
                end
            </sql>
        </field>
		<restriction type="sql" sql="
         ${parameters['bl_id']} AND ${parameters['fl_id']} AND ${parameters['rm_id']}
        AND ${parameters['dp_id']} AND ${parameters['dv_id']} AND ${parameters['organizationUnassigned']} 
        AND ${parameters['rm_cat']} AND ${parameters['rm_type']} AND ${parameters['typeUnassigned']} 
        AND ${parameters['occupancy']}  
        AND exists ( select 1 from fl 
												where rm.bl_id=fl.bl_id and rm.fl_id=fl.fl_id 
												and (select sum(r.area) from rm ${sql.as} r
																	where r.bl_id=fl.bl_id and r.fl_id=fl.fl_id 
																	and ${parameters['bl_idForTotalCal']} AND ${parameters['fl_idForTotalCal']} AND ${parameters['rm_idForTotalCal']}
																	and ${parameters['dp_idForTotalCal']} AND ${parameters['dv_idForTotalCal']} AND ${parameters['organizationUnassignedForTotalCal']} 
																	and ${parameters['rm_catForTotalCal']} AND ${parameters['rm_typeForTotalCal']} AND ${parameters['typeUnassignedForTotalCal']} 
																	and  ${parameters['occupancyForTotalCal']}
																	and (rm.rm_cat IS NULL OR EXISTS (SELECT 1 FROM rmcat WHERE  rm.rm_cat= rmcat.rm_cat AND rmcat.used_in_calcs !='no_totals'))
														)${parameters['totalArea']} 
				)  
        AND exists ( select 1 from fl 
											where rm.bl_id=fl.bl_id and rm.fl_id=fl.fl_id 
											and (select count(1) from rm ${sql.as} r  
																	where r.bl_id=fl.bl_id and r.fl_id=fl.fl_id 
																	and ${parameters['bl_idForTotalCal']} AND ${parameters['fl_idForTotalCal']} AND ${parameters['rm_idForTotalCal']}
																	and ${parameters['dp_idForTotalCal']} AND ${parameters['dv_idForTotalCal']} AND ${parameters['organizationUnassignedForTotalCal']} 
																	and ${parameters['rm_catForTotalCal']} AND ${parameters['rm_typeForTotalCal']} AND ${parameters['typeUnassignedForTotalCal']} 
																	and  ${parameters['occupancyForTotalCal']}
																	and (rm.rm_cat IS NULL OR EXISTS (SELECT 1 FROM rmcat WHERE  rm.rm_cat= rmcat.rm_cat AND rmcat.used_in_calcs !='no_totals'))
													)${parameters['totalCount']} 
				)  
		AND ( rm.rm_cat IS NULL 
					OR EXISTS (SELECT 1 FROM rmcat WHERE rm.rm_cat= rmcat.rm_cat AND rmcat.used_in_calcs !='no_totals')
			 )
		"/>
		<!-- Restriction parameters for rooms-->
		<parameter name="bl_id" dataType="verbatim" value="1=1"/>
		<parameter name="fl_id" dataType="verbatim" value="1=1"/>
		<parameter name="rm_id" dataType="verbatim" value="1=1"/>
		<parameter name="dv_id" dataType="verbatim" value="1=1"/>
		<parameter name="dp_id" dataType="verbatim" value="1=1"/>
		<parameter name="organizationUnassigned" dataType="verbatim" value="1=1"/>
		<parameter name="rm_cat" dataType="verbatim" value="1=1"/>
		<parameter name="rm_type" dataType="verbatim" value="1=1"/>
		<parameter name="typeUnassigned" dataType="verbatim" value="1=1"/>
		<parameter name="totalArea" dataType="verbatim" value="&gt;-1"/>
		<parameter name="totalCount" dataType="verbatim" value="&gt;-1"/>

		<!-- Below restriction parameters are for total area and room count calculation -->
		<parameter name="occupancy" dataType="verbatim" value="1=1"/>
		<parameter name="bl_idForTotalCal" dataType="verbatim" value="1=1"/>
		<parameter name="fl_idForTotalCal" dataType="verbatim" value="1=1"/>
		<parameter name="rm_idForTotalCal" dataType="verbatim" value="1=1"/>
		<parameter name="dv_idForTotalCal" dataType="verbatim" value="1=1"/>
		<parameter name="dp_idForTotalCal" dataType="verbatim" value="1=1"/>
		<parameter name="organizationUnassignedForTotalCal" dataType="verbatim" value="1=1"/>
		<parameter name="rm_catForTotalCal" dataType="verbatim" value="1=1"/>
		<parameter name="rm_typeForTotalCal" dataType="verbatim" value="1=1"/>
		<parameter name="typeUnassignedForTotalCal" dataType="verbatim" value="1=1"/>
		<parameter name="occupancyForTotalCal" dataType="verbatim" value="1=1"/>
	</dataSource>

	<!-- Highlight By Room Categories for Export Report-->
	<dataSource id="highlightCategoriesDs" type="DrawingControlHighlight">
		<title>Room Categories</title>
		<table name="rm" role="main"/>
		<table name="rmcat" role="standard"/>
		<field table="rm" name = "bl_id"/>
		<field table="rm" name = "fl_id"/>
		<field table="rm" name = "rm_id"/>
		<field table="rmcat" name = "rm_cat" legendKey="true"/>
		<field table="rmcat" name="hpattern_acad"/>
		<restriction type="sql" sql="
		 ${parameters['bl_id']} AND ${parameters['fl_id']} AND ${parameters['rm_id']}
		AND ${parameters['dp_id']} AND ${parameters['dv_id']} AND ${parameters['organizationUnassigned']} 
		AND ${parameters['rm_cat']} AND ${parameters['rm_type']} AND ${parameters['typeUnassigned']} 
		AND ${parameters['occupancy']}  
		AND exists ( select 1 from fl 
												where rm.bl_id=fl.bl_id and rm.fl_id=fl.fl_id 
												and (select sum(r.area) from rm ${sql.as} r
																	where r.bl_id=fl.bl_id and r.fl_id=fl.fl_id 
																	and ${parameters['bl_idForTotalCal']} AND ${parameters['fl_idForTotalCal']} AND ${parameters['rm_idForTotalCal']}
																	and ${parameters['dp_idForTotalCal']} AND ${parameters['dv_idForTotalCal']} AND ${parameters['organizationUnassignedForTotalCal']} 
																	and ${parameters['rm_catForTotalCal']} AND ${parameters['rm_typeForTotalCal']} AND ${parameters['typeUnassignedForTotalCal']} 
																	and  ${parameters['occupancyForTotalCal']}
																	and (rm.rm_cat IS NULL OR EXISTS (SELECT 1 FROM rmcat WHERE  rm.rm_cat= rmcat.rm_cat AND rmcat.used_in_calcs !='no_totals'))
														)${parameters['totalArea']} 
				)  
		AND exists ( select 1 from fl 
											where rm.bl_id=fl.bl_id and rm.fl_id=fl.fl_id 
											and (select count(1) from rm ${sql.as} r  
																	where r.bl_id=fl.bl_id and r.fl_id=fl.fl_id 
																	and ${parameters['bl_idForTotalCal']} AND ${parameters['fl_idForTotalCal']} AND ${parameters['rm_idForTotalCal']}
																	and ${parameters['dp_idForTotalCal']} AND ${parameters['dv_idForTotalCal']} AND ${parameters['organizationUnassignedForTotalCal']} 
																	and ${parameters['rm_catForTotalCal']} AND ${parameters['rm_typeForTotalCal']} AND ${parameters['typeUnassignedForTotalCal']} 
																	and  ${parameters['occupancyForTotalCal']}
																	and (rm.rm_cat IS NULL OR EXISTS (SELECT 1 FROM rmcat WHERE  rm.rm_cat= rmcat.rm_cat AND rmcat.used_in_calcs !='no_totals'))
													)${parameters['totalCount']} 
				)  
		AND ( rm.rm_cat IS NULL 
					OR EXISTS (SELECT 1 FROM rmcat WHERE rm.rm_cat= rmcat.rm_cat AND rmcat.used_in_calcs !='no_totals')
			 )
		"/>
		<!-- Restriction parameters for rooms-->
		<parameter name="bl_id" dataType="verbatim" value="1=1"/>
		<parameter name="fl_id" dataType="verbatim" value="1=1"/>
		<parameter name="rm_id" dataType="verbatim" value="1=1"/>
		<parameter name="dv_id" dataType="verbatim" value="1=1"/>
		<parameter name="dp_id" dataType="verbatim" value="1=1"/>
		<parameter name="organizationUnassigned" dataType="verbatim" value="1=1"/>
		<parameter name="rm_cat" dataType="verbatim" value="1=1"/>
		<parameter name="rm_type" dataType="verbatim" value="1=1"/>
		<parameter name="typeUnassigned" dataType="verbatim" value="1=1"/>
		<parameter name="totalArea" dataType="verbatim" value="&gt;-1"/>
		<parameter name="totalCount" dataType="verbatim" value="&gt;-1"/>

		<!-- Below restriction parameters are for total area and room count calculation -->
		<parameter name="occupancy" dataType="verbatim" value="1=1"/>
		<parameter name="bl_idForTotalCal" dataType="verbatim" value="1=1"/>
		<parameter name="fl_idForTotalCal" dataType="verbatim" value="1=1"/>
		<parameter name="rm_idForTotalCal" dataType="verbatim" value="1=1"/>
		<parameter name="dv_idForTotalCal" dataType="verbatim" value="1=1"/>
		<parameter name="dp_idForTotalCal" dataType="verbatim" value="1=1"/>
		<parameter name="organizationUnassignedForTotalCal" dataType="verbatim" value="1=1"/>
		<parameter name="rm_catForTotalCal" dataType="verbatim" value="1=1"/>
		<parameter name="rm_typeForTotalCal" dataType="verbatim" value="1=1"/>
		<parameter name="typeUnassignedForTotalCal" dataType="verbatim" value="1=1"/>
		<parameter name="occupancyForTotalCal" dataType="verbatim" value="1=1"/>
	</dataSource>

	<!-- Highlight By Room Type for Export Report-->
	<dataSource id="highlightTypesDs" type="DrawingControlHighlight">
		<title>Room Types</title>
		<table name="rm" role="main"/>
		<table name="rmtype" role="standard"/>
		<field table="rm" name = "bl_id"/>
		<field table="rm" name = "fl_id"/>
		<field table="rm" name = "rm_id"/>
		<field table="rmtype" name ="rm_type" legendKey="true"/>
		<field table="rmtype" name="hpattern_acad"/>

		<restriction type="sql" sql="
         ${parameters['bl_id']} AND ${parameters['fl_id']} AND ${parameters['rm_id']}
        AND ${parameters['dp_id']} AND ${parameters['dv_id']} AND ${parameters['organizationUnassigned']} 
        AND ${parameters['rm_cat']} AND ${parameters['rm_type']} AND ${parameters['typeUnassigned']} 
        AND ${parameters['occupancy']}  
        AND exists ( select 1 from fl 
												where rm.bl_id=fl.bl_id and rm.fl_id=fl.fl_id 
												and (select sum(r.area) from rm ${sql.as} r
																	where r.bl_id=fl.bl_id and r.fl_id=fl.fl_id 
																	and ${parameters['bl_idForTotalCal']} AND ${parameters['fl_idForTotalCal']} AND ${parameters['rm_idForTotalCal']}
																	and ${parameters['dp_idForTotalCal']} AND ${parameters['dv_idForTotalCal']} AND ${parameters['organizationUnassignedForTotalCal']} 
																	and ${parameters['rm_catForTotalCal']} AND ${parameters['rm_typeForTotalCal']} AND ${parameters['typeUnassignedForTotalCal']} 
																	and  ${parameters['occupancyForTotalCal']}
																	and (rm.rm_cat IS NULL OR EXISTS (SELECT 1 FROM rmcat WHERE  rm.rm_cat= rmcat.rm_cat AND rmcat.used_in_calcs !='no_totals'))
														)${parameters['totalArea']} 
				)  
        AND exists ( select 1 from fl 
											where rm.bl_id=fl.bl_id and rm.fl_id=fl.fl_id 
											and (select count(1) from rm ${sql.as} r  
																	where r.bl_id=fl.bl_id and r.fl_id=fl.fl_id 
																	and ${parameters['bl_idForTotalCal']} AND ${parameters['fl_idForTotalCal']} AND ${parameters['rm_idForTotalCal']}
																	and ${parameters['dp_idForTotalCal']} AND ${parameters['dv_idForTotalCal']} AND ${parameters['organizationUnassignedForTotalCal']} 
																	and ${parameters['rm_catForTotalCal']} AND ${parameters['rm_typeForTotalCal']} AND ${parameters['typeUnassignedForTotalCal']} 
																	and  ${parameters['occupancyForTotalCal']}
																	and (rm.rm_cat IS NULL OR EXISTS (SELECT 1 FROM rmcat WHERE  rm.rm_cat= rmcat.rm_cat AND rmcat.used_in_calcs !='no_totals'))
													)${parameters['totalCount']} 
				)  
		AND ( rm.rm_cat IS NULL 
					OR EXISTS (SELECT 1 FROM rmcat WHERE rm.rm_cat= rmcat.rm_cat AND rmcat.used_in_calcs !='no_totals')
			 )
		"/>
		<!-- Restriction parameters for rooms-->
		<parameter name="bl_id" dataType="verbatim" value="1=1"/>
		<parameter name="fl_id" dataType="verbatim" value="1=1"/>
		<parameter name="rm_id" dataType="verbatim" value="1=1"/>
		<parameter name="dv_id" dataType="verbatim" value="1=1"/>
		<parameter name="dp_id" dataType="verbatim" value="1=1"/>
		<parameter name="organizationUnassigned" dataType="verbatim" value="1=1"/>
		<parameter name="rm_cat" dataType="verbatim" value="1=1"/>
		<parameter name="rm_type" dataType="verbatim" value="1=1"/>
		<parameter name="typeUnassigned" dataType="verbatim" value="1=1"/>
		<parameter name="totalArea" dataType="verbatim" value="&gt;-1"/>
		<parameter name="totalCount" dataType="verbatim" value="&gt;-1"/>

		<!-- Below restriction parameters are for total area and room count calculation -->
		<parameter name="occupancy" dataType="verbatim" value="1=1"/>
		<parameter name="bl_idForTotalCal" dataType="verbatim" value="1=1"/>
		<parameter name="fl_idForTotalCal" dataType="verbatim" value="1=1"/>
		<parameter name="rm_idForTotalCal" dataType="verbatim" value="1=1"/>
		<parameter name="dv_idForTotalCal" dataType="verbatim" value="1=1"/>
		<parameter name="dp_idForTotalCal" dataType="verbatim" value="1=1"/>
		<parameter name="organizationUnassignedForTotalCal" dataType="verbatim" value="1=1"/>
		<parameter name="rm_catForTotalCal" dataType="verbatim" value="1=1"/>
		<parameter name="rm_typeForTotalCal" dataType="verbatim" value="1=1"/>
		<parameter name="typeUnassignedForTotalCal" dataType="verbatim" value="1=1"/>
		<parameter name="occupancyForTotalCal" dataType="verbatim" value="1=1"/>
	</dataSource>

	<!-- Highlight By Room Occupancy for Export Report-->
    <dataSource id="highlightEmployeesDs" type="DrawingControlHighlight">
        <title>Occupancy</title>
        <table name="rm" role="main"/>
        <field table="rm" name = "bl_id"/>
        <field table="rm" name = "fl_id"/>
        <field table="rm" name = "rm_id"/>
        <field table="rm" name = "countEm" dataType="text" legendKey="true">
         <sql dialect="generic">
              CASE 
                WHEN 
                   exists (select 1 from rmcat where rmcat.rm_cat = rm.rm_cat AND rmcat.occupiable = 0) OR rm.cap_em = 0
              THEN '0'
                  WHEN 
                    exists (select 1 from rmcat where rmcat.rm_cat = rm.rm_cat AND rmcat.occupiable = 1) AND rm.cap_em > 0 
                    AND 0 = (SELECT COUNT(1) FROM em WHERE em.bl_id = rm.bl_id AND em.fl_id = rm.fl_id AND em.rm_id = rm.rm_id)
              THEN '1' 
                  WHEN 
                    exists (select 1 from rmcat where rmcat.rm_cat = rm.rm_cat AND rmcat.occupiable = 1) AND rm.cap_em > 0 
                    AND rm.cap_em &gt; (SELECT COUNT(1) FROM em WHERE em.bl_id = rm.bl_id AND em.fl_id = rm.fl_id AND em.rm_id = rm.rm_id)
              THEN '2' 
                  WHEN 
                    exists (select 1 from rmcat where rmcat.rm_cat = rm.rm_cat AND rmcat.occupiable = 1) AND rm.cap_em > 0 
                    AND rm.cap_em = (SELECT COUNT(1) FROM em WHERE em.bl_id = rm.bl_id AND em.fl_id = rm.fl_id AND em.rm_id = rm.rm_id)
              THEN '3' 
                  WHEN 
                   exists (select 1 from rmcat where rmcat.rm_cat = rm.rm_cat AND rmcat.occupiable = 1) AND rm.cap_em > 0 
                    AND rm.cap_em &lt; (SELECT COUNT(1) FROM em WHERE em.bl_id = rm.bl_id AND em.fl_id = rm.fl_id AND em.rm_id = rm.rm_id)
              THEN '4' 
               END 
            </sql>
     </field>
		<field table="rm" name="hpattern_acad" dataType="text">
            <sql dialect="generic">
			  CASE 
				WHEN 
				   exists (select 1 from rmcat where rmcat.rm_cat = rm.rm_cat AND rmcat.occupiable = 0) OR rm.cap_em = 0
			  THEN '14 0 7 13421772'
				  WHEN 
					exists (select 1 from rmcat where rmcat.rm_cat = rm.rm_cat AND rmcat.occupiable = 1) AND rm.cap_em > 0 
					AND 0 = (SELECT COUNT(1) FROM em WHERE em.bl_id = rm.bl_id AND em.fl_id = rm.fl_id AND em.rm_id = rm.rm_id)
			  THEN  '14 0 3 65280' 
				  WHEN 
					exists (select 1 from rmcat where rmcat.rm_cat = rm.rm_cat AND rmcat.occupiable = 1) AND rm.cap_em > 0 
					AND rm.cap_em &gt; (SELECT COUNT(1) FROM em WHERE em.bl_id = rm.bl_id AND em.fl_id = rm.fl_id AND em.rm_id = rm.rm_id)
			  THEN '14 0 5 255' 
				  WHEN 
					exists (select 1 from rmcat where rmcat.rm_cat = rm.rm_cat AND rmcat.occupiable = 1) AND rm.cap_em > 0 
					AND rm.cap_em = (SELECT COUNT(1) FROM em WHERE em.bl_id = rm.bl_id AND em.fl_id = rm.fl_id AND em.rm_id = rm.rm_id)
			  THEN '14 0 2 16776960' 
				  WHEN 
				   exists (select 1 from rmcat where rmcat.rm_cat = rm.rm_cat AND rmcat.occupiable = 1) AND rm.cap_em > 0 
					AND rm.cap_em &lt; (SELECT COUNT(1) FROM em WHERE em.bl_id = rm.bl_id AND em.fl_id = rm.fl_id AND em.rm_id = rm.rm_id)
			  THEN '14 0 1 16711680' 
			   END 
            </sql>
        </field>
		<restriction type="sql" sql="
         ${parameters['bl_id']} AND ${parameters['fl_id']} AND ${parameters['rm_id']}
        AND ${parameters['dp_id']} AND ${parameters['dv_id']} AND ${parameters['organizationUnassigned']} 
        AND ${parameters['rm_cat']} AND ${parameters['rm_type']} AND ${parameters['typeUnassigned']} 
        AND ${parameters['occupancy']}  
        AND exists ( select 1 from fl 
												where rm.bl_id=fl.bl_id and rm.fl_id=fl.fl_id 
												and (select sum(r.area) from rm ${sql.as} r
																	where r.bl_id=fl.bl_id and r.fl_id=fl.fl_id 
																	and ${parameters['bl_idForTotalCal']} AND ${parameters['fl_idForTotalCal']} AND ${parameters['rm_idForTotalCal']}
																	and ${parameters['dp_idForTotalCal']} AND ${parameters['dv_idForTotalCal']} AND ${parameters['organizationUnassignedForTotalCal']} 
																	and ${parameters['rm_catForTotalCal']} AND ${parameters['rm_typeForTotalCal']} AND ${parameters['typeUnassignedForTotalCal']} 
																	and  ${parameters['occupancyForTotalCal']}
																	and (rm.rm_cat IS NULL OR EXISTS (SELECT 1 FROM rmcat WHERE  rm.rm_cat= rmcat.rm_cat AND rmcat.used_in_calcs !='no_totals'))
														)${parameters['totalArea']} 
				)  
        AND exists ( select 1 from fl 
											where rm.bl_id=fl.bl_id and rm.fl_id=fl.fl_id 
											and (select count(1) from rm ${sql.as} r  
																	where r.bl_id=fl.bl_id and r.fl_id=fl.fl_id 
																	and ${parameters['bl_idForTotalCal']} AND ${parameters['fl_idForTotalCal']} AND ${parameters['rm_idForTotalCal']}
																	and ${parameters['dp_idForTotalCal']} AND ${parameters['dv_idForTotalCal']} AND ${parameters['organizationUnassignedForTotalCal']} 
																	and ${parameters['rm_catForTotalCal']} AND ${parameters['rm_typeForTotalCal']} AND ${parameters['typeUnassignedForTotalCal']} 
																	and  ${parameters['occupancyForTotalCal']}
																	and (rm.rm_cat IS NULL OR EXISTS (SELECT 1 FROM rmcat WHERE  rm.rm_cat= rmcat.rm_cat AND rmcat.used_in_calcs !='no_totals'))
													)${parameters['totalCount']} 
				)  
		AND ( rm.rm_cat IS NULL 
					OR EXISTS (SELECT 1 FROM rmcat WHERE rm.rm_cat= rmcat.rm_cat AND rmcat.used_in_calcs !='no_totals')
			 )
		"/>
		<!-- Restriction parameters for rooms-->
		<parameter name="bl_id" dataType="verbatim" value="1=1"/>
		<parameter name="fl_id" dataType="verbatim" value="1=1"/>
		<parameter name="rm_id" dataType="verbatim" value="1=1"/>
		<parameter name="dv_id" dataType="verbatim" value="1=1"/>
		<parameter name="dp_id" dataType="verbatim" value="1=1"/>
		<parameter name="organizationUnassigned" dataType="verbatim" value="1=1"/>
		<parameter name="rm_cat" dataType="verbatim" value="1=1"/>
		<parameter name="rm_type" dataType="verbatim" value="1=1"/>
		<parameter name="typeUnassigned" dataType="verbatim" value="1=1"/>
		<parameter name="totalArea" dataType="verbatim" value="&gt;-1"/>
		<parameter name="totalCount" dataType="verbatim" value="&gt;-1"/>

		<!-- Below restriction parameters are for total area and room count calculation -->
		<parameter name="occupancy" dataType="verbatim" value="1=1"/>
		<parameter name="bl_idForTotalCal" dataType="verbatim" value="1=1"/>
		<parameter name="fl_idForTotalCal" dataType="verbatim" value="1=1"/>
		<parameter name="rm_idForTotalCal" dataType="verbatim" value="1=1"/>
		<parameter name="dv_idForTotalCal" dataType="verbatim" value="1=1"/>
		<parameter name="dp_idForTotalCal" dataType="verbatim" value="1=1"/>
		<parameter name="organizationUnassignedForTotalCal" dataType="verbatim" value="1=1"/>
		<parameter name="rm_catForTotalCal" dataType="verbatim" value="1=1"/>
		<parameter name="rm_typeForTotalCal" dataType="verbatim" value="1=1"/>
		<parameter name="typeUnassignedForTotalCal" dataType="verbatim" value="1=1"/>
		<parameter name="occupancyForTotalCal" dataType="verbatim" value="1=1"/>
    </dataSource>

  <!-- Teams -->
  <dataSource id="highlightTeamDs" type="DrawingControlHighlight">
     <title>Teams</title>
     <table name="rm" role="main"/>
     <table name="dv" role="standard"/>
     <table name="rmcat" role="standard"/>
     <field table="rm" name = "bl_id"/>
     <field table="rm" name = "fl_id"/>
     <field table="rm" name = "rm_id"/>
     <field name="team_id" dataType="text" legendKey="true">
            <sql dialect="generic">
                ( CASE WHEN EXISTS ( SELECT (team_properties.team_id) FROM rm_team, team_properties 
												  WHERE  rm_team.bl_id=rm.bl_id and rm_team.fl_id=rm.fl_id and rm_team.rm_id=rm.rm_id 
															 AND rm_team.team_id=team_properties.team_id and team_properties.needs_team_space=1 ) 
				THEN		( select MAX(team_properties.team_id) FROM rm_team, team_properties 
														where  rm_team.bl_id=rm.bl_id and rm_team.fl_id=rm.fl_id and rm_team.rm_id=rm.rm_id 
														and rm_team.team_id=team_properties.team_id and team_properties.needs_team_space=1 )
				ELSE null  
				END)
			</sql>
	</field>    
     <field name="hpattern_acad" dataType="text">
            <sql dialect="generic">
                ( CASE WHEN EXISTS ( SELECT (team_properties.hpattern_acad) FROM rm_team, team_properties 
												  WHERE  rm_team.bl_id=rm.bl_id and rm_team.fl_id=rm.fl_id and rm_team.rm_id=rm.rm_id 
															 AND rm_team.team_id=team_properties.team_id and team_properties.needs_team_space=1 ) 
				THEN		( select MAX(team_properties.hpattern_acad) FROM rm_team, team_properties 
														where  rm_team.bl_id=rm.bl_id and rm_team.fl_id=rm.fl_id and rm_team.rm_id=rm.rm_id 
														and rm_team.team_id=team_properties.team_id and team_properties.needs_team_space=1 )
				ELSE '14 0 7 13421772' 
				END)
			</sql>
	</field>    
     <restriction type="sql" sql="
           ( (${parameters['dp_id']} AND ${parameters['dv_id']} ) AND (${parameters['organizationUnassigned']})
                )
            AND ${parameters['bl_id']}
            AND ${parameters['fl_id']}
            AND ${parameters['rm_id']}
            AND
             (
               (${parameters['rm_cat']} AND ${parameters['rm_type']} ) AND (${parameters['typeUnassigned']})
            )
            
            AND ${parameters['occupancy']} AND ${parameters['rm_std']} AND ${parameters['excludedHotalableRm']} 
			AND exists ( select 1 from rm_team where rm_team.bl_id=rm.bl_id and rm_team.fl_id=rm.fl_id and rm_team.rm_id=rm.rm_id 
																	and (rm_team.date_start is null or ${sql.yearMonthDayOf('rm_team.date_start')} &lt;= ${parameters['asOfDate']})
																	and (rm_team.date_end is null or ${sql.yearMonthDayOf('rm_team.date_end')} &gt;= ${parameters['asOfDate']}) 
																	and ${parameters['teamIdRestriction']}
					)
        "/> 
        
        <parameter name="dv_id" dataType="verbatim" value="1=1"/>
        <parameter name="dp_id" dataType="verbatim" value="1=1"/>
        <parameter name="bl_id" dataType="verbatim" value="1=1"/>
        <parameter name="fl_id" dataType="verbatim" value="1=1"/>
        <parameter name="rm_id" dataType="verbatim" value="1=1"/>
        <parameter name="rm_cat" dataType="verbatim" value="1=1"/>
        <parameter name="rm_type" dataType="verbatim" value="1=1"/>
        <parameter name="occupancy" dataType="verbatim" value="1=1"/>
        <parameter name="rm_std" dataType="verbatim" value="1=1"/>
        <parameter name="organizationUnassigned" dataType="verbatim" value="1=1"/>
        <parameter name="typeUnassigned" dataType="verbatim" value="1=1"/>
        <parameter name="excludedHotalableRm" dataType="verbatim" value="5=5"/>
        <parameter name="having" dataType="verbatim" value=""/>
        <parameter name="asOfDate" dataType="text" value=""/>
        <parameter name="teamIdRestriction" dataType="verbatim" value=" 1=1 "/>
  </dataSource>

  <!-- Divisions with Teams -->
  <dataSource id="highlightTeamDivisionsDs" type="DrawingControlHighlight">
     <title>Divisions with Teams</title>
     <table name="rm" role="main"/>
     <table name="dv" role="standard"/>
     <table name="rmcat" role="standard"/>
     <field table="rm" name = "bl_id"/>
     <field table="rm" name = "fl_id"/>
     <field table="rm" name = "rm_id"/>
     <field table="dv" name="dv_id" dataType="text" legendKey="true">
            <sql dialect="generic">
	                 ( CASE WHEN EXISTS ( SELECT (dv1.hpattern_acad) FROM rm_team, team_assoc, dv ${sql.as} dv1
														WHERE  rm_team.bl_id=rm.bl_id and rm_team.fl_id=rm.fl_id and rm_team.rm_id=rm.rm_id 
															 and rm_team.team_id=team_assoc.team_id and team_assoc.dv_id=dv1.dv_id 
															 and (team_assoc.date_start is null or ${sql.yearMonthDayOf('team_assoc.date_start')} &lt;= ${parameters['asOfDate']})
															 and (team_assoc.date_end is null or ${sql.yearMonthDayOf('team_assoc.date_end')} &gt;= ${parameters['asOfDate']}) 
															and ${parameters['teamIdRestriction']} )
				THEN		CASE WHEN 1=( select count(distinct dv1.hpattern_acad) from rm_team, team_assoc, dv ${sql.as} dv1
															  where  rm_team.bl_id=rm.bl_id and rm_team.fl_id=rm.fl_id and rm_team.rm_id=rm.rm_id 
															 AND rm_team.team_id=team_assoc.team_id AND team_assoc.dv_id=dv1.dv_id 
															 and (team_assoc.date_start is null or ${sql.yearMonthDayOf('team_assoc.date_start')} &lt;= ${parameters['asOfDate']})
															 and (team_assoc.date_end is null or ${sql.yearMonthDayOf('team_assoc.date_end')} &gt;= ${parameters['asOfDate']}) 
															and ${parameters['teamIdRestriction']} )
								THEN	( select MAX(dv1.dv_id) FROM rm_team, team_assoc, dv ${sql.as} dv1
														where  rm_team.bl_id=rm.bl_id and rm_team.fl_id=rm.fl_id and rm_team.rm_id=rm.rm_id 
														and rm_team.team_id=team_assoc.team_id and team_assoc.dv_id=dv1.dv_id 
														 and (team_assoc.date_start is null or ${sql.yearMonthDayOf('team_assoc.date_start')} &lt;= ${parameters['asOfDate']})
														 and (team_assoc.date_end is null or ${sql.yearMonthDayOf('team_assoc.date_end')} &gt;= ${parameters['asOfDate']}) 
														and ${parameters['teamIdRestriction']} )
								ELSE '' 
								END
				ELSE dv.dv_id 
				END)	
			</sql>
	</field>    

     <field name="hpattern_acad" dataType="text">
            <sql dialect="generic">
                ( CASE WHEN EXISTS ( SELECT (dv1.hpattern_acad) FROM rm_team, team_assoc, dv ${sql.as} dv1
												  WHERE  rm_team.bl_id=rm.bl_id and rm_team.fl_id=rm.fl_id and rm_team.rm_id=rm.rm_id 
															 AND rm_team.team_id=team_assoc.team_id AND team_assoc.dv_id=dv1.dv_id 
															 and (team_assoc.date_start is null or ${sql.yearMonthDayOf('team_assoc.date_start')} &lt;= ${parameters['asOfDate']})
															 and (team_assoc.date_end is null or ${sql.yearMonthDayOf('team_assoc.date_end')} &gt;= ${parameters['asOfDate']}) 
															and ${parameters['teamIdRestriction']} )

				THEN		CASE WHEN 1=( select count(distinct dv1.hpattern_acad) from rm_team, team_assoc, dv ${sql.as} dv1
															  where  rm_team.bl_id=rm.bl_id and rm_team.fl_id=rm.fl_id and rm_team.rm_id=rm.rm_id 
															 AND rm_team.team_id=team_assoc.team_id AND team_assoc.dv_id=dv1.dv_id 
															 and (team_assoc.date_start is null or ${sql.yearMonthDayOf('team_assoc.date_start')} &lt;= ${parameters['asOfDate']})
															 and (team_assoc.date_end is null or ${sql.yearMonthDayOf('team_assoc.date_end')} &gt;= ${parameters['asOfDate']}) 
															and ${parameters['teamIdRestriction']} )
								THEN	( select MAX(dv1.hpattern_acad) FROM rm_team, team_assoc, dv ${sql.as} dv1
														where  rm_team.bl_id=rm.bl_id and rm_team.fl_id=rm.fl_id and rm_team.rm_id=rm.rm_id 
														and rm_team.team_id=team_assoc.team_id and team_assoc.dv_id=dv1.dv_id 
															 and (team_assoc.date_start is null or ${sql.yearMonthDayOf('team_assoc.date_start')} &lt;= ${parameters['asOfDate']})
															 and (team_assoc.date_end is null or ${sql.yearMonthDayOf('team_assoc.date_end')} &gt;= ${parameters['asOfDate']}) 
															and ${parameters['teamIdRestriction']} )
								ELSE '14 0 7 13421772' 
								END
				ELSE dv.hpattern_acad 
				END )
			</sql>
	</field>    
     <restriction type="sql" sql="
           ( (${parameters['dp_id']} AND ${parameters['dv_id']} ) AND (${parameters['organizationUnassigned']})
                )
            AND ${parameters['bl_id']}
            AND ${parameters['fl_id']}
            AND ${parameters['rm_id']}
            AND
             (
               (${parameters['rm_cat']} AND ${parameters['rm_type']} ) AND (${parameters['typeUnassigned']})
            )
            AND ${parameters['occupancy']} AND ${parameters['rm_std']} AND ${parameters['excludedHotalableRm']}
        "/> 
        
        <parameter name="dv_id" dataType="verbatim" value="1=1"/>
        <parameter name="dp_id" dataType="verbatim" value="1=1"/>
        <parameter name="bl_id" dataType="verbatim" value="1=1"/>
        <parameter name="fl_id" dataType="verbatim" value="1=1"/>
        <parameter name="rm_id" dataType="verbatim" value="1=1"/>
        <parameter name="rm_cat" dataType="verbatim" value="1=1"/>
        <parameter name="rm_type" dataType="verbatim" value="1=1"/>
        <parameter name="occupancy" dataType="verbatim" value="1=1"/>
        <parameter name="rm_std" dataType="verbatim" value="1=1"/>
        <parameter name="organizationUnassigned" dataType="verbatim" value="1=1"/>
        <parameter name="typeUnassigned" dataType="verbatim" value="1=1"/>
        <parameter name="excludedHotalableRm" dataType="verbatim" value="5=5"/>
        <parameter name="having" dataType="verbatim" value=""/>
        <parameter name="asOfDate" dataType="text" value=""/>
        <parameter name="teamIdRestriction" dataType="verbatim" value=" 1=1 "/>
  </dataSource>

  <!-- Departments with Teams -->
  <dataSource id="highlightTeamDepartmentsDs" type="DrawingControlHighlight">
     <title>Departments with Teams</title>
     <table name="rm" role="main"/>
     <table name="dp" role="standard"/>
     <table name="rmcat" role="standard"/>
     <field table="rm" name = "bl_id"/>
     <field table="rm" name = "fl_id"/>
     <field table="rm" name = "rm_id"/>
     <field table="dp" name="dp_id" dataType="text" legendKey="true">
            <sql dialect="generic">
	                 ( CASE WHEN EXISTS ( SELECT (dp1.hpattern_acad) FROM rm_team, team_assoc, dp ${sql.as} dp1
														WHERE  rm_team.bl_id=rm.bl_id and rm_team.fl_id=rm.fl_id and rm_team.rm_id=rm.rm_id 
															 and rm_team.team_id=team_assoc.team_id and team_assoc.dp_id=dp1.dp_id and team_assoc.dv_id=dp1.dv_id 
															 and (team_assoc.date_start is null or ${sql.yearMonthDayOf('team_assoc.date_start')} &lt;= ${parameters['asOfDate']})
															 and (team_assoc.date_end is null or ${sql.yearMonthDayOf('team_assoc.date_end')} &gt;= ${parameters['asOfDate']}) 
															and ${parameters['teamIdRestriction']} )
				THEN		CASE WHEN 1=( select count(distinct dp1.hpattern_acad) from rm_team, team_assoc, dp ${sql.as} dp1
															  where  rm_team.bl_id=rm.bl_id and rm_team.fl_id=rm.fl_id and rm_team.rm_id=rm.rm_id 
															 AND rm_team.team_id=team_assoc.team_id AND team_assoc.dp_id=dp1.dp_id  and team_assoc.dv_id=dp1.dv_id 
															 and (team_assoc.date_start is null or ${sql.yearMonthDayOf('team_assoc.date_start')} &lt;= ${parameters['asOfDate']})
															 and (team_assoc.date_end is null or ${sql.yearMonthDayOf('team_assoc.date_end')} &gt;= ${parameters['asOfDate']}) 
															and ${parameters['teamIdRestriction']} )
								THEN	( select MAX(dp1.dv_id ${sql.concat} '-' ${sql.concat} dp1.dp_id ) FROM rm_team, team_assoc, dp ${sql.as} dp1
														where  rm_team.bl_id=rm.bl_id and rm_team.fl_id=rm.fl_id and rm_team.rm_id=rm.rm_id 
														and rm_team.team_id=team_assoc.team_id and team_assoc.dp_id=dp1.dp_id  and team_assoc.dv_id=dp1.dv_id 
														 and (team_assoc.date_start is null or ${sql.yearMonthDayOf('team_assoc.date_start')} &lt;= ${parameters['asOfDate']})
														 and (team_assoc.date_end is null or ${sql.yearMonthDayOf('team_assoc.date_end')} &gt;= ${parameters['asOfDate']}) 
														and ${parameters['teamIdRestriction']} )
								ELSE '' 
								END
				ELSE dp.dv_id ${sql.concat} '-' ${sql.concat} dp.dp_id 
				END)	
			</sql>
	</field>    

     <field name="hpattern_acad" dataType="text">
            <sql dialect="generic">
                ( CASE WHEN EXISTS ( SELECT (dp1.hpattern_acad) FROM rm_team, team_assoc, dp ${sql.as} dp1
												  WHERE  rm_team.bl_id=rm.bl_id and rm_team.fl_id=rm.fl_id and rm_team.rm_id=rm.rm_id 
															 AND rm_team.team_id=team_assoc.team_id AND team_assoc.dp_id=dp1.dp_id  and team_assoc.dv_id=dp1.dv_id 
															 and (team_assoc.date_start is null or ${sql.yearMonthDayOf('team_assoc.date_start')} &lt;= ${parameters['asOfDate']})
															 and (team_assoc.date_end is null or ${sql.yearMonthDayOf('team_assoc.date_end')} &gt;= ${parameters['asOfDate']}) 
															and ${parameters['teamIdRestriction']} )

				THEN		CASE WHEN 1=( select count(distinct dp1.hpattern_acad) from rm_team, team_assoc, dp ${sql.as} dp1
															  where  rm_team.bl_id=rm.bl_id and rm_team.fl_id=rm.fl_id and rm_team.rm_id=rm.rm_id 
															 AND rm_team.team_id=team_assoc.team_id AND team_assoc.dp_id=dp1.dp_id  and team_assoc.dv_id=dp1.dv_id 
															 and (team_assoc.date_start is null or ${sql.yearMonthDayOf('team_assoc.date_start')} &lt;= ${parameters['asOfDate']})
															 and (team_assoc.date_end is null or ${sql.yearMonthDayOf('team_assoc.date_end')} &gt;= ${parameters['asOfDate']}) 
															and ${parameters['teamIdRestriction']} )
								THEN	( select MAX(dp1.hpattern_acad) FROM rm_team, team_assoc, dp ${sql.as} dp1
														where  rm_team.bl_id=rm.bl_id and rm_team.fl_id=rm.fl_id and rm_team.rm_id=rm.rm_id 
														and rm_team.team_id=team_assoc.team_id and team_assoc.dp_id=dp1.dp_id  and team_assoc.dv_id=dp1.dv_id 
															 and (team_assoc.date_start is null or ${sql.yearMonthDayOf('team_assoc.date_start')} &lt;= ${parameters['asOfDate']})
															 and (team_assoc.date_end is null or ${sql.yearMonthDayOf('team_assoc.date_end')} &gt;= ${parameters['asOfDate']}) 
															and ${parameters['teamIdRestriction']} )
								ELSE '14 0 7 13421772' 
								END
				ELSE dp.hpattern_acad 
				END )
			</sql>
	</field>    
     <restriction type="sql" sql="
           ( (${parameters['dp_id']} AND ${parameters['dv_id']} ) AND (${parameters['organizationUnassigned']})
                )
            AND ${parameters['bl_id']}
            AND ${parameters['fl_id']}
            AND ${parameters['rm_id']}
            AND
             (
               (${parameters['rm_cat']} AND ${parameters['rm_type']} ) AND (${parameters['typeUnassigned']})
            )
            AND ${parameters['occupancy']} AND ${parameters['rm_std']} AND ${parameters['excludedHotalableRm']}
        "/> 
        
        <parameter name="dv_id" dataType="verbatim" value="1=1"/>
        <parameter name="dp_id" dataType="verbatim" value="1=1"/>
        <parameter name="bl_id" dataType="verbatim" value="1=1"/>
        <parameter name="fl_id" dataType="verbatim" value="1=1"/>
        <parameter name="rm_id" dataType="verbatim" value="1=1"/>
        <parameter name="rm_cat" dataType="verbatim" value="1=1"/>
        <parameter name="rm_type" dataType="verbatim" value="1=1"/>
        <parameter name="occupancy" dataType="verbatim" value="1=1"/>
        <parameter name="rm_std" dataType="verbatim" value="1=1"/>
        <parameter name="organizationUnassigned" dataType="verbatim" value="1=1"/>
        <parameter name="typeUnassigned" dataType="verbatim" value="1=1"/>
        <parameter name="excludedHotalableRm" dataType="verbatim" value="5=5"/>
        <parameter name="having" dataType="verbatim" value=""/>
        <parameter name="asOfDate" dataType="text" value=""/>
        <parameter name="teamIdRestriction" dataType="verbatim" value=" 1=1 "/>
  </dataSource>

  <dataSource id="highlightRoomOccupantDs1" type="DrawingControlHighlight">
     <title>Real Estate Occupant</title>
     <table name="rm" role="main"/>
     <table name="dv" role="standard"/>
     <table name="rmcat" role="standard"/>
	 <table name="uc_rmoccupant" role="standard"/>
     <field table="rm" name = "bl_id"/>
     <field table="rm" name = "fl_id"/>
     <field table="rm" name = "rm_id"/>
     <field table="uc_rmoccupant" name="occupant_id" legendKey="true"/>
	 <field table="uc_rmoccupant" name="name" legendKey="true"/>
     <field table="uc_rmoccupant" name="hpattern_acad"/>
     
     <restriction type="sql" sql="
           ( (${parameters['dp_id']} AND ${parameters['dv_id']} ) AND (${parameters['organizationUnassigned']})
                )
            AND ${parameters['bl_id']}
            AND ${parameters['fl_id']}
            AND ${parameters['rm_id']}
            AND
             (
               (${parameters['rm_cat']} AND ${parameters['rm_type']} ) AND (${parameters['typeUnassigned']})
            )
            
            AND ${parameters['occupancy']} AND ${parameters['rm_std']} AND ${parameters['excludedHotalableRm']}
        "/> 
        
        <parameter name="dv_id" dataType="verbatim" value="1=1"/>
        <parameter name="dp_id" dataType="verbatim" value="1=1"/>
        <parameter name="bl_id" dataType="verbatim" value="1=1"/>
        <parameter name="fl_id" dataType="verbatim" value="1=1"/>
        <parameter name="rm_id" dataType="verbatim" value="1=1"/>
        <parameter name="rm_cat" dataType="verbatim" value="1=1"/>
        <parameter name="rm_type" dataType="verbatim" value="1=1"/>
        <parameter name="occupancy" dataType="verbatim" value="1=1"/>
        <parameter name="rm_std" dataType="verbatim" value="1=1"/>
        <parameter name="organizationUnassigned" dataType="verbatim" value="1=1"/>
        <parameter name="typeUnassigned" dataType="verbatim" value="1=1"/>
        <parameter name="excludedHotalableRm" dataType="verbatim" value="5=5"/>
        <parameter name="having" dataType="verbatim" value=""/>
  </dataSource>


  <!-- Dummy highlight dataSource since highlight dataSource is required by paginated report required -->
  <dataSource id="dummyDs">
     <table name="rm" role="main"/>
     <field table="rm" name = "bl_id"/>
     <field table="rm" name = "fl_id"/>
     <field table="rm" name = "rm_id"/>
     <!-- no record restriction, and this kind highlight dataSource will work because pdfParameters.drawingName = selectedFloor.dwgName; in ab-ex-drawing-rpt-pdf.js -->
     <restriction type="sql" sql="rm.fl_id IS NULL"/>
  </dataSource>

   <!-- label datasources -->
    <!-- Label of Room Divisions for Export Report-->
    <dataSource id="labelDivisionsDs" type="DrawingControlLabels">
        <title>Divisions</title>
        <table name="rm" role="main"/>
        <table name="dv" role="standard"/>
        <table name="dp" role="standard"/>
        <table name="rmcat" role="standard"/>
        <field table="rm" name="bl_id" hidden="true"/>
        <field table="rm" name="fl_id" hidden="true"/>
        <field table="rm" name="dv_id" hidden="true"/>
        <field table="rm" name="rm_id"/>
    </dataSource>

	<!-- Label of Room Departments for Export Report-->
	<dataSource id="labelDepartmentDs" type="DrawingControlLabels">
		<title>Departments</title>
		<table name="rm" role="main"/>
		<table name="dp" role="standard"/>
		<field table="rm" name="bl_id" hidden="true"/>
		<field table="rm" name="fl_id" hidden="true"/>
		<field table="rm" name="dv_id" hidden="true"/>
		<field table="rm" name="dp_id" hidden="true"/>
		<field table="rm" name="rm_id"/>
		<parameter name="occupancy" dataType="verbatim" value="1=1"/>
		<restriction type="sql" sql="${parameters['occupancy']}"/>
	</dataSource>

	<!-- Label of Room Super Categories for Export Report-->
    <dataSource id="labelSuperCategoriesDs" type="DrawingControlLabels">
        <title>Room Super Categories</title>
        <table name="rm" role="main"/>
        <table name="rmcat" role="standard"/>
        <field name="bl_id" hidden="true"/>
        <field name="fl_id" hidden="true"/>
        <field name="rm_id"/>
        <field table="rmcat" name="supercat"/>
    
        <parameter name="occupancy" dataType="verbatim" value="1=1"/>
        <parameter name="occupancyForTotalCal" dataType="verbatim" value="1=1"/>
        <parameter name="organizationUnassigned" dataType="verbatim" value="1=1"/>
        <restriction type="sql" sql="${parameters['occupancy']}"/>
    </dataSource>

	<!-- Label of Room Categories for Export Report-->
	<dataSource id="labelCategoriesDs" type="DrawingControlLabels">
		<title>Room Categories</title>
		<table name="rm" role="main"/>
		<field name="bl_id" hidden="true"/>
		<field name="fl_id" hidden="true"/>
		<field name="rm_id"/>
		<field name="rm_cat"/>
		<parameter name="occupancy" dataType="verbatim" value="1=1"/>
		<restriction type="sql" sql="${parameters['occupancy']}"/>
	</dataSource>

	<!-- Label of Room Types for Export Report-->
	<dataSource id="labelTypesDs" type="DrawingControlLabels">
		<title>Room Types</title>
		<table name="rm" role="main"/>
		<table name="rmtype" role="standard"/>
		<field name="bl_id" hidden="true"/>
		<field name="fl_id" hidden="true"/>
		<field table="rm" name = "rm_id"/>
		<field name="rm_cat"/>
		<field table="rmtype" name ="rm_type"/>
		<parameter name="occupancy" dataType="verbatim" value="1=1"/>
		<restriction type="sql" sql="${parameters['occupancy']}"/> 
	</dataSource>

	<!-- Label of Employee Names for Export Report-->
	<dataSource id="labelEmployeesDs" type="DrawingControlLabels">
		<title>Employees</title>
		<sql dialect="generic">
			SELECT  rm.dwgname, em.em_id ${sql.as} em_id, rm.bl_id ${sql.as} bl_id, rm.fl_id ${sql.as} fl_id, rm.rm_id ${sql.as} rm_id, 
							rm.dv_id ${sql.as} dv_id, rm.dp_id ${sql.as} dp_id,
							rm.rm_cat ${sql.as} rm_cat, rm.rm_type ${sql.as} rm_type, rm.cap_em ${sql.as} cap_em 
			FROM em RIGHT JOIN rm ON em.bl_id = rm.bl_id AND em.fl_id = rm.fl_id AND em.rm_id = rm.rm_id 
		</sql>
		<table name="rm"/>
		<field table="rm" name="bl_id" hidden="true"/>
		<field table="rm" name="fl_id" hidden="true"/>
		<field table="rm" name="rm_id"/>
		<field table="rm" name="em_id" dataType="text"/>

		<parameter name="occupancy" dataType="verbatim" value="1=1"/>
		<restriction type="sql" sql="${parameters['occupancy']}"/>
	</dataSource>

	<!-- Label of Room Number for Export Report-->
	<dataSource id="labelRoomNumberDs" type="DrawingControlLabels">
		<title>Room Number</title>
		<table name="rm" role="main"/>
		<field table="rm" name="rm_id"/>
	</dataSource>

  <!-- Dummy label dataSource -->
	<dataSource id="labelNoneDs" type="DrawingControlLabels">
		<title>None</title>
		<table name="rm" role="main"/>
		<field name="bl_id" hidden="true"/>
		<field name="fl_id" hidden="true"/>
	</dataSource>

    <dataSource id="labelRoomStandardDs" type="DrawingControlLabels">
        <title>Room Standard</title>
        <table name="rm" role="main"/>
        <table name="rmstd" role="standard"/>
        <field table="rm" name="bl_id" hidden="true"/>
        <field table="rm" name="fl_id" hidden="true"/>
        <field table="rmstd" name="rm_std" hidden="true"/>
        
        <field table="rm" name="rm_id"/>
        <field table="rmstd" name="rm_std"/>
    </dataSource>

    <!-- Teams -->
    <dataSource id="labelTeamsDs" type="DrawingControlLabels">
        <title>Teams</title>
        <table name="rm" role="main"/>
        <field table="rm" name="bl_id" hidden="true"/>
        <field table="rm" name="fl_id" hidden="true"/>

        <field table="rm" name="rm_id"/>
		<field table="rm" name="team_id" dataType="text">
			<sql dialect="generic">
				( CASE WHEN EXISTS ( SELECT (team_properties.team_id) FROM rm_team, team_properties 
												  WHERE  rm_team.bl_id=rm.bl_id and rm_team.fl_id=rm.fl_id and rm_team.rm_id=rm.rm_id 
															 AND rm_team.team_id=team_properties.team_id and team_properties.needs_team_space=1 ) 
				THEN		( select MAX(team_properties.team_id) FROM rm_team, team_properties 
														where  rm_team.bl_id=rm.bl_id and rm_team.fl_id=rm.fl_id and rm_team.rm_id=rm.rm_id 
														and rm_team.team_id=team_properties.team_id and team_properties.needs_team_space=1 )
				ELSE null   
				END)
			</sql>
		</field>    
		<field table="rm" name="dateRange" dataType="text">
			<sql dialect="generic">
				( CASE WHEN EXISTS ( SELECT (team_properties.team_id) FROM rm_team, team_properties 
												  WHERE  rm_team.bl_id=rm.bl_id and rm_team.fl_id=rm.fl_id and rm_team.rm_id=rm.rm_id 
															 AND rm_team.team_id=team_properties.team_id and team_properties.needs_team_space=1 ) 
				THEN		( select MAX( ${sql.yearMonthDayOf('rm_team.date_start')} 
														${sql.concat} '-' ${sql.concat} 
														( case when rm_team.date_end is null then  '' else ${sql.yearMonthDayOf('rm_team.date_end')} end) 
												)  
										FROM rm_team, team_properties 
										where  rm_team.bl_id=rm.bl_id and rm_team.fl_id=rm.fl_id and rm_team.rm_id=rm.rm_id 
										and rm_team.team_id=team_properties.team_id and team_properties.needs_team_space=1 )
				ELSE null   
				END)
			</sql>
		</field>    
    </dataSource>

  <!-- Divisions with Teams -->
	<dataSource id="labelTeamDivisionsDs" type="DrawingControlLabels">
		<title>Divisions with Teams</title>
		<table name="rm" role="main"/>
		<table name="dv" role="standard"/>
		<table name="rmcat" role="standard"/>

		<field table="rm" name="bl_id" hidden="true"/>
		<field table="rm" name="fl_id" hidden="true"/>
		<field table="rm" name="dv_id" hidden="true"/>
		<field table="rm" name="dp_id" hidden="true"/>

		<field table="rm" name = "rm_id"/>
		<field table="dv" name="dv_id" dataType="text">
			<sql dialect="generic">
					 ( CASE WHEN EXISTS ( SELECT (dv1.dv_id) FROM rm_team, team_assoc, dv ${sql.as} dv1
														WHERE  rm_team.bl_id=rm.bl_id and rm_team.fl_id=rm.fl_id and rm_team.rm_id=rm.rm_id 
															 and rm_team.team_id=team_assoc.team_id and team_assoc.dv_id=dv1.dv_id 
															 and (team_assoc.date_start is null or ${sql.yearMonthDayOf('team_assoc.date_start')} &lt;= ${parameters['asOfDate']})
															 and (team_assoc.date_end is null or ${sql.yearMonthDayOf('team_assoc.date_end')} &gt;= ${parameters['asOfDate']}) 
															and ${parameters['teamIdRestriction']} )
				THEN		CASE WHEN 1=( select count(distinct dv1.dv_id) from rm_team, team_assoc, dv ${sql.as} dv1
															  where  rm_team.bl_id=rm.bl_id and rm_team.fl_id=rm.fl_id and rm_team.rm_id=rm.rm_id 
															 AND rm_team.team_id=team_assoc.team_id AND team_assoc.dv_id=dv1.dv_id 
															 and (team_assoc.date_start is null or ${sql.yearMonthDayOf('team_assoc.date_start')} &lt;= ${parameters['asOfDate']})
															 and (team_assoc.date_end is null or ${sql.yearMonthDayOf('team_assoc.date_end')} &gt;= ${parameters['asOfDate']}) 
															and ${parameters['teamIdRestriction']} )
								THEN	( select MAX(dv1.dv_id) FROM rm_team, team_assoc, dv ${sql.as} dv1
														where  rm_team.bl_id=rm.bl_id and rm_team.fl_id=rm.fl_id and rm_team.rm_id=rm.rm_id 
														and rm_team.team_id=team_assoc.team_id and team_assoc.dv_id=dv1.dv_id 
														 and (team_assoc.date_start is null or ${sql.yearMonthDayOf('team_assoc.date_start')} &lt;= ${parameters['asOfDate']})
														 and (team_assoc.date_end is null or ${sql.yearMonthDayOf('team_assoc.date_end')} &gt;= ${parameters['asOfDate']}) 
														and ${parameters['teamIdRestriction']} )
								ELSE 'MULTIPLE' 
								END
				ELSE dv.dv_id 
				END)	
			</sql>
		</field>            
		<field table="rm" name="dateRange" dataType="text">
			<sql dialect="generic">
				 ( CASE WHEN EXISTS ( SELECT (team_assoc.team_assoc_id) FROM rm_team, team_assoc, dv ${sql.as} dv1
														WHERE  rm_team.bl_id=rm.bl_id and rm_team.fl_id=rm.fl_id and rm_team.rm_id=rm.rm_id 
															 and rm_team.team_id=team_assoc.team_id and team_assoc.dv_id=dv1.dv_id 
															 and (team_assoc.date_start is null or ${sql.yearMonthDayOf('team_assoc.date_start')} &lt;= ${parameters['asOfDate']})
															 and (team_assoc.date_end is null or ${sql.yearMonthDayOf('team_assoc.date_end')} &gt;= ${parameters['asOfDate']}) 
															and ${parameters['teamIdRestriction']} )
				THEN		CASE WHEN 1=( select count(team_assoc.team_assoc_id) from rm_team, team_assoc, dv ${sql.as} dv1
															  where  rm_team.bl_id=rm.bl_id and rm_team.fl_id=rm.fl_id and rm_team.rm_id=rm.rm_id 
															 AND rm_team.team_id=team_assoc.team_id AND team_assoc.dv_id=dv1.dv_id 
															 and (team_assoc.date_start is null or ${sql.yearMonthDayOf('team_assoc.date_start')} &lt;= ${parameters['asOfDate']})
															 and (team_assoc.date_end is null or ${sql.yearMonthDayOf('team_assoc.date_end')} &gt;= ${parameters['asOfDate']}) 
															and ${parameters['teamIdRestriction']} )
								THEN	( select MAX( ${sql.yearMonthDayOf('team_assoc.date_start')} 
																	${sql.concat} '-' ${sql.concat} 
																	( case when team_assoc.date_end is null then  '' else ${sql.yearMonthDayOf('team_assoc.date_end')} end) 
																) 
														FROM rm_team, team_assoc, dv ${sql.as} dv1
														where  rm_team.bl_id=rm.bl_id and rm_team.fl_id=rm.fl_id and rm_team.rm_id=rm.rm_id 
														and rm_team.team_id=team_assoc.team_id and team_assoc.dv_id=dv1.dv_id 
														 and (team_assoc.date_start is null or ${sql.yearMonthDayOf('team_assoc.date_start')} &lt;= ${parameters['asOfDate']})
														 and (team_assoc.date_end is null or ${sql.yearMonthDayOf('team_assoc.date_end')} &gt;= ${parameters['asOfDate']}) 
														and ${parameters['teamIdRestriction']} )
								ELSE '' 
								END
				ELSE '' 
				END)	
			</sql>
		</field>    
		<parameter name="asOfDate" dataType="text" value=""/>
		<parameter name="teamIdRestriction" dataType="verbatim" value=" 1=1 "/>
  </dataSource>

	<!-- Departments with Teams -->
	<dataSource id="labelTeamDepartmentsDs" type="DrawingControlLabels">
		<title>Departments with Teams</title>
		<table name="rm" role="main"/>
		<table name="dp" role="standard"/>

		<field table="rm" name="bl_id" hidden="true"/>
		<field table="rm" name="fl_id" hidden="true"/>
		<field table="rm" name="dv_id" hidden="true"/>
		<field table="rm" name="dp_id" hidden="true"/>


		<field table="rm" name = "rm_id"/>
		<field table="dp" name="dp_id"  dataType="text">
				<sql dialect="generic">
					 ( CASE WHEN EXISTS ( SELECT (dp1.dp_id) FROM rm_team, team_assoc, dp ${sql.as} dp1
														WHERE  rm_team.bl_id=rm.bl_id and rm_team.fl_id=rm.fl_id and rm_team.rm_id=rm.rm_id 
															 and rm_team.team_id=team_assoc.team_id and team_assoc.dp_id=dp1.dp_id and team_assoc.dv_id=dp1.dv_id 
															 and (team_assoc.date_start is null or ${sql.yearMonthDayOf('team_assoc.date_start')} &lt;= ${parameters['asOfDate']})
															 and (team_assoc.date_end is null or ${sql.yearMonthDayOf('team_assoc.date_end')} &gt;= ${parameters['asOfDate']}) 
															and ${parameters['teamIdRestriction']} )
				THEN		CASE WHEN 1=( select count(distinct dp1.dp_id) from rm_team, team_assoc, dp ${sql.as} dp1
															  where  rm_team.bl_id=rm.bl_id and rm_team.fl_id=rm.fl_id and rm_team.rm_id=rm.rm_id 
															 AND rm_team.team_id=team_assoc.team_id AND team_assoc.dp_id=dp1.dp_id  and team_assoc.dv_id=dp1.dv_id 
															 and (team_assoc.date_start is null or ${sql.yearMonthDayOf('team_assoc.date_start')} &lt;= ${parameters['asOfDate']})
															 and (team_assoc.date_end is null or ${sql.yearMonthDayOf('team_assoc.date_end')} &gt;= ${parameters['asOfDate']}) 
															and ${parameters['teamIdRestriction']} )
								THEN	( select MAX(dp1.dv_id ${sql.concat} '-' ${sql.concat} dp1.dp_id ) FROM rm_team, team_assoc, dp ${sql.as} dp1
														where  rm_team.bl_id=rm.bl_id and rm_team.fl_id=rm.fl_id and rm_team.rm_id=rm.rm_id 
														and rm_team.team_id=team_assoc.team_id and team_assoc.dp_id=dp1.dp_id  and team_assoc.dv_id=dp1.dv_id 
														 and (team_assoc.date_start is null or ${sql.yearMonthDayOf('team_assoc.date_start')} &lt;= ${parameters['asOfDate']})
														 and (team_assoc.date_end is null or ${sql.yearMonthDayOf('team_assoc.date_end')} &gt;= ${parameters['asOfDate']}) 
														and ${parameters['teamIdRestriction']} )
								ELSE 'MULTIPLE' 
								END
				ELSE dp.dv_id ${sql.concat} '-' ${sql.concat} dp.dp_id 
				END)	
				</sql>
		</field>    
		 <field table="rm" name="dateRange" dataType="text">
				<sql dialect="generic">
					( CASE WHEN EXISTS ( SELECT (team_assoc.team_assoc_id) FROM rm_team, team_assoc, dp ${sql.as} dp1
													  WHERE  rm_team.bl_id=rm.bl_id and rm_team.fl_id=rm.fl_id and rm_team.rm_id=rm.rm_id 
																 AND rm_team.team_id=team_assoc.team_id AND team_assoc.dp_id=dp1.dp_id  and team_assoc.dv_id=dp1.dv_id 
																 and (team_assoc.date_start is null or ${sql.yearMonthDayOf('team_assoc.date_start')} &lt;= ${parameters['asOfDate']})
																 and (team_assoc.date_end is null or ${sql.yearMonthDayOf('team_assoc.date_end')} &gt;= ${parameters['asOfDate']}) 
																and ${parameters['teamIdRestriction']} )

					THEN		CASE WHEN 1=( select count(team_assoc.team_assoc_id) from rm_team, team_assoc, dp ${sql.as} dp1
																  where  rm_team.bl_id=rm.bl_id and rm_team.fl_id=rm.fl_id and rm_team.rm_id=rm.rm_id 
																 AND rm_team.team_id=team_assoc.team_id AND team_assoc.dp_id=dp1.dp_id  and team_assoc.dv_id=dp1.dv_id 
																 and (team_assoc.date_start is null or ${sql.yearMonthDayOf('team_assoc.date_start')} &lt;= ${parameters['asOfDate']})
																 and (team_assoc.date_end is null or ${sql.yearMonthDayOf('team_assoc.date_end')} &gt;= ${parameters['asOfDate']}) 
																and ${parameters['teamIdRestriction']} )
									THEN	( select MAX( ${sql.yearMonthDayOf('team_assoc.date_start')} 
																		${sql.concat} '-' ${sql.concat} 
																		( case when team_assoc.date_end is null then  '' else ${sql.yearMonthDayOf('team_assoc.date_end')} end) 
																) 
															FROM rm_team, team_assoc, dp ${sql.as} dp1
															where  rm_team.bl_id=rm.bl_id and rm_team.fl_id=rm.fl_id and rm_team.rm_id=rm.rm_id 
															and rm_team.team_id=team_assoc.team_id and team_assoc.dp_id=dp1.dp_id  and team_assoc.dv_id=dp1.dv_id 
																 and (team_assoc.date_start is null or ${sql.yearMonthDayOf('team_assoc.date_start')} &lt;= ${parameters['asOfDate']})
																 and (team_assoc.date_end is null or ${sql.yearMonthDayOf('team_assoc.date_end')} &gt;= ${parameters['asOfDate']}) 
																and ${parameters['teamIdRestriction']} )
									ELSE '' 
									END
					ELSE '' 
					END )
				</sql>
		</field>    

		<parameter name="asOfDate" dataType="text" value=""/>
		<parameter name="teamIdRestriction" dataType="verbatim" value=" 1=1 "/>
    </dataSource>
</view>
