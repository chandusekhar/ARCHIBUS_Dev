<view version="2.0">
	<title translatable="true">Space Console: DOCX Report for Drawings</title>

	<report  outputFileType="docx"  documentTemplate="report-spaceconsole-template.docx" showHeader="false" showFooter="false" scale="null" labelHeight="3"/>
																																												 
    <panel type="drawing"
           id="drawingPanel"
           highlightDataSource="rm:highlightCategoriesDs"
           labelsDataSource=""
		   highlightType="thematic"
		   handler="com.archibus.service.common.report.pdf.ScalableDrawingPdfBuilder">
        <title></title>
    </panel>

    <dataSource id="highlightSuperCategoriesDs_legend" type="grouping">
        <table name="rm" role="main" />
        <table name="rmcat" role="standard" />
        <field table="rmcat" name="supercat" groupBy="true" />
        <field table="rm" name="hpattern_acad" dataType="text">
			<title>Legend</title>
            <sql dialect="generic">
                ( case 
                 when rmcat.supercat = 'USBL' then '14 0 3 65280' 
                 when rmcat.supercat = 'VERT' then '14 0 2 16776960' 
                 when rmcat.supercat = 'SERV' then '14 0 5 255'
                 when rmcat.supercat = 'OTHR' then '14 0 7 10066329' 
                end) 
            </sql>
        </field>
        <field table="rm" name="sum_area" formula="sum" baseField="rm.area" dataType="number"   numericFormat="area">
			<title>Area</title>
		</field>
        <restriction type="sql" sql="
           ( (${parameters['dp_id']} AND ${parameters['dv_id']} ) AND (${parameters['organizationUnassigned']})
                )
            AND ${parameters['bl_id']}
            AND ${parameters['fl_id']}
            AND ${parameters['rm_id']}
            AND
             (
               (${parameters['rm_cat']} AND ${parameters['rm_type']} ) AND (${parameters['typeUnassigned']})
            )
            
            AND ${parameters['occupancy']} 
            
            AND rmcat.supercat IS NOT NULL
        "/> 
        <parameter name="dv_id" dataType="verbatim" value="1=1"/>
        <parameter name="dp_id" dataType="verbatim" value="1=1"/>
        <parameter name="bl_id" dataType="verbatim" value="1=1"/>
        <parameter name="fl_id" dataType="verbatim" value="1=1"/>
        <parameter name="rm_id" dataType="verbatim" value="1=1"/>
        <parameter name="rm_cat" dataType="verbatim" value="1=1"/>
        <parameter name="rm_type" dataType="verbatim" value="1=1"/>
        <parameter name="occupancy" dataType="verbatim" value="1=1"/>
        <parameter name="occupancyForTotalCal" dataType="verbatim" value="1=1"/>
        <parameter name="organizationUnassigned" dataType="verbatim" value="1=1"/>
        <parameter name="typeUnassigned" dataType="verbatim" value="1=1"/>
        <parameter name="having" dataType="verbatim" value=""/>
    </dataSource>
    <panel type="legend" role="legend" format="table"
        id="panel_highlightSuperCategoriesDs_legend"
        dataSource="highlightSuperCategoriesDs_legend">
        <title translatable="true">Legend</title>      
    </panel>

	<dataSource id="highlightCategoriesDs_legend" type="grouping">
        <table name="rm" role="main" />
        <table name="rmcat" role="standard" />
        <field table="rmcat" name="rm_cat" groupBy="true" />
        <field table="rmcat" name="hpattern_acad" groupBy="true" />
        <field table="rm" name="sum_area" formula="sum" baseField="rm.area" dataType="number"   numericFormat="area"/>
        <restriction type="sql" sql="
         ${parameters['bl_id']} AND ${parameters['fl_id']} AND ${parameters['rm_id']}
        AND ${parameters['dp_id']} AND ${parameters['dv_id']} AND ${parameters['organizationUnassigned']} 
        AND ${parameters['rm_cat']} AND ${parameters['rm_type']} AND ${parameters['typeUnassigned']} 
        AND ${parameters['occupancy']}  
        AND rmcat.rm_cat IS NOT NULL
    "/> 
        <parameter name="bl_id" dataType="verbatim" value="1=1"/>
        <parameter name="fl_id" dataType="verbatim" value="1=1"/>
        <parameter name="rm_id" dataType="verbatim" value="1=1"/>
        <parameter name="dv_id" dataType="verbatim" value="1=1"/>
        <parameter name="dp_id" dataType="verbatim" value="1=1"/>
        <parameter name="organizationUnassigned" dataType="verbatim" value="1=1"/>
        <parameter name="rm_cat" dataType="verbatim" value="1=1"/>
        <parameter name="rm_type" dataType="verbatim" value="1=1"/>
        <parameter name="typeUnassigned" dataType="verbatim" value="1=1"/>
        <parameter name="occupancy" dataType="verbatim" value="1=1"/>
    </dataSource>
    <panel type="legend" role="legend" format="table"
        id="panel_highlightCategoriesDs_legend"
        dataSource="highlightCategoriesDs_legend">
        <title translatable="true">Legend</title>
      
       <field table="rmcat" name="rm_cat" >
            <title>Room Category</title>
        </field>
        <field table="rmcat" name="hpattern_acad" >
            <title>Legend</title>
        </field>
        <field table="rm" name="sum_area" >
            <title>Area</title>
        </field>
    </panel>

     <dataSource id="highlightTypesDs_legend" type="grouping">
        <table name="rm" role="main" />
        <table name="rmtype" role="standard" />
        <field table="rmtype" name="rm_cat" groupBy="true" />
        <field table="rmtype" name="rm_type" groupBy="true" />
        <field table="rmtype" name="hpattern_acad" groupBy="true" />
        <field table="rm" name="sum_area" formula="sum" baseField="rm.area" dataType="number"   numericFormat="area"/>
        <restriction type="sql" sql="
       ( (${parameters['dp_id']} AND ${parameters['dv_id']} ) AND (${parameters['organizationUnassigned']})
            )
        AND ${parameters['bl_id']}
        AND ${parameters['fl_id']}
        AND ${parameters['rm_id']}
        AND
         (
           (${parameters['rm_cat']} AND ${parameters['rm_type']} ) AND (${parameters['typeUnassigned']})
        )
        
        AND ${parameters['occupancy']} 
        
        AND rmtype.rm_cat IS NOT NULL 
        AND rmtype.rm_type IS NOT NULL
    "/> 
        <parameter name="dv_id" dataType="verbatim" value="1=1"/>
        <parameter name="dp_id" dataType="verbatim" value="1=1"/>
        <parameter name="bl_id" dataType="verbatim" value="1=1"/>
        <parameter name="fl_id" dataType="verbatim" value="1=1"/>
        <parameter name="rm_id" dataType="verbatim" value="1=1"/>
        <parameter name="rm_cat" dataType="verbatim" value="1=1"/>
        <parameter name="rm_type" dataType="verbatim" value="1=1"/>
        <parameter name="occupancy" dataType="verbatim" value="1=1"/>
        <parameter name="occupancyForTotalCal" dataType="verbatim" value="1=1"/>
        <parameter name="organizationUnassigned" dataType="verbatim" value="1=1"/>
        <parameter name="typeUnassigned" dataType="verbatim" value="1=1"/>
        <parameter name="having" dataType="verbatim" value=""/>
    </dataSource>

    <panel type="legend" role="legend" format="table"
        id="panel_highlightTypesDs_legend"
        dataSource="highlightTypesDs_legend">
        <title translatable="true">Legend</title>
      
       <field table="rmtype" name="rm_cat" >
            <title>Room Category</title>
        </field>
       <field table="rmtype" name="rm_type" >
            <title>Room Type</title>
        </field>

        <field table="rmtype" name="hpattern_acad" >
            <title>Legend</title>
        </field>
        <field table="rm" name="sum_area" >
            <title>Area</title>
        </field>
    </panel>

    <dataSource id="highlightDivisionsDs_legend" type="grouping">
        <table name="rm" role="main" />
        <table name="dv" role="standard" />
        <field table="dv" name="dv_id" groupBy="true" />
        <field table="dv" name="hpattern_acad" groupBy="true" />
        <field table="rm" name="sum_area" formula="sum" baseField="rm.area" dataType="number"   numericFormat="area"/>
        <restriction type="sql" sql="
           ( (${parameters['dp_id']} AND ${parameters['dv_id']} ) AND (${parameters['organizationUnassigned']})
                )
            AND ${parameters['bl_id']}
            AND ${parameters['fl_id']}
            AND ${parameters['rm_id']}
            AND
             (
               (${parameters['rm_cat']} AND ${parameters['rm_type']} ) AND (${parameters['typeUnassigned']})
            )
            
            AND ${parameters['occupancy']} 
            AND dv.dv_id IS NOT NULL
        "/> 
        <parameter name="dv_id" dataType="verbatim" value="1=1"/>
        <parameter name="dp_id" dataType="verbatim" value="1=1"/>
        <parameter name="bl_id" dataType="verbatim" value="1=1"/>
        <parameter name="fl_id" dataType="verbatim" value="1=1"/>
        <parameter name="rm_id" dataType="verbatim" value="1=1"/>
        <parameter name="rm_cat" dataType="verbatim" value="1=1"/>
        <parameter name="rm_type" dataType="verbatim" value="1=1"/>
        <parameter name="occupancy" dataType="verbatim" value="1=1"/>
        <parameter name="occupancyForTotalCal" dataType="verbatim" value="1=1"/>
        <parameter name="organizationUnassigned" dataType="verbatim" value="1=1"/>
        <parameter name="typeUnassigned" dataType="verbatim" value="1=1"/>
        <parameter name="having" dataType="verbatim" value=""/>
        
    </dataSource>

    <panel type="legend" role="legend" format="table"
        id="panel_highlightDivisionsDs_legend"
        dataSource="highlightDivisionsDs_legend">
        <title translatable="true">Legend</title>
      
       <field table="dv" name="dv_id" >
            <title>Division</title>
        </field>
        
        <field table="dv" name="hpattern_acad" >
            <title>Legend</title>
        </field>
        <field table="rm" name="sum_area" >
            <title>Area</title>
        </field>
    </panel>
																	   
	<dataSource id="highlightDepartmentsDs_legend" type="grouping">
        <table name="rm" role="main" />
        <table name="dp" role="standard" />
        <field table="dp" name="dv_id" groupBy="true" />
        <field table="dp" name="dp_id" groupBy="true" />
        <field table="dp" name="hpattern_acad" groupBy="true" />
        <field table="rm" name="sum_area" formula="sum" baseField="rm.area" dataType="number"   numericFormat="area"/>
        <restriction type="sql" sql="
           ( (${parameters['dp_id']} AND ${parameters['dv_id']} ) AND (${parameters['organizationUnassigned']})
                )
            AND ${parameters['bl_id']}
            AND ${parameters['fl_id']}
            AND ${parameters['rm_id']}
            AND
             (
               (${parameters['rm_cat']} AND ${parameters['rm_type']} ) AND (${parameters['typeUnassigned']})
            )
            
            AND ${parameters['occupancy']} 
            AND dp.dv_id IS NOT NULL 
            AND dp.dp_id IS NOT NULL
        "/> 
        <parameter name="dv_id" dataType="verbatim" value="1=1"/>
        <parameter name="dp_id" dataType="verbatim" value="1=1"/>
        <parameter name="bl_id" dataType="verbatim" value="1=1"/>
        <parameter name="fl_id" dataType="verbatim" value="1=1"/>
        <parameter name="rm_id" dataType="verbatim" value="1=1"/>
        <parameter name="rm_cat" dataType="verbatim" value="1=1"/>
        <parameter name="rm_type" dataType="verbatim" value="1=1"/>
        <parameter name="occupancy" dataType="verbatim" value="1=1"/>
        <parameter name="occupancyForTotalCal" dataType="verbatim" value="1=1"/>
        <parameter name="organizationUnassigned" dataType="verbatim" value="1=1"/>
        <parameter name="typeUnassigned" dataType="verbatim" value="1=1"/>
        <parameter name="having" dataType="verbatim" value=""/>
        
    </dataSource>

    <panel type="legend" role="legend" format="table"
        id="panel_highlightDepartmentsDs_legend"
        dataSource="highlightDepartmentsDs_legend">
        <title translatable="true">Legend</title>
      
       <field table="dp" name="dv_id" >
            <title>Division</title>
        </field>
       <field table="dp" name="dp_id" >
            <title>Department</title>
        </field>
        
        <field table="dp" name="hpattern_acad" >
            <title>Legend</title>
        </field>
        <field table="rm" name="sum_area" >
            <title>Area</title>
        </field>
    </panel>

     <dataSource id="highlightRoomStandard_legend" type="grouping">
	     <table name="rm" role="main"/>
	     <table name="rmstd" role="standard"/>
	   
        <field table="rm" name="rm_std" groupBy="true" />
        <field table="rmstd" name="hpattern_acad" groupBy="true" />
        <field table="rm" name="sum_area" formula="sum" baseField="rm.area" dataType="number"   numericFormat="area"/>
	
		<restriction type="sql" sql="
		   ( (${parameters['dp_id']} AND ${parameters['dv_id']} ) AND (${parameters['organizationUnassigned']})
				)
			AND ${parameters['bl_id']}
			AND ${parameters['fl_id']}
			AND ${parameters['rm_id']}
			AND
			 (
			   (${parameters['rm_cat']} AND ${parameters['rm_type']} ) AND (${parameters['typeUnassigned']})
			)
			
			AND ${parameters['occupancy']} 
		"/> 
		<parameter name="dv_id" dataType="verbatim" value="1=1"/>
		<parameter name="dp_id" dataType="verbatim" value="1=1"/>
		<parameter name="bl_id" dataType="verbatim" value="1=1"/>
		<parameter name="fl_id" dataType="verbatim" value="1=1"/>
		<parameter name="rm_id" dataType="verbatim" value="1=1"/>
		<parameter name="rm_cat" dataType="verbatim" value="1=1"/>
		<parameter name="rm_type" dataType="verbatim" value="1=1"/>
		<parameter name="occupancy" dataType="verbatim" value="1=1"/>
		<parameter name="organizationUnassigned" dataType="verbatim" value="1=1"/>
		<parameter name="typeUnassigned" dataType="verbatim" value="1=1"/>
		<sortField table="rm" name="rm_std" />
    </dataSource>
    <panel type="legend" role="legend" format="table" id="panel_highlightRoomStandard_legend" dataSource="highlightRoomStandard_legend">
       <field table="rm" name="rm_std" >
            <title>Room Standard</title>
        </field>
        
        <field table="rmstd" name="hpattern_acad" >
            <title>Legend</title>
        </field>
        <field table="rm" name="sum_area" >
            <title>Area</title>
        </field>
    </panel>
																   
	<dataSource id="highlightEmployeesDs_legend" type="grouping"  applyVpaRestrictions="false">
		<sql dialect="generic">
		  SELECT rm.dwgname ${sql.as} dwgname, 
		  ( CASE 
			WHEN 
			   exists (select 1 from rmcat where rmcat.rm_cat = rm.rm_cat AND rmcat.occupiable = 0) OR rm.cap_em = 0
		  THEN 'Not Occupiable'
			  WHEN 
				exists (select 1 from rmcat where rmcat.rm_cat = rm.rm_cat AND rmcat.occupiable = 1) AND rm.cap_em > 0 
				AND 0 = (SELECT COUNT(1) FROM em WHERE em.bl_id = rm.bl_id AND em.fl_id = rm.fl_id AND em.rm_id = rm.rm_id)
		  THEN 'Vacant' 
			  WHEN 
				exists (select 1 from rmcat where rmcat.rm_cat = rm.rm_cat AND rmcat.occupiable = 1) AND rm.cap_em > 0 
				AND rm.cap_em &gt; (SELECT COUNT(1) FROM em WHERE em.bl_id = rm.bl_id AND em.fl_id = rm.fl_id AND em.rm_id = rm.rm_id)
		  THEN 'Available' 
			  WHEN 
				exists (select 1 from rmcat where rmcat.rm_cat = rm.rm_cat AND rmcat.occupiable = 1) AND rm.cap_em > 0 
				AND rm.cap_em = (SELECT COUNT(1) FROM em WHERE em.bl_id = rm.bl_id AND em.fl_id = rm.fl_id AND em.rm_id = rm.rm_id)
		  THEN 'At Capacity' 
			  WHEN 
			   exists (select 1 from rmcat where rmcat.rm_cat = rm.rm_cat AND rmcat.occupiable = 1) AND rm.cap_em > 0 
				AND rm.cap_em &lt; (SELECT COUNT(1) FROM em WHERE em.bl_id = rm.bl_id AND em.fl_id = rm.fl_id AND em.rm_id = rm.rm_id)
		  THEN 'Exceeds Capacity' 
		   END )  ${sql.as} occup,
		  ( CASE 
			WHEN 
			   exists (select 1 from rmcat where rmcat.rm_cat = rm.rm_cat AND rmcat.occupiable = 0) OR rm.cap_em = 0
		  THEN '14 0 7 13421772'
			  WHEN 
				exists (select 1 from rmcat where rmcat.rm_cat = rm.rm_cat AND rmcat.occupiable = 1) AND rm.cap_em > 0 
				AND 0 = (SELECT COUNT(1) FROM em WHERE em.bl_id = rm.bl_id AND em.fl_id = rm.fl_id AND em.rm_id = rm.rm_id)
		  THEN  '14 0 3 65280' 
			  WHEN 
				exists (select 1 from rmcat where rmcat.rm_cat = rm.rm_cat AND rmcat.occupiable = 1) AND rm.cap_em > 0 
				AND rm.cap_em &gt; (SELECT COUNT(1) FROM em WHERE em.bl_id = rm.bl_id AND em.fl_id = rm.fl_id AND em.rm_id = rm.rm_id)
		  THEN '14 0 5 255' 
			  WHEN 
				exists (select 1 from rmcat where rmcat.rm_cat = rm.rm_cat AND rmcat.occupiable = 1) AND rm.cap_em > 0 
				AND rm.cap_em = (SELECT COUNT(1) FROM em WHERE em.bl_id = rm.bl_id AND em.fl_id = rm.fl_id AND em.rm_id = rm.rm_id)
		  THEN '14 0 2 16776960' 
			  WHEN 
			   exists (select 1 from rmcat where rmcat.rm_cat = rm.rm_cat AND rmcat.occupiable = 1) AND rm.cap_em > 0 
				AND rm.cap_em &lt; (SELECT COUNT(1) FROM em WHERE em.bl_id = rm.bl_id AND em.fl_id = rm.fl_id AND em.rm_id = rm.rm_id)
		  THEN '14 0 1 16711680' 
		   END	 )	 ${sql.as} hpattern_acad,
		   rm.area 
		  FROM rm where 1=1 and ${sql.vpaRestriction} 
					AND ${parameters['bl_id']} AND ${parameters['fl_id']} AND ${parameters['rm_id']} 
					AND (${parameters['dp_id']} AND ${parameters['dv_id']} ) AND (${parameters['organizationUnassigned']})
					AND (${parameters['rm_cat']} AND ${parameters['rm_type']} AND ${parameters['typeUnassigned']}) 
					AND ${parameters['occupancy']} 
		</sql>
        <table name="rm" role="main" />
		<field name = "occup" dataType="text"  groupBy="true">
			<title>Occupancy</title>
		</field>
        <field name="hpattern_acad" dataType="text" groupBy="true">
			<title>Legend</title>
		</field>
        <field table="rm" name="sum_area" formula="sum" baseField="rm.area" dataType="number"   numericFormat="area" showTotals="true">
			<title>Area</title>
		</field>
        <parameter name="dv_id" dataType="verbatim" value="1=1"/>
        <parameter name="dp_id" dataType="verbatim" value="1=1"/>
        <parameter name="bl_id" dataType="verbatim" value="1=1"/>
        <parameter name="fl_id" dataType="verbatim" value="1=1"/>
        <parameter name="rm_id" dataType="verbatim" value="1=1"/>
        <parameter name="rm_cat" dataType="verbatim" value="1=1"/>
        <parameter name="rm_type" dataType="verbatim" value="1=1"/>
        <parameter name="occupancy" dataType="verbatim" value="1=1"/>
        <parameter name="occupancyForTotalCal" dataType="verbatim" value="1=1"/>
        <parameter name="organizationUnassigned" dataType="verbatim" value="1=1"/>
        <parameter name="typeUnassigned" dataType="verbatim" value="1=1"/>
		<sortField name="occup"/>
    </dataSource>
    <panel type="legend" role="legend" format="table"
        id="panel_highlightEmployeesDs_legend"  
        dataSource="highlightEmployeesDs_legend">
        <title translatable="true">Legend</title>
    </panel>

  <!-- Teams -->
  <dataSource id="highlightTeamDs_legend" type="grouping"  applyVpaRestrictions="false">
     <title>Teams</title>
	<sql dialect="generic">
		  SELECT rm.dwgname, 
                ( CASE WHEN EXISTS ( SELECT (team_properties.team_id) FROM rm_team, team_properties 
												  WHERE  rm_team.bl_id=rm.bl_id and rm_team.fl_id=rm.fl_id and rm_team.rm_id=rm.rm_id 
															 AND rm_team.team_id=team_properties.team_id and team_properties.needs_team_space=1 ) 
				THEN		( select MAX(team_properties.team_id) FROM rm_team, team_properties 
														where  rm_team.bl_id=rm.bl_id and rm_team.fl_id=rm.fl_id and rm_team.rm_id=rm.rm_id 
														and rm_team.team_id=team_properties.team_id and team_properties.needs_team_space=1 )
				ELSE null  
				END)  ${sql.as} team_id,
                ( CASE WHEN EXISTS ( SELECT (team_properties.team_id) FROM rm_team, team_properties 
												  WHERE  rm_team.bl_id=rm.bl_id and rm_team.fl_id=rm.fl_id and rm_team.rm_id=rm.rm_id 
															 AND rm_team.team_id=team_properties.team_id and team_properties.needs_team_space=1 ) 
				THEN		( select MAX(team_properties.team_name) FROM rm_team, team_properties 
														where  rm_team.bl_id=rm.bl_id and rm_team.fl_id=rm.fl_id and rm_team.rm_id=rm.rm_id 
														and rm_team.team_id=team_properties.team_id and team_properties.needs_team_space=1 )
				ELSE ''  
				END)  ${sql.as} team_name,
                ( CASE WHEN EXISTS ( SELECT (team_properties.hpattern_acad) FROM rm_team, team_properties 
												  WHERE  rm_team.bl_id=rm.bl_id and rm_team.fl_id=rm.fl_id and rm_team.rm_id=rm.rm_id 
															 AND rm_team.team_id=team_properties.team_id and team_properties.needs_team_space=1 ) 
				THEN		( select MAX(team_properties.hpattern_acad) FROM rm_team, team_properties 
														where  rm_team.bl_id=rm.bl_id and rm_team.fl_id=rm.fl_id and rm_team.rm_id=rm.rm_id 
														and rm_team.team_id=team_properties.team_id and team_properties.needs_team_space=1 )
				ELSE '14 0 7 13421772' 
				END)	 ${sql.as} hpattern_acad 
		  FROM rm where 1=1 and ${sql.vpaRestriction} and ${parameters['dp_id']} AND ${parameters['dv_id']} AND ${parameters['organizationUnassigned']}
            AND ${parameters['bl_id']} AND ${parameters['fl_id']} AND ${parameters['rm_id']}
            AND ${parameters['rm_cat']} AND ${parameters['rm_type']} AND ${parameters['typeUnassigned']}
            AND ${parameters['occupancy']} AND ${parameters['rm_std']} AND ${parameters['excludedHotalableRm']} 
			AND exists ( select 1 from rm_team where rm_team.bl_id=rm.bl_id and rm_team.fl_id=rm.fl_id and rm_team.rm_id=rm.rm_id 
																	and (rm_team.date_start is null or ${sql.yearMonthDayOf('rm_team.date_start')} &lt;= ${parameters['asOfDate']})
																	and (rm_team.date_end is null or ${sql.yearMonthDayOf('rm_team.date_end')} &gt;= ${parameters['asOfDate']}) 
																	and ${parameters['teamIdRestriction']}
					)
		</sql>
		<table name="rm" role="main"/>
		<field name="team_id" dataType="text"  groupBy="true">
			<title>Team Code</title>
		</field>    
		<field name="team_name" dataType="text"  groupBy="true">
			<title>Team Name</title>
		</field>    
		<field name="hpattern_acad" dataType="text"  groupBy="true">
			<title>Legend</title>
		</field>    
        <parameter name="dv_id" dataType="verbatim" value="1=1"/>
        <parameter name="dp_id" dataType="verbatim" value="1=1"/>
        <parameter name="bl_id" dataType="verbatim" value="1=1"/>
        <parameter name="fl_id" dataType="verbatim" value="1=1"/>
        <parameter name="rm_id" dataType="verbatim" value="1=1"/>
        <parameter name="rm_cat" dataType="verbatim" value="1=1"/>
        <parameter name="rm_type" dataType="verbatim" value="1=1"/>
        <parameter name="occupancy" dataType="verbatim" value="1=1"/>
        <parameter name="rm_std" dataType="verbatim" value="1=1"/>
        <parameter name="organizationUnassigned" dataType="verbatim" value="1=1"/>
        <parameter name="typeUnassigned" dataType="verbatim" value="1=1"/>
        <parameter name="excludedHotalableRm" dataType="verbatim" value="5=5"/>
        <parameter name="having" dataType="verbatim" value=""/>
        <parameter name="asOfDate" dataType="text" value=""/>
        <parameter name="teamIdRestriction" dataType="verbatim" value=" 1=1 "/>
  </dataSource>
    <panel type="legend" role="legend" format="table"
        id="panel_highlightTeamDs_legend"
        dataSource="highlightTeamDs_legend">
        <title translatable="true">Legend</title>
    </panel>
            
  <!-- Teams  by Divisions-->
  <dataSource id="highlightTeamDivisionsDs_legend" type="grouping"  applyVpaRestrictions="false">
     <title>Divisions with Teams</title>
		<sql dialect="generic">
		  SELECT rm.dwgname, 
                ( CASE WHEN EXISTS ( SELECT (dv1.hpattern_acad) FROM rm_team, team_assoc, dv ${sql.as} dv1
														WHERE  rm_team.bl_id=rm.bl_id and rm_team.fl_id=rm.fl_id and rm_team.rm_id=rm.rm_id 
															 and rm_team.team_id=team_assoc.team_id and team_assoc.dv_id=dv1.dv_id 
															 and (team_assoc.date_start is null or ${sql.yearMonthDayOf('team_assoc.date_start')} &lt;= ${parameters['asOfDate']})
															 and (team_assoc.date_end is null or ${sql.yearMonthDayOf('team_assoc.date_end')} &gt;= ${parameters['asOfDate']}) 
												) 
				THEN		CASE WHEN 1=( select count(distinct dv1.hpattern_acad) from rm_team, team_assoc, dv ${sql.as} dv1
															  where  rm_team.bl_id=rm.bl_id and rm_team.fl_id=rm.fl_id and rm_team.rm_id=rm.rm_id 
															 AND rm_team.team_id=team_assoc.team_id AND team_assoc.dv_id=dv1.dv_id 
															 and (team_assoc.date_start is null or ${sql.yearMonthDayOf('team_assoc.date_start')} &lt;= ${parameters['asOfDate']})
															 and (team_assoc.date_end is null or ${sql.yearMonthDayOf('team_assoc.date_end')} &gt;= ${parameters['asOfDate']}) 
														 )
								THEN	( select MAX(dv1.dv_id) FROM rm_team, team_assoc, dv ${sql.as} dv1
														where  rm_team.bl_id=rm.bl_id and rm_team.fl_id=rm.fl_id and rm_team.rm_id=rm.rm_id 
														and rm_team.team_id=team_assoc.team_id and team_assoc.dv_id=dv1.dv_id 
														 and (team_assoc.date_start is null or ${sql.yearMonthDayOf('team_assoc.date_start')} &lt;= ${parameters['asOfDate']})
														 and (team_assoc.date_end is null or ${sql.yearMonthDayOf('team_assoc.date_end')} &gt;= ${parameters['asOfDate']}) 
											)
								ELSE '' 
								END
				ELSE rm.dv_id 
				END)	 ${sql.as} dvId,  
                ( CASE WHEN EXISTS ( SELECT (dv1.hpattern_acad) FROM rm_team, team_assoc, dv ${sql.as} dv1
															WHERE  rm_team.bl_id=rm.bl_id and rm_team.fl_id=rm.fl_id and rm_team.rm_id=rm.rm_id 
															 AND rm_team.team_id=team_assoc.team_id AND team_assoc.dv_id=dv1.dv_id 
															 and (team_assoc.date_start is null or ${sql.yearMonthDayOf('team_assoc.date_start')} &lt;= ${parameters['asOfDate']})
															 and (team_assoc.date_end is null or ${sql.yearMonthDayOf('team_assoc.date_end')} &gt;= ${parameters['asOfDate']}) 
												) 
				THEN		CASE WHEN 1=( select count(distinct dv1.hpattern_acad) from rm_team, team_assoc, dv ${sql.as} dv1
															  where  rm_team.bl_id=rm.bl_id and rm_team.fl_id=rm.fl_id and rm_team.rm_id=rm.rm_id 
															 AND rm_team.team_id=team_assoc.team_id AND team_assoc.dv_id=dv1.dv_id 
															 and (team_assoc.date_start is null or ${sql.yearMonthDayOf('team_assoc.date_start')} &lt;= ${parameters['asOfDate']})
															 and (team_assoc.date_end is null or ${sql.yearMonthDayOf('team_assoc.date_end')} &gt;= ${parameters['asOfDate']}) 
														)
								THEN	( select MAX(dv1.hpattern_acad) FROM rm_team, team_assoc, dv ${sql.as} dv1
														where  rm_team.bl_id=rm.bl_id and rm_team.fl_id=rm.fl_id and rm_team.rm_id=rm.rm_id 
														and rm_team.team_id=team_assoc.team_id and team_assoc.dv_id=dv1.dv_id 
														 and (team_assoc.date_start is null or ${sql.yearMonthDayOf('team_assoc.date_start')} &lt;= ${parameters['asOfDate']})
														 and (team_assoc.date_end is null or ${sql.yearMonthDayOf('team_assoc.date_end')} &gt;= ${parameters['asOfDate']}) 
											)
								ELSE '14 0 7 13421772' 
								END
				ELSE dv.hpattern_acad 
				END)	 ${sql.as} hpattern_acad 
		  FROM rm LEFT OUTER JOIN dv on rm.dv_id=dv.dv_id 
		  where 1=1 and ${sql.vpaRestriction} and ${parameters['dp_id']} AND ${parameters['dv_id']} AND ${parameters['organizationUnassigned']}
            AND ${parameters['bl_id']} AND ${parameters['fl_id']} AND ${parameters['rm_id']}
            AND ${parameters['rm_cat']} AND ${parameters['rm_type']} AND ${parameters['typeUnassigned']}
            AND ${parameters['occupancy']} AND ${parameters['rm_std']} AND ${parameters['excludedHotalableRm']} 
		</sql>
		<table name="rm" role="main"/>
		<field name="dvId" dataType="text"  groupBy="true">
			<title>Division</title>
		</field>    
		<field name="hpattern_acad" dataType="text"  groupBy="true">
			<title>Legend</title>
		</field>    
        <parameter name="dv_id" dataType="verbatim" value="1=1"/>
        <parameter name="dp_id" dataType="verbatim" value="1=1"/>
        <parameter name="bl_id" dataType="verbatim" value="1=1"/>
        <parameter name="fl_id" dataType="verbatim" value="1=1"/>
        <parameter name="rm_id" dataType="verbatim" value="1=1"/>
        <parameter name="rm_cat" dataType="verbatim" value="1=1"/>
        <parameter name="rm_type" dataType="verbatim" value="1=1"/>
        <parameter name="occupancy" dataType="verbatim" value="1=1"/>
        <parameter name="rm_std" dataType="verbatim" value="1=1"/>
        <parameter name="organizationUnassigned" dataType="verbatim" value="1=1"/>
        <parameter name="typeUnassigned" dataType="verbatim" value="1=1"/>
        <parameter name="excludedHotalableRm" dataType="verbatim" value="5=5"/>
        <parameter name="having" dataType="verbatim" value=""/>
        <parameter name="asOfDate" dataType="text" value=""/>
        <parameter name="teamIdRestriction" dataType="verbatim" value=" 1=1 "/>
  </dataSource>
    <panel type="legend" role="legend" format="table"
        id="panel_highlightTeamDivisionsDs_legend"
        dataSource="highlightTeamDivisionsDs_legend">
        <title translatable="true">Legend</title>
    </panel>

  <!-- Teams  by Departments -->
  <dataSource id="highlightTeamDepartmentsDs_legend" type="grouping"  applyVpaRestrictions="false">
     <title>Departments with Teams</title>
		<sql dialect="generic">
		  SELECT rm.dwgname, 
                ( CASE WHEN EXISTS ( SELECT (dp1.hpattern_acad) FROM rm_team, team_assoc, dp ${sql.as} dp1
														WHERE  rm_team.bl_id=rm.bl_id and rm_team.fl_id=rm.fl_id and rm_team.rm_id=rm.rm_id 
															 and rm_team.team_id=team_assoc.team_id and team_assoc.dv_id=dp1.dv_id  and team_assoc.dp_id=dp1.dp_id 
															 and (team_assoc.date_start is null or ${sql.yearMonthDayOf('team_assoc.date_start')} &lt;= ${parameters['asOfDate']})
															 and (team_assoc.date_end is null or ${sql.yearMonthDayOf('team_assoc.date_end')} &gt;= ${parameters['asOfDate']}) 
												) 
				THEN		CASE WHEN 1=( select count(distinct dp1.hpattern_acad) from rm_team, team_assoc, dp ${sql.as} dp1
															  where  rm_team.bl_id=rm.bl_id and rm_team.fl_id=rm.fl_id and rm_team.rm_id=rm.rm_id 
															 AND rm_team.team_id=team_assoc.team_id AND team_assoc.dv_id=dp1.dv_id  and team_assoc.dp_id=dp1.dp_id 
															 and (team_assoc.date_start is null or ${sql.yearMonthDayOf('team_assoc.date_start')} &lt;= ${parameters['asOfDate']})
															 and (team_assoc.date_end is null or ${sql.yearMonthDayOf('team_assoc.date_end')} &gt;= ${parameters['asOfDate']}) 
														 )
								THEN	( select MAX(dp1.dv_id ${sql.concat} '-' ${sql.concat} dp1.dp_id) FROM rm_team, team_assoc, dp ${sql.as} dp1
														where  rm_team.bl_id=rm.bl_id and rm_team.fl_id=rm.fl_id and rm_team.rm_id=rm.rm_id 
														and rm_team.team_id=team_assoc.team_id and team_assoc.dp_id=dp1.dp_id  and team_assoc.dp_id=dp1.dp_id 
														 and (team_assoc.date_start is null or ${sql.yearMonthDayOf('team_assoc.date_start')} &lt;= ${parameters['asOfDate']})
														 and (team_assoc.date_end is null or ${sql.yearMonthDayOf('team_assoc.date_end')} &gt;= ${parameters['asOfDate']}) 
											)
								ELSE '' 
								END
				ELSE rm.dv_id ${sql.concat} '-' ${sql.concat} rm.dp_id  
				END)	 ${sql.as} dpId,  
                ( CASE WHEN EXISTS ( SELECT (dp1.hpattern_acad) FROM rm_team, team_assoc, dp ${sql.as} dp1
															WHERE  rm_team.bl_id=rm.bl_id and rm_team.fl_id=rm.fl_id and rm_team.rm_id=rm.rm_id 
															 AND rm_team.team_id=team_assoc.team_id AND team_assoc.dv_id=dp1.dv_id  and team_assoc.dp_id=dp1.dp_id 
															 and (team_assoc.date_start is null or ${sql.yearMonthDayOf('team_assoc.date_start')} &lt;= ${parameters['asOfDate']})
															 and (team_assoc.date_end is null or ${sql.yearMonthDayOf('team_assoc.date_end')} &gt;= ${parameters['asOfDate']}) 
												) 
				THEN		CASE WHEN 1=( select count(distinct dp1.hpattern_acad) from rm_team, team_assoc, dp ${sql.as} dp1
															  where  rm_team.bl_id=rm.bl_id and rm_team.fl_id=rm.fl_id and rm_team.rm_id=rm.rm_id 
															 AND rm_team.team_id=team_assoc.team_id AND team_assoc.dv_id=dp1.dv_id  and team_assoc.dp_id=dp1.dp_id 
															 and (team_assoc.date_start is null or ${sql.yearMonthDayOf('team_assoc.date_start')} &lt;= ${parameters['asOfDate']})
															 and (team_assoc.date_end is null or ${sql.yearMonthDayOf('team_assoc.date_end')} &gt;= ${parameters['asOfDate']}) 
														)
								THEN	( select MAX(dp1.hpattern_acad) FROM rm_team, team_assoc, dp ${sql.as} dp1
														where  rm_team.bl_id=rm.bl_id and rm_team.fl_id=rm.fl_id and rm_team.rm_id=rm.rm_id 
														and rm_team.team_id=team_assoc.team_id and team_assoc.dv_id=dp1.dv_id  and team_assoc.dp_id=dp1.dp_id 
														 and (team_assoc.date_start is null or ${sql.yearMonthDayOf('team_assoc.date_start')} &lt;= ${parameters['asOfDate']})
														 and (team_assoc.date_end is null or ${sql.yearMonthDayOf('team_assoc.date_end')} &gt;= ${parameters['asOfDate']}) 
											)
								ELSE '14 0 7 13421772' 
								END
				ELSE dp.hpattern_acad 
				END)	 ${sql.as} hpattern_acad 
		  FROM rm LEFT OUTER JOIN dp on rm.dv_id=dp.dv_id and rm.dp_id=dp.dp_id 
		  where 1=1 and ${sql.vpaRestriction} and ${parameters['dp_id']} AND ${parameters['dp_id']} AND ${parameters['organizationUnassigned']}
            AND ${parameters['bl_id']} AND ${parameters['fl_id']} AND ${parameters['rm_id']}
            AND ${parameters['rm_cat']} AND ${parameters['rm_type']} AND ${parameters['typeUnassigned']}
            AND ${parameters['occupancy']} AND ${parameters['rm_std']} AND ${parameters['excludedHotalableRm']} 
		</sql>
		<table name="rm" role="main"/>
		<field name="dpId" dataType="text"  groupBy="true">
			<title>Department</title>
		</field>    
		<field name="hpattern_acad" dataType="text"  groupBy="true">
			<title>Legend</title>
		</field>    
        <parameter name="dv_id" dataType="verbatim" value="1=1"/>
        <parameter name="dp_id" dataType="verbatim" value="1=1"/>
        <parameter name="bl_id" dataType="verbatim" value="1=1"/>
        <parameter name="fl_id" dataType="verbatim" value="1=1"/>
        <parameter name="rm_id" dataType="verbatim" value="1=1"/>
        <parameter name="rm_cat" dataType="verbatim" value="1=1"/>
        <parameter name="rm_type" dataType="verbatim" value="1=1"/>
        <parameter name="occupancy" dataType="verbatim" value="1=1"/>
        <parameter name="rm_std" dataType="verbatim" value="1=1"/>
        <parameter name="organizationUnassigned" dataType="verbatim" value="1=1"/>
        <parameter name="typeUnassigned" dataType="verbatim" value="1=1"/>
        <parameter name="excludedHotalableRm" dataType="verbatim" value="5=5"/>
        <parameter name="having" dataType="verbatim" value=""/>
        <parameter name="asOfDate" dataType="text" value=""/>
        <parameter name="teamIdRestriction" dataType="verbatim" value=" 1=1 "/>
  </dataSource>
    <panel type="legend" role="legend" format="table"
        id="panel_highlightTeamDepartmentsDs_legend"
        dataSource="highlightTeamDepartmentsDs_legend">
        <title translatable="true">Legend</title>
    </panel>
	<dataSource id="highlightRoomOccupantDs1_legend" type="grouping" >
     <title>Real Estate Occupant</title>
     <table name="rm" role="main"/>
     <table name="dv" role="standard"/>
     <table name="rmcat" role="standard"/>
	 <table name="uc_rmoccupant" role="standard"/>

     <field table="uc_rmoccupant" name="occupant_id"  groupBy="true"/>
	 <field table="uc_rmoccupant" name="name"  groupBy="true"/>
     <field table="uc_rmoccupant" name="hpattern_acad" groupBy="true"/>
     
     <restriction type="sql" sql="
           ( (${parameters['dp_id']} AND ${parameters['dv_id']} ) AND (${parameters['organizationUnassigned']})
                )
            AND ${parameters['bl_id']}
            AND ${parameters['fl_id']}
            AND ${parameters['rm_id']}
            AND
             (
               (${parameters['rm_cat']} AND ${parameters['rm_type']} ) AND (${parameters['typeUnassigned']})
            )
            
            AND ${parameters['occupancy']} AND ${parameters['rm_std']} AND ${parameters['excludedHotalableRm']}
        "/> 
        <field table="rm" name="sum_area" formula="sum" baseField="rm.area" dataType="number"   numericFormat="area" showTotals="true">
			<title>Area</title>
		</field>
        <parameter name="dv_id" dataType="verbatim" value="1=1"/>
        <parameter name="dp_id" dataType="verbatim" value="1=1"/>
        <parameter name="bl_id" dataType="verbatim" value="1=1"/>
        <parameter name="fl_id" dataType="verbatim" value="1=1"/>
        <parameter name="rm_id" dataType="verbatim" value="1=1"/>
        <parameter name="rm_cat" dataType="verbatim" value="1=1"/>
        <parameter name="rm_type" dataType="verbatim" value="1=1"/>
        <parameter name="occupancy" dataType="verbatim" value="1=1"/>
        <parameter name="rm_std" dataType="verbatim" value="1=1"/>
        <parameter name="organizationUnassigned" dataType="verbatim" value="1=1"/>
        <parameter name="typeUnassigned" dataType="verbatim" value="1=1"/>
        <parameter name="excludedHotalableRm" dataType="verbatim" value="5=5"/>
        <parameter name="having" dataType="verbatim" value=""/>
  </dataSource>
  
  	
    <panel type="legend" role="legend" format="table"
        id="panel_highlightRoomOccupantDs1_legend"
        dataSource="highlightRoomOccupantDs1_legend">
        <title translatable="true">Legend</title>
      
       <field table="uc_rmoccupant" name="occupant_id" >
            <title>Occupant ID</title>
        </field>
		<field table="uc_rmoccupant" name="name" >
            <title>Name</title>
        </field>
        
        <field table="uc_rmoccupant" name="hpattern_acad" >
            <title>Legend</title>
        </field>
        <field table="rm" name="sum_area" >
            <title>Area</title>
        </field>
    </panel>
</view>
