<view version="2.0">
	<designInfo type="paginated" pattern="ab-viewdef-paginated" isAlterable="true"/>
	<title translatable="true">Compliance Documents</title>
	<report orientation="landscape"/>

	<dataSource id="abCompDocPaginateDS">
        <table name="docs_assigned" role="main"/> 
        <table name="compliance_locations" role="standard"/>
        <table name="activity_log" role="standard"/>
        <table name="docfolder" role="standard"/>
        <table name="regprogram" role="standard"/>
        <table name="regrequirement" role="standard"/>
		<table name="regloc" role="standard"/>
        <field table="regloc" name="location_id" hidden="true"/>
        	
        <field table="docs_assigned" name="reg_requirement" />
        <field table="docs_assigned" name="reg_program" />
        <field table="docs_assigned" name="regulation" />

        <field table="docs_assigned" name="name" />
        <field table="docs_assigned" name="doc_cat" />
        <field table="docs_assigned" name="doc_author" />

		<field table="docs_assigned" name="doc" />
        <field table="docs_assigned" name="doc_type" />
        <field table="docs_assigned" name="doc_review_grp" />

        <field table="docs_assigned" name="date_doc" />
        <field table="docs_assigned" name="doc_folder" />
        <field table="docfolder" name="hierarchy_ids"/>

		<field table="compliance_locations" name="location_id"/> 
        <field table="docs_assigned" name="activity_log_id">
			<title>Event ID</title>
		</field>
        <field table="regrequirement" name="regreq_type" />

        <field table="docs_assigned" name="description" />
        <field table="docs_assigned" name="doc_note" />

		<field table="docs_assigned" name="vf_location" dataType="text">
			<title>Location Description</title>
			<sql dialect="generic">
				case when docs_assigned.location_id is null then ''
					 else (     (case when compliance_locations.geo_region_id is null 
					             or compliance_locations.city_id is not null then ''
										  else ${parameters['geo_region_id']} ${sql.concat} ': ' ${sql.concat} compliance_locations.geo_region_id ${sql.concat} '; ' 
									 end ) ${sql.concat} 
									 ( case when compliance_locations.ctry_id is null then ''
										  else ${parameters['ctry_id']} ${sql.concat} ': ' ${sql.concat} compliance_locations.ctry_id ${sql.concat} '; ' 
									 end ) ${sql.concat} 
									 ( case when compliance_locations.site_id is null then ''
										  else ${parameters['site_id']} ${sql.concat} ': ' ${sql.concat} compliance_locations.site_id ${sql.concat} '; ' 
									 end ) ${sql.concat} 
									 ( case when compliance_locations.bl_id is null then ''
										  else ${parameters['bl_id']} ${sql.concat} ': ' ${sql.concat} compliance_locations.bl_id ${sql.concat} '; ' 
									 end ) ${sql.concat} 
									 ( case when compliance_locations.fl_id is null then ''
										  else ${parameters['fl_id']} ${sql.concat} ': ' ${sql.concat} compliance_locations.fl_id ${sql.concat} '; ' 
									 end ) ${sql.concat} 
									 ( case when compliance_locations.rm_id is null then ''
										  else ${parameters['rm_id']} ${sql.concat} ': ' ${sql.concat} compliance_locations.rm_id ${sql.concat} '; ' 
									 end ) ${sql.concat}
									 ( case when compliance_locations.city_id is null then ''
										  else ${parameters['city_id']} ${sql.concat} ': ' ${sql.concat} compliance_locations.city_id ${sql.concat} '; ' 
									 end ) ${sql.concat} 
									 ( case when compliance_locations.state_id is null then ''
										  else ${parameters['state_id']} ${sql.concat} ': ' ${sql.concat} compliance_locations.state_id ${sql.concat} '; ' 
									 end ) ${sql.concat} 
									 ( case when compliance_locations.regn_id is null then ''
										  else ${parameters['regn_id']} ${sql.concat} ': ' ${sql.concat} compliance_locations.regn_id ${sql.concat} '; ' 
									 end ) ${sql.concat} 
									 ( case when compliance_locations.county_id is null then ''
										  else ${parameters['county_id']} ${sql.concat} ': ' ${sql.concat} compliance_locations.county_id ${sql.concat} '; ' 
									 end ) ${sql.concat} 
									 ( case when compliance_locations.pr_id is null then ''
										  else ${parameters['pr_id']} ${sql.concat} ': ' ${sql.concat} compliance_locations.pr_id ${sql.concat} '; ' 
									 end ) ${sql.concat} 
									 ( case when compliance_locations.eq_id is null then ''
										  else ${parameters['eq_id']} ${sql.concat} ': ' ${sql.concat} compliance_locations.eq_id ${sql.concat} '; ' 
									 end ) ${sql.concat} 
									 ( case when compliance_locations.eq_std is null then ''
										  else ${parameters['eq_std']} ${sql.concat} ': ' ${sql.concat} compliance_locations.eq_std ${sql.concat} '; ' 
									 end ) ${sql.concat} 
									 ( case when compliance_locations.em_id is null then ''
										  else ${parameters['em_id']} ${sql.concat} ': ' ${sql.concat} compliance_locations.em_id 
									 end )  
								)
				end
			</sql>
		</field>
		<field table="docs_assigned" name="doc_id" hidden="true"/>
		<field table="docs_assigned" name="url"/>
		<field table="activity_log" name="activity_log_id" hidden="true"/> 
		<field table="regprogram" name="reg_program" hidden="true"/> 

        <parameter name="geo_region_id" dataType="text" value=" 1=1 "/>        
        <parameter name="ctry_id" dataType="text" value=" 1=1 "/>        
        <parameter name="regn_id" dataType="text" value=" 1=1 "/>        
        <parameter name="state_id" dataType="text" value=" 1=1 "/>        
        <parameter name="city_id" dataType="text" value=" 1=1 "/>        
        <parameter name="county_id" dataType="text" value=" 1=1 "/>        
        <parameter name="pr_id" dataType="text" value=" 1=1 "/>        
        <parameter name="site_id" dataType="text" value=" 1=1 "/>        
        <parameter name="bl_id" dataType="text" value=" 1=1 "/>        
        <parameter name="fl_id" dataType="text" value=" 1=1 "/>        
        <parameter name="rm_id" dataType="text" value=" 1=1 "/>        
        <parameter name="eq_id" dataType="text" value=" 1=1 "/>        
        <parameter name="eq_std" dataType="text" value=" 1=1 "/>        
        <parameter name="em_id" dataType="text" value=" 1=1 "/>        
        <parameter name="consoleRes" dataType="verbatim" value=" 1=1 "/> 
        <restriction type="sql" sql=" ${parameters['consoleRes']} "/>

        <sortField table="docs_assigned" name="regulation" ascending="true"/>
        <sortField table="docs_assigned" name="reg_program"  ascending="true"/>
        <sortField table="docs_assigned" name="reg_requirement"  ascending="true"/>
	</dataSource>
	
	<panel id="abCompDocPaginate" dataSource="abCompDocPaginateDS" format="column" columns="3" role="data">

        <field table="docs_assigned" name="regulation" />
        <field table="docs_assigned" name="reg_program" />
        <field table="docs_assigned" name="reg_requirement" />

        <field table="docs_assigned" name="name" />
        <field table="docs_assigned" name="doc_author" />
        <field table="docs_assigned" name="doc_folder" />

        <field table="docs_assigned" name="doc_cat" />
        <field table="docs_assigned" name="date_doc" />
        <field table="docfolder" name="hierarchy_ids">
          <title translatable="true">Folder Path</title>
        </field>

        <field table="docs_assigned" name="doc_type" />
        <field table="docs_assigned" name="doc_review_grp" />
        <field table="docs_assigned" name="activity_log_id">
          <title translatable="true">Event ID</title>
        </field>

		<field table="docs_assigned" name="vf_location">
		   <title>Location Description</title>
        </field>
		<field table="docs_assigned" name="url"/>

        <field table="docs_assigned" name="doc"/>
        <field table="docs_assigned" name="description" />
        <field table="docs_assigned" name="doc_note" />
	</panel>
</view>
