(function(e){e.drag=function(){var m=function(n){return n},k=d3.dispatch("drop"),l;var j=d3.behavior.drag().origin(function(){var o=this.ownerSVGElement||this;var r=((o.previousSibling&&o.previousSibling.nodeName==="svg")||(o.nextSibling&&o.nextSibling.nodeName==="svg"));var n=(r)?o:o.parentNode;var q=(r)?n.getBoundingClientRect().top-n.scrollTop:n.getBoundingClientRect().top-n.scrollTop;var p=o.parentNode.getBoundingClientRect().left+Number(o.style.marginLeft.replace("px",""));return{x:p,y:q}}).on("dragstart",function(){a();c();this.__offset__=d3.mouse(this);var o=this.ownerSVGElement||this,p=o.getBoundingClientRect();var s=((o.previousSibling&&o.previousSibling.nodeName==="svg")||(o.nextSibling&&o.nextSibling.nodeName==="svg"));var n=(s)?o:o.parentNode;var t=(navigator.userAgent.match("Firefox"))?5:0;var r=(s)?n.getBoundingClientRect().left+t+1:n.getBoundingClientRect().left;var q=n.getBoundingClientRect().top-n.scrollTop;l=d3.select("body").append("svg").attr("width",p.width+"px").attr("height",p.height+"px").style("position","absolute").style("pointer-events","none").style("left",r+"px").style("top",q+"px");l.node().appendChild(this.cloneNode(true))}).on("drag",function(){var s=this.__offset__;var q=this.ownerSVGElement||this;var r=(d3.select(q.parentNode).selectAll("svg")[0].length>1)?true:false;var p=(d3.touch(q))?d3.touch(q):d3.mouse(q);if(r){var n=(d3.touch(document.body))?d3.touch(document.body):d3.mouse(document.body);n[0]-=d3.select(q).attr("width")/2;n[1]-=d3.select(q).attr("height")/2;l.style("left",(n[0])+"px").style("top",(n[1])+"px")}else{l.style("left",d3.event.x+"px").style("top",d3.event.y+"px")}}).on("dragend",function(u){var n=this.__offset__,p=+l.style("left").replace(/px$/,""),v=+l.style("top").replace(/px$/,"");delete this.__offset__;l.remove();var w=document.body.getBoundingClientRect(),y=d3.mouse(document.body),s=m(document.elementFromPoint(y[0]+w.left,y[1]+w.top));if(!s){return}var t=d3.select(s);g=t.append("g"),node=l.node().firstChild,container=s.ownerSVGElement||s;y=container.createSVGPoint();var x=((container.previousSibling&&container.previousSibling.nodeName==="svg")||(container.nextSibling&&container.nextSibling.nodeName==="svg"));var z=(x)?container:container.parentNode;y.x=p+n[0]-z.getBoundingClientRect().left,y.y=v+n[1]-z.getBoundingClientRect().top;y=y.matrixTransform(s.getCTM().inverse());y.x-=n[0],y.y-=n[1];g.node().appendChild(node);d3.select(node).attr("transform","translate("+y.x+","+y.y+")rotate(0)");var q=(navigator.userAgent.indexOf("Edge")!=-1);if(q&&!d3.select(node).select("use").empty()){var r=d3.select(node).select("use").attr("y");d3.select(node).select("use").attr("y",r)}k.drop.call(node,u,z.getBoundingClientRect().left)});j.target=function(n){if(!arguments.length){return m}m=typeof n==="function"?n:function(p){var o;n.each(function(){if(!o&&this.parentNode.contains(p.correspondingUseElement||p)){o=this}});return o};return j};return d3.rebind(j,k,"on")};e.group=function(){var o=false,j=function(p){return p.selectAll(".groupable")},m=[],k=d3.dispatch("clone"),l=("ontouchstart" in document.documentElement)?13.5:6.5;function n(A){var p=A.append("rect").attr("class","group"),r=p.node(),w=A.append("g").attr("class","edit group").style("display","none"),u=w.node(),C=w.append("rect").attr("class","group"),t=[];var s=w.append("g");var y=w.append("g").attr("transform","translate(-30)").attr("class","move").call(d3.behavior.drag().on("dragstart",a).on("drag",function(){var F=d3.event.dx,D=d3.event.dy;for(var H=0;H<t.length;++H){var I=t[H],E=v.getScreenCTM().inverse().multiply(I.getScreenCTM());G=I.firstChild.transform.baseVal.getItem(0);G.setTranslate(G.matrix.e+F*E.a,G.matrix.f+D*E.d)}var G=C.node();G.x.baseVal.value+=F,G.y.baseVal.value+=D;var G=s.node().transform.baseVal.getItem(0);G.setTranslate(G.matrix.e+F,G.matrix.f+D);var G=this.transform.baseVal.getItem(0);G.setTranslate(G.matrix.e+F,G.matrix.f+D)}));y.append("circle").attr("r",l);y.append("path").attr("d",h);var B=s.append("g").attr("class","clone").attr("transform","translate(-15)").on("mousedown",a).on("touchstart",a).on("click",function(){for(var F=0;F<t.length;++F){var H=t[F],G=H.parentNode,I=H.cloneNode(true),E=v.createSVGTransform(),D=v.getScreenCTM().inverse().multiply(H.getScreenCTM());sx=D.a,sy=D.d;E.setTranslate(10*sx,10*sy);I.transform.baseVal.appendItem(E);G.appendChild(I);k.clone.call(I)}z()});B.append("circle").attr("r",l);B.append("path").attr("d","M-4,-4h7v7h-7zM-3,-3h7v7h-7z");var x=s.append("g").attr("class","delete").on("mousedown",a).on("touchstart",a).on("click",function(){a();if(confirm("Are you sure you want to delete this group?")){for(var D=0;D<t.length;++D){d3.select(t[D]).remove()}z()}});x.append("circle").attr("r",l);x.append("path").attr("d",f).attr("transform","translate(-6,-6)scale(.4)");var v=A.node();A.on("mousedown.group",q).on("touchstart.group",q);function q(){if(!o){return}var E=v,H=d3.mouse(E);p.attr({x:H[0],y:H[1],width:0,height:0});z();var D=d3.select(window);if(d3.event.touches&&d3.event.touches.length){D.on("touchmove.group",F).on("touchend.group",G)}else{D.on("mousemove.group",F).on("mouseup.group",G)}function F(){a();d3.event.preventDefault();var I=d3.mouse(E);p.attr("x",Math.min(I[0],H[0])).attr("y",Math.min(I[1],H[1])).attr("width",Math.abs(I[0]-H[0])).attr("height",Math.abs(I[1]-H[1]))}function G(){var L=d3.mouse(E),K=Math.min(L[0],H[0]),P=Math.min(L[1],H[1]),J=K+Math.abs(L[0]-H[0]),O=P+Math.abs(L[1]-H[1]),I=Infinity,Q=-Infinity,N=Infinity,M=-Infinity;t=[];j(A).each(function(){if(this===r||this===u){return}var V=this.getBBox(),Y=V.x,X=Y+V.width,S=V.y,R=S+V.height,T=v.getScreenCTM().inverse().multiply(this.getScreenCTM());var W=v.createSVGPoint();W.x=Y,W.y=S;W=W.matrixTransform(T);Y=W.x,S=W.y;W.x=X,W.y=R;W=W.matrixTransform(T);X=W.x,R=W.y;if(K<=Y&&X<=J&&P<=S&&R<=O){var U=d3.select(this);if(this.__selected__=!this.__selected__){}else{}}if(this.__selected__){t.push(this);if(Y<I){I=Y}if(X<I){I=X}if(Y>Q){Q=Y}if(X>Q){Q=X}if(S<N){N=S}if(R<N){N=R}if(S>M){M=S}if(R>M){M=R}}});p.attr({x:null,y:null,width:null,height:null});if(isFinite(I)){w.style("display",null);C.attr({x:I,y:N,width:Q-I,height:M-N});s.attr("transform","translate("+Q+","+N+")");y.attr("transform","translate("+(Q-30)+","+N+")")}else{z()}D.on(".group",null)}}function z(){w.style("display","none");for(var D=0;D<t.length;++D){delete t[D].__selected__}t.length=0}}n.active=function(p){return arguments.length?(o=!!p,n):o};n.select=function(p){return arguments.length?(j=p,n):j};return d3.rebind(n,k,"on")};e.move=function(j){return d3.behavior.drag().origin(function(){var k=this.firstChild.transform.baseVal.getItem(0).matrix;return{x:k.e,y:k.f}}).on("dragstart",a).on("drag",function(){this.firstChild.transform.baseVal.getItem(0).setTranslate(d3.event.x,d3.event.y);if(j){j()}})};e.onClickEditGrip=function(){alert("Edit dialog.")};e.edit=function(){var j="click.placement-edit",k=("ontouchstart" in document.documentElement)?14:6.5;return function(m){m.on(j,l);m.on("touchend.placement-edit",l);function l(){if(d3.event.defaultPrevented){return}a();var I=this,u=I.parentNode,r=I.firstChild,z=r.transform.baseVal.getItem(0).matrix,K=r.transform.baseVal.getItem(1),p=I.getBBox(),H,n,G,N,F=I.ownerSVGElement||I;var A=F.getScreenCTM().inverse().multiply(I.getScreenCTM());var q=F.createSVGPoint(),o=F.createSVGPoint(),C;G=o.x=(H=q.x=p.x)+p.width;N=o.y=(n=q.y=p.y)+p.height;q=q.matrixTransform(A);o=o.matrixTransform(A);if(q.x>o.x){C=q.x,q.x=o.x,o.x=C}if(q.y>o.y){C=q.y,q.y=o.y,o.y=C}var y=o.x-q.x,s=o.y-q.y;var D=p.width/2,M=p.height/2;d3.select(I).on(j,null);var L=d3.select(F).append("g").on("mousedown",a).on("touchstart",a).attr("class","edit").attr("transform","rotate(0)translate("+q.x+","+q.y+")");var J=L.insert("g","*").attr("class","delete").attr("transform","translate("+y+")").on("mousedown",a).on("touchstart",E).on(j,E);J.append("circle").attr("r",k);J.append("path").attr("d",f).attr("transform","translate(-6,-6)scale(.4)");J=L.insert("g","*").attr("class","rotate").attr("transform","translate("+[y/2,s/2]+")").on("mousedown",a).on("touchstart",function(){a();var w=L.append("g").attr("class","rotate-angle").attr("transform","translate("+y/2+","+s/2+")");w.append("line").attr("x1",6.5).attr("x2",100);w.append("circle").attr("cx",100).attr("r",k-1).on("mousedown",t).on("touchstart",t);function t(){a();var R=this,S=d3.mouse(F),T=K.angle,Q=100;if(d3.event.touches&&d3.event.touches.length){d3.select(window).on("touchmove.placement-rotate",P).on("touchend.placement-rotate",O)}else{d3.select(window).on("mousemove.placement-rotate",P).on("mouseup.placement-rotate",O)}function P(){c();var V=d3.mouse(F),W=Math.atan2(Q*(V[1]-S[1]),Q*(Q+V[0]-S[0]))*180/Math.PI,U=0.5*(H+G),X=0.5*(n+N);L.attr("transform","rotate("+W+" "+[q.x+y/2,q.y+s/2]+")translate("+q.x+","+q.y+")");K.setRotate(T+W,U-z.e,X-z.f)}function O(){d3.select(window).on(".placement-rotate",null);x()}}}).on(j,function(){a();var w=L.append("g").attr("class","rotate-angle").attr("transform","translate("+y/2+","+s/2+")");w.append("line").attr("x1",6.5).attr("x2",100);w.append("circle").attr("cx",100).attr("r",5.5).on("mousedown",t).on("touchstart",t);function t(){a();var R=this,S=d3.mouse(F),T=K.angle,Q=100;if(d3.event.touches&&d3.event.touches.length){d3.select(window).on("touchmove.placement-rotate",P).on("touchend.placement-rotate",O)}else{d3.select(window).on("mousemove.placement-rotate",P).on("mouseup.placement-rotate",O)}function P(){c();var V=d3.mouse(F),W=Math.atan2(Q*(V[1]-S[1]),Q*(Q+V[0]-S[0]))*180/Math.PI,U=0.5*(H+G),X=0.5*(n+N);L.attr("transform","rotate("+W+" "+[q.x+y/2,q.y+s/2]+")translate("+q.x+","+q.y+")");K.setRotate(T+W,U-z.e,X-z.f)}function O(){d3.select(window).on(".placement-rotate",null);x()}}});J.append("circle").attr("r",k);J.append("path").attr("d","M24.083,15.5c-0.009,4.739-3.844,8.574-8.583,8.583c-4.741-0.009-8.577-3.844-8.585-8.583c0.008-4.741,3.844-8.577,8.585-8.585c1.913,0,3.665,0.629,5.09,1.686l-1.782,1.783l8.429,2.256l-2.26-8.427l-1.89,1.89c-2.072-1.677-4.717-2.688-7.587-2.688C8.826,3.418,3.418,8.826,3.416,15.5C3.418,22.175,8.826,27.583,15.5,27.583S27.583,22.175,27.583,15.5H24.083z").attr("transform","translate(-6,-6)scale(.4)");J=L.insert("g","*").attr("class","edit").attr("transform","translate("+p.width+","+p.height+")").on("mousedown",a).on("touchstart",B).on(j,B);J.append("circle").attr("r",k);J.append("path").attr("d","M25.31,2.872l-3.384-2.127c-0.854-0.536-1.979-0.278-2.517,0.576l-1.334,2.123l6.474,4.066l1.335-2.122C26.42,4.533,26.164,3.407,25.31,2.872zM6.555,21.786l6.474,4.066L23.581,9.054l-6.477-4.067L6.555,21.786zM5.566,26.952l-0.143,3.819l3.379-1.787l3.14-1.658l-6.246-3.925L5.566,26.952z").attr("transform","translate(-4.5,-4.5)scale(.3)");L.insert("rect","*").attr("width",p.width).attr("height",p.height);var v=d3.select(window).on("touchstart",x).on(j,x);function E(){a();if(confirm("Are you sure you want to delete this item?")){d3.select(I).remove();x()}}function B(){a();if(e.onClickEditGrip){e.onClickEditGrip(I)}x()}function x(){L.remove();d3.select(I).on(j,l);v.on(j,null)}}}};function d(){var k=d3.event,j;while(j=k.sourceEvent){k=j}return k}function a(){d().stopPropagation()}function c(){d().preventDefault()}function i(k,j){return k[0]*j[1]-k[1]*j[0]}function b(k,j){return k[0]*j[0]+k[1]*j[1]}var f="M20.826,5.75l0.396,1.188c1.54,0.575,2.589,1.44,2.589,2.626c0,2.405-4.308,3.498-8.312,3.498c-4.003,0-8.311-1.093-8.311-3.498c0-1.272,1.21-2.174,2.938-2.746l0.388-1.165c-2.443,0.648-4.327,1.876-4.327,3.91v2.264c0,1.224,0.685,2.155,1.759,2.845l0.396,9.265c0,1.381,3.274,2.5,7.312,2.5c4.038,0,7.313-1.119,7.313-2.5l0.405-9.493c0.885-0.664,1.438-1.521,1.438-2.617V9.562C24.812,7.625,23.101,6.42,20.826,5.75zM11.093,24.127c-0.476-0.286-1.022-0.846-1.166-1.237c-1.007-2.76-0.73-4.921-0.529-7.509c0.747,0.28,1.58,0.491,2.45,0.642c-0.216,2.658-0.43,4.923,0.003,7.828C11.916,24.278,11.567,24.411,11.093,24.127zM17.219,24.329c-0.019,0.445-0.691,0.856-1.517,0.856c-0.828,0-1.498-0.413-1.517-0.858c-0.126-2.996-0.032-5.322,0.068-8.039c0.418,0.022,0.835,0.037,1.246,0.037c0.543,0,1.097-0.02,1.651-0.059C17.251,18.994,17.346,21.325,17.219,24.329zM21.476,22.892c-0.143,0.392-0.69,0.95-1.165,1.235c-0.474,0.284-0.817,0.151-0.754-0.276c0.437-2.93,0.214-5.209-0.005-7.897c0.881-0.174,1.708-0.417,2.44-0.731C22.194,17.883,22.503,20.076,21.476,22.892zM11.338,9.512c0.525,0.173,1.092-0.109,1.268-0.633h-0.002l0.771-2.316h4.56l0.771,2.316c0.14,0.419,0.53,0.685,0.949,0.685c0.104,0,0.211-0.017,0.316-0.052c0.524-0.175,0.808-0.742,0.633-1.265l-1.002-3.001c-0.136-0.407-0.518-0.683-0.945-0.683h-6.002c-0.428,0-0.812,0.275-0.948,0.683l-1,2.999C10.532,8.77,10.815,9.337,11.338,9.512z";var h="M-5,0H5 M0,-5V5 M-5,0l1,1 M-4,-1l-1,1l1,1 M4,-1l1,1l-1,1 M-1,-4l1,-1l1,1 M-1,4l1,1l1,-1"})(placement={});(function(l){var v=-1,u="click.redline-edit",I="touchstart.redline-edit",B=Math.PI/180,z=("ontouchstart" in document.documentElement)?13.5:6.5;var j=(window.navigator.userAgent.indexOf("MSIE ")>0?true:false);l.z_MESSAGE_ENTER_TEXT="Please enter the text box content:";l.z_MESSAGE_DELETE="Are you sure you want to delete this object?";l.z_TITLE="Redline";var e=2;var o=10;var r=null;l.cloud=function(L){var M=L.selectAll("path").data([0]);M.enter().append("path").classed({"redline-path":true}).attr("d",p(75*e,50*e))};l.cloud.edit=function(O,R){if(R[1]){o=R[1]}r=R[2];F(O);var P=O.selectAll("path").style("stroke-width",0.15*(o/10)*e+"em");var Q=w(P.attr("d")),M=Q.width,L=Q.height;O.on(u,N).on(I,N);N();function N(){O.on(u,null);if(!O.select(".edit").empty()){return}var aa=O.select("rect");var V=w(P.attr("d")),T=V.width,ab=V.height;var W=O.append("g").attr("class","edit");var U=W.append("g").attr("transform","translate("+T+")scale("+e*1.5+")").call(h,function(){d3.select(O.node().parentNode).remove();Z();if(r){r()}});var ad=W.append("g").attr("transform","scale("+e*1.5+")").on("mousedown",d).on("touchstart",d).on("click",d).call(D,O.node().parentNode,function(am,ak){var an=O.select("rect");var ai=w(P.attr("d")),ae=ai.width,ao=ai.height;var ap=O.node().transform.baseVal.getItem(0),af=ap.matrix.e+ae,al=ap.matrix.f+ao;var ah=s(O);var aj=(j?O.node().style.left.replace(/px$/,""):0);var ag=(j?20:0);ae=Math.max(0,af-am-aj/ah)+ag;ao=Math.max(0,al-ak)-ag;P.attr("d",p(ae,ao));ap.setTranslate(af-ae,al-ao);U.attr("transform","translate("+(ae+aj)+")scale("+e*1.5+")");ac.attr("transform","translate("+(ae+aj)+","+ao+")scale("+e*1.5+")");an.attr("width",ae).attr("height",ao);if(r){r()}});var ac=W.append("g").attr("transform","translate("+T+","+ab+")scale("+e*1.5+")").on("mousedown",d).on("touchstart",d).on("click",d).call(D,O.node().parentNode,function(ak,aj){var al=O.select("rect");var ag=w(P.attr("d")),ae=ag.width,am=ag.height;var an=O.node().transform.baseVal.getItem(0);var ah=s(O);var ai=(j?Number(O.node().style.left.replace(/px$/,"")):0);var af=(j?20:0);ae=Math.max(0,(ak+ai/ah-af-an.matrix.e));am=Math.max(0,aj-an.matrix.f)+af;P.attr("d",p(ae,am));U.attr("transform","translate("+ae+")scale("+e*1.5+")");ac.attr("transform","translate("+ae+","+am+")scale("+e*1.5+")");al.attr("width",ae).attr("height",am);if(r){r()}});var S="click.redline-edit-"+(++v),Y="touchstart.redline-edit-"+v,X=d3.select(window).on(S,Z).on(Y,Z);function Z(){W.remove();O.on(u,N);X.on(S,null).on(Y,null)}}};l.attachEvent=function(N,O){var M=O[0];var L=(O[1]?O[1]:false);if(O[2]){o=O[2]}r=O[3];N.on(u,l[M].edit.createDelegate(N,[N,L,o,r])).on(I,l[M].edit.createDelegate(N,[N,L,o,r]))};function p(M,L){var O=Math.abs(M)/75,N=Math.abs(L)/50;return"M"+[52*O,45*N]+" a"+[4*O,4*N]+" 0 0 0 0,"+-20*N+" a"+[4*O,4*N]+" 0 0 0 "+[-30*O,-10*N]+" a"+[4*O,4*N]+" 0 0 0 "+[-10*O,30*N]+"z"}function w(L){L=L.replace("M ","M");var M=L.split(/[M, \s]/g);return{width:+M[1]/52*75,height:+M[2]/45*50}}l.line=n(i,true);l.arrow=n(t,false);function i(M,P,L,O,N){return"M"+M+","+P+"L"+L+","+O}function t(N,R,M,Q,P){var L=Math.atan2(Q-R,M-N),O=Math.sin(L),S=Math.cos(L);return"M"+N+","+R+"L"+M+","+Q+"M"+M+","+Q+"l"+(3*P*O-5*P*S)+","+(-3*P*S-5*P*O)+"l"+-6*P*O+","+6*P*S+"z"}function n(L,N){function M(O){var P=O.selectAll("path").data([0]);if(L==="line"){P.enter().append("path").classed({"redline-path":true}).attr("d",L(0,40*e,50*e,10*e,1*e))}else{P.enter().append("path").classed({"arrow-path":true}).attr("d",L(0,40*e,50*e,10*e,1*e))}}M.edit=function(R,Q){if(Q[1]){o=Q[1]}r=Q[2];F(R);var W=R.selectAll("path").style("stroke-width",0.15*(o/10)*e+"em"),S=C(W.attr("d")),P=S[0],V=S[1],O=S[2],T=S[3];R.on(u,U).on(I,U);U();function U(){R.on(u,null);if(!R.select(".edit").empty()){return}var ak=R.selectAll("path"),ad=C(ak.attr("d")),Z=ad[0],ai=ad[1],Y=ad[2],af=ad[3];shadow=R.select("line").attr("x1",Z).attr("y1",ai).attr("x2",Y).attr("y2",af);var ae=(N?1:Math.sqrt((Y-Z)*(Y-Z)+(af-ai)*(af-ai))/Math.sqrt(100*100+60*60));var aa=R.append("g").attr("class","edit").call(h,function(){d3.select(R.node().parentNode).remove();aj();if(r){r()}});if(!d3.select(R.node().parentNode).selectAll(".arrow").empty()){aa.attr("transform","translate("+ak.node().getPointAtLength((ak.node().getTotalLength()/2)-8).x+","+ak.node().getPointAtLength((ak.node().getTotalLength()/2)-8).y+")scale("+e*1.5+")")}else{aa.attr("transform","translate("+ak.node().getPointAtLength(ak.node().getTotalLength()/2).x+","+ak.node().getPointAtLength(ak.node().getTotalLength()/2).y+")scale("+e*1.5+")")}var ac=R.append("g").attr("class","edit").attr("transform","translate("+Z+","+ai+")scale("+e*1.5+")").on("mousedown",d).on("touchstart",d).on("click",d).call(d3.behavior.drag().on("drag",function(){var ao=s(R);var al=(j?Number(R.node().style.left.replace(/px$/,"")):0);var an=(j?20:0);Z=d3.event.x+al/ao-an;ai=d3.event.y+an;var am=(N?1:Math.sqrt((Y-Z)*(Y-Z)+(af-ai)*(af-ai))/Math.sqrt(100*100+60*60));ac.attr("r",z).attr("transform","translate("+(Z+e*1.5)+","+(ai+e*1.5)+")scale("+e*1.5+")");if(N){ak.attr("d",L(Z,ai,Y,af,1))}else{ak.attr("d",L(Z,ai,Y,af,am))}if(!d3.select(R.node().parentNode).selectAll(".arrow").empty()){aa.attr("transform","translate("+ak.node().getPointAtLength((ak.node().getTotalLength()/2)-8).x+","+ak.node().getPointAtLength((ak.node().getTotalLength()/2)-8).y+")scale("+e*1.5+")")}else{aa.attr("transform","translate("+ak.node().getPointAtLength(ak.node().getTotalLength()/2).x+","+ak.node().getPointAtLength(ak.node().getTotalLength()/2).y+")scale("+e*1.5+")")}shadow.attr("x1",Z).attr("y1",ai).attr("x2",Y).attr("y2",af);if(r){r()}}));ac.append("circle").attr("r",z);ac.append("path").attr("d",y);var ab=R.append("g").attr("class","edit").attr("transform","translate("+Y+","+af+")scale("+e*1.5+")").on("mousedown",d).on("touchstart",d).on("click",d).call(d3.behavior.drag().on("drag",function(){var ao=s(R);var al=(j?Number(R.node().style.left.replace(/px$/,"")):0);var an=(j?20:0);Y=d3.event.x+al/ao-an;af=d3.event.y+an;var am=(N?1:Math.sqrt((Y-Z)*(Y-Z)+(af-ai)*(af-ai))/Math.sqrt(100*100+60*60));ac.attr("r",z).attr("transform","translate("+(Z+e*1.5)+","+(ai+e*1.5)+")scale("+e*1.5+")");ab.attr("r",z).attr("transform","translate("+(Y+e*1.5)+","+(af+e*1.5)+")scale("+e*1.5+")");if(N){ak.attr("d",L(Z,ai,Y,af,1))}else{ak.attr("d",L(Z,ai,Y,af,am))}if(!d3.select(R.node().parentNode).selectAll(".arrow").empty()){aa.attr("transform","translate("+ak.node().getPointAtLength((ak.node().getTotalLength()/2)-8).x+","+ak.node().getPointAtLength((ak.node().getTotalLength()/2)-8).y+")scale("+e*1.5+")")}else{aa.attr("transform","translate("+ak.node().getPointAtLength(ak.node().getTotalLength()/2).x+","+ak.node().getPointAtLength(ak.node().getTotalLength()/2).y+")scale("+e*1.5+")")}shadow.attr("x1",Z).attr("y1",ai).attr("x2",Y).attr("y2",af);if(r){r()}}));ab.append("circle").attr("r",z);ab.append("path").attr("d",y);var X="click.redline-edit-"+(++v),ah="touchstart.redline-edit-"+v,ag=d3.select(window).on(X,aj).on(ah,aj);function aj(){aa.remove();ac.remove();ab.remove();R.on("click",U);ag.on(X,null).on(ah,null)}}};return M}function C(L){L=L.replace("M ","M");L=L.replace(" L ","L");L=L.replace(/ /g,",");return L.split(/[ML,\s]/g).slice(1,5).map(Number)}l.arrowTextbox=A(true,false,false,false);l.textbox=A(false,false,false,false);l.area=A(false,true,false,false);l.swatch=A(false,false,true,false);l.textOnly=A(false,false,false,true);function A(M,L,S,T){var Q=(M)?28*e:50*e,P=Q*Math.SQRT1_2,O=(M)?15*e:0;function N(X){var aa=X.selectAll(".textbox-arrow").data(M?[0]:[]);var ae=aa.enter().append("g").attr("class","textbox-arrow").attr("transform","translate("+(Q/2+O)+","+(Q/2+O)+")rotate(0)");ae.append("path").attr("d","M"+-Q+",0L0,"+Q+"L0,"+P+"A"+[P,P]+" "+[0,0,1]+" 0,"+-P+"L0,"+-Q+"Z");ae.append("circle").attr("r",P).style("fill","none").style("stroke","#000");aa.exit().remove();var ad=X.text();var W=X.selectAll(".box");if(!L&&!S&&!W.empty()&&!ad){Ext.Msg.prompt(l.z_TITLE,l.z_MESSAGE_ENTER_TEXT,function(ag,af){if(ag==="ok"){var ah=X.select(".redline-text");ah.text(af);ah.call(E,af,X,R,M,0)}})}var Z=(L)?"box area-path":"box redline-path";if(S){Z="box swatch-path"}W=W.data([0]);var V=W.enter().append("path").attr("class",Z).attr("d",J(O,O,Q,Q,L));var U=m(W.attr("d"),L),R=U.width,ac=U.height,Y=U.radius;var ab=X.select("rect");if(M||T){V.style("stroke-opacity",0)}}N.edit=function(Z,W){var ac=(W[0]?W[0]:false);if(W[1]){o=W[1]}r=W[2];F(Z);var ag=Z.text();var ae=Z.select("rect");var Y=Z.selectAll(".box");if(!M){Y.style("stroke-width",0.15*(o/10)*e+"em")}var U=m(Y.attr("d"),L),R=U.width,af=U.height,ab=U.radius;if(M&&T){Y.style("stroke-opacity",1)}var V=Y.style("stroke");if(!L&&!S){if(ac&&!Y.empty()&&!ag){Ext.Msg.prompt(l.z_TITLE,l.z_MESSAGE_ENTER_TEXT,function(ai,ah){if(ai==="ok"){var aj=Z.select(".redline-text");aj.attr("fill",V);if(aj.empty()){if(!R||R<80*e){R=80*e;af=80*e}ae.attr({width:R,height:af});Y.attr("d",J(O,O,R,af,L));aj=Z.append("text").attr({width:R-U.radius-2*o,height:af-U.radius-2*o,x:R+U.radius+o,y:af+U.radius+o,"class":"redline-text"}).text(ag);aj.call(E,ah,Z,R,M,ab)}else{if(aj.text()===""){aj.text(ah);aj.call(E,ah,Z,R,M,ab)}}}})}var aa=Z.select(".redline-text");if(aa.empty()){if(!R||R<80*e){R=80*e;af=80*e}ae.attr({width:R,height:af});Y.attr("d",J(O,O,R,af,L));aa=Z.append("text").attr({width:R-U.radius-2*o,height:af-U.radius-2*o,x:R+U.radius+o,y:af+U.radius+o,"class":"redline-text"}).text(ag);aa.call(E,ag,Z,R,M,ab)}else{if(aa.text()===""){aa.text(ag);aa.call(E,ag,Z,R,M,ab)}}aa.style("stroke",V).style("fill",V).style("font-size",(o)+"px").style("font-family","Arial").attr("transform","translate("+(O+ab)+","+(O)+")")}var X=d3.behavior.drag().on("dragstart",function(){var ah=d3.mouse(this.parentNode),aj=this.transform.baseVal.getItem(1).angle,ai=Math.atan2(Q/2-ah[1],Q/2-ah[0])/B-aj,ak=[(-Q+O)*Math.cos(aj*B),(-Q+O)*Math.sin(aj*B)];X.on("drag",function(){var al=[-Q/2+d3.event.x,-Q/2+d3.event.y],am=Math.atan2(b(ak,al),K(ak,al))/B-ai;d3.select(this).attr("transform","translate("+(Q/2+O)+","+(Q/2+O)+") rotate("+(aj+am)+")")})});Z.selectAll(".textbox-arrow").on("mousedown",x).on("touchstart",x).call(X);var U=m(Y.attr("d"),L),R=U.width,af=U.height,ab=U.radius;Z.on(u,ad).on(I,ad);ad();function ad(){Z.on(u,null);if(!Z.select(".edit").empty()){return}if(M||T){Y.style("stroke-opacity",1)}var ak=m(Y.attr("d"),L),ai=ak.width,at=ak.height;ab=ak.radius;var al=Z.append("g").attr("class","edit").attr("transform","translate("+O+","+O+")");var an=Z.select(".redline-text");var aj=al.append("g").attr("transform","translate("+(ai-ab+ab*Math.cos(45))+","+(ab-ab*Math.sin(45))+")scale("+e*1.5+")").call(h,function(){d3.select(Z.node().parentNode).remove();aq();if(r){r()}});if(!M){var av=al.append("g").attr("transform","translate("+(ab-ab*Math.cos(45))+","+(ab-ab*Math.sin(45))+")scale("+e*1.5+")").on("mousedown",d).on("touchstart",d).on("click",d).call(D,Z.node().parentNode,function(aC,aA){var aD=Z.text();var aE=Z.node().transform.baseVal.getItem(0),aw=aE.matrix.e+ai,aB=aE.matrix.f+at;var ay=s(Z);var az=(j?Z.node().style.left.replace(/px$/,""):0);var ax=(j?20:0);ai=Math.max(0,aw-aC)-az/ay+ax;at=Math.max(0,aB-aA)-ax;ab=(L)?Math.min(ai,at)/5:0;Y.attr("d",J(O,O,ai,at,L));aE.setTranslate(aw-ai,aB-at);av.attr("transform","translate("+(ab-ab*Math.cos(45))+","+(ab-ab*Math.sin(45))+")scale("+e*1.5+")");aj.attr("transform","translate("+(ai-ab+ab*Math.cos(45))+","+(ab-ab*Math.sin(45))+")scale("+e*1.5+")");au.attr("transform","translate("+(ai-ab+ab*Math.cos(45))+","+(at-ab+ab*Math.sin(45))+")scale("+e*1.5+")");ar.attr("transform","translate("+(ab-ab*Math.cos(45))+","+(at-ab+ab*Math.sin(45))+")scale("+e*1.5+")");ae.attr({width:ai,height:at});if(!S&&an){an.style("stroke",V).style("fill",V).attr("transform","translate("+(O+ab)+","+(O)+")");an.call(E,aD,Z,ai,M,ab)}if(r){r()}});var au=al.append("g").attr("transform","translate("+(ai-ab+ab*Math.cos(45))+","+(at-ab+ab*Math.sin(45))+")scale("+e*1.5+")").on("mousedown",d).on("touchstart",d).on("click",d).call(D,Z.node().parentNode,function(ax,aC){var aB=Z.text();var ay=Z.node().transform.baseVal.getItem(0);var aA=s(Z);var aw=(j?Number(Z.node().style.left.replace(/px$/,"")):0);var az=(j?20:0);ai=Math.max(0,(ax+aw/aA-az-ay.matrix.e));at=Math.max(0,aC-ay.matrix.f)+az;ab=(L)?Math.min(ai,at)/5:0;Y.attr("d",J(O,O,ai,at,L));av.attr("transform","translate("+(ab-ab*Math.cos(45))+","+(ab-ab*Math.sin(45))+")scale("+e*1.5+")");aj.attr("transform","translate("+(ai-ab+ab*Math.cos(45))+","+(ab-ab*Math.sin(45))+")scale("+e*1.5+")");au.attr("transform","translate("+(ai-ab+ab*Math.cos(45))+","+(at-ab+ab*Math.sin(45))+")scale("+e*1.5+")");ar.attr("transform","translate("+(ab-ab*Math.cos(45))+","+(at-ab+ab*Math.sin(45))+")scale("+e*1.5+")");ae.attr({width:ai,height:at});if(!S&&an){an.style("stroke",V).style("fill",V).attr("transform","translate("+(O+ab)+","+(O)+")");an.call(E,aB,Z,ai,M,ab)}if(r){r()}})}if(S){var ar=al.append("g").attr("transform","translate(0, "+at+")scale("+e*1.5+")").on("mousedown",d).on("touchstart",d).on("click",d).call(f,Z.node().parentNode,function(ax,aD){var az=Z.node().transform.baseVal.getItem(0),ay=az.matrix.e+ai,aB=az.matrix.f;var aC=s(Z);var aw=(j?Z.node().style.left.replace(/px$/,""):0);var aA=(j?20:0);ai=Math.max(0,ay-ax)-aw/aC+aA;at=Math.max(0,aD-az.matrix.f)+aA;Y.attr("d",J(O,O,ai,at,false));az.setTranslate(ay-ai,aB);av.attr("transform","translate("+(ab-ab*Math.cos(45))+","+(ab-ab*Math.sin(45))+")scale("+e*1.5+")");aj.attr("transform","translate("+(ai-ab+ab*Math.cos(45))+","+(ab-ab*Math.sin(45))+")scale("+e*1.5+")");au.attr("transform","translate("+(ai-ab+ab*Math.cos(45))+","+(at-ab+ab*Math.sin(45))+")scale("+e*1.5+")");ar.attr("transform","translate("+(ab-ab*Math.cos(45))+","+(at-ab+ab*Math.sin(45))+")scale("+e*1.5+")");ae.attr({width:ai,height:at});ag=Z.text();an.call(E,ag,Z,ai,M,ab);if(r){r()}})}else{var ar=al.append("g").attr("transform","translate("+(ab-ab*Math.cos(45))+","+(at-ab+ab*Math.sin(45))+")scale("+e*1.5+")").call(a,function(){am();if(r){r()}})}var ah="click.redline-edit-"+(++v),ap="touchstart.redline-edit-"+v,ao=d3.select(window).on(ah,aq).on(ap,aq);function aq(){al.remove();if(M||T){Y.style("stroke-opacity",0)}Z.on(u,ad);ao.on(ah,null).on(ap,null)}function am(){if(M||T){Y.style("stroke-opacity",1)}var aB=Z.text();var aA=m(Y.attr("d"),L),ay=aA.width,ax=aA.height,aw=aA.radius;var az=Z.select(".redline-text");Ext.Msg.prompt(l.z_TITLE,l.z_MESSAGE_ENTER_TEXT,function(aE,aD){if(aE==="ok"){if(az.empty()){if(!ay||ay<80*e){ay=80*e;ax=80*e}ae.attr({width:ay,height:ax});Y.attr("d",J(O,O,ay,ax,L));az=Z.append("text").attr({width:ay-aA.radius-2*o,height:ax-aA.radius-2*o,x:ay+aA.radius+o,y:ax+aA.radius+o,"class":"redline-text"}).text(aD)}else{az.text(aD)}var aC=Y.style("stroke");az.style("stroke",aC).style("fill",aC).style("font-size",(o)+"px").style("font-family","Arial").call(E,aD,Z,ay,M,aw)}});aB=Z.text();aq();az.call(E,aB,Z,ay,M,aw)}}};return N}function J(N,P,O,M,L){O=Math.abs(O);M=Math.abs(M);if(L){radius=Math.min(O,M)/5}else{radius=0}if(radius<1){return"M"+(N+5)+","+(P+5)+"h"+O+"v"+M+"h"+-O+"z"}else{return"M"+(N+5)+","+(P+5+radius)+"a"+radius+","+radius+" 0 0 1 "+radius+","+-radius+"h"+(O-2*radius)+"a"+radius+","+radius+" 0 0 1 "+radius+","+radius+"v"+(M-2*radius)+"a"+radius+","+radius+" 0 0 1 "+-radius+","+radius+"h"+-(O-2*radius)+"a"+radius+","+radius+" 0 0 1 "+-radius+","+-radius+"v"+-(M-2*radius)+"z"}}function m(M,L){M=M.replace(/M /g,"M");M=M.replace(/ h /g,"h");M=M.replace(/ v /g,"v");M=M.replace(/ a /g,"a");M=M.replace(/ Z/g,"");if(!L){M=M.replace(/ /g,",")}var O=M.split(/[Mahvz,]/g);if(L){var N=(window.navigator.userAgent.indexOf("Edge/")>0?true:false);if(j||N){var P=(O[2]).split(/[ ]/g);return{width:(+O[3])+2*(+P[0]),height:(+O[5])+2*(+P[0]),radius:+P[0]}}else{return{width:(+O[6])+2*(+O[3]),height:(+O[10])+2*(+O[3]),radius:+O[3]}}}else{return{width:+O[3],height:Math.abs(+O[4]),radius:0}}}function h(L,N){var M=L.append("g").attr("class","delete").on("touchstart",function(){d3.event.stopPropagation();if(confirm(l.z_MESSAGE_DELETE)){N()}}).on("click",function(){d3.event.stopPropagation();if(confirm(l.z_MESSAGE_DELETE)){N()}});M.append("circle").attr("r",z);M.append("path").attr("d",q).attr("transform","translate(-6,-6)scale(.4)")}function a(L,N){var M=L.append("g").attr("class","edit").on("touchstart",function(){N()}).on("click",function(){N()});M.append("circle").attr("r",z);M.append("path").attr("d",k).attr("transform","translate(-5,-5)scale(.34)")}function D(M,O,P){var L=d3.behavior.drag().on("dragstart",function(){x();L.on("drag",function(){var Q=d3.mouse(O);P(Q[0],Q[1])}).on("dragend",function(){L.on("drag",null).on("dragend",null)})});var N=M.append("g").attr("class","resize").call(L);N.append("circle").attr("r",z);N.append("path").attr("d",H)}function f(M,O,P){var L=d3.behavior.drag().on("dragstart",function(){x();L.on("drag",function(){var Q=d3.mouse(O);P(Q[0],Q[1])}).on("dragend",function(){L.on("drag",null).on("dragend",null)})});var N=M.append("g").attr("class","resize").call(L);N.append("circle").attr("r",z);N.append("path").attr("d",G)}var q="M20.826,5.75l0.396,1.188c1.54,0.575,2.589,1.44,2.589,2.626c0,2.405-4.308,3.498-8.312,3.498c-4.003,0-8.311-1.093-8.311-3.498c0-1.272,1.21-2.174,2.938-2.746l0.388-1.165c-2.443,0.648-4.327,1.876-4.327,3.91v2.264c0,1.224,0.685,2.155,1.759,2.845l0.396,9.265c0,1.381,3.274,2.5,7.312,2.5c4.038,0,7.313-1.119,7.313-2.5l0.405-9.493c0.885-0.664,1.438-1.521,1.438-2.617V9.562C24.812,7.625,23.101,6.42,20.826,5.75zM11.093,24.127c-0.476-0.286-1.022-0.846-1.166-1.237c-1.007-2.76-0.73-4.921-0.529-7.509c0.747,0.28,1.58,0.491,2.45,0.642c-0.216,2.658-0.43,4.923,0.003,7.828C11.916,24.278,11.567,24.411,11.093,24.127zM17.219,24.329c-0.019,0.445-0.691,0.856-1.517,0.856c-0.828,0-1.498-0.413-1.517-0.858c-0.126-2.996-0.032-5.322,0.068-8.039c0.418,0.022,0.835,0.037,1.246,0.037c0.543,0,1.097-0.02,1.651-0.059C17.251,18.994,17.346,21.325,17.219,24.329zM21.476,22.892c-0.143,0.392-0.69,0.95-1.165,1.235c-0.474,0.284-0.817,0.151-0.754-0.276c0.437-2.93,0.214-5.209-0.005-7.897c0.881-0.174,1.708-0.417,2.44-0.731C22.194,17.883,22.503,20.076,21.476,22.892zM11.338,9.512c0.525,0.173,1.092-0.109,1.268-0.633h-0.002l0.771-2.316h4.56l0.771,2.316c0.14,0.419,0.53,0.685,0.949,0.685c0.104,0,0.211-0.017,0.316-0.052c0.524-0.175,0.808-0.742,0.633-1.265l-1.002-3.001c-0.136-0.407-0.518-0.683-0.945-0.683h-6.002c-0.428,0-0.812,0.275-0.948,0.683l-1,2.999C10.532,8.77,10.815,9.337,11.338,9.512z";var H="M-4,-2v-2h2 M-4,-4l8,8 M4,2v2h-2";var G="M-4,2v2h2 M-4,4l8,-8 M4,-2v-2h-2";var k="M25.31,2.872l-3.384-2.127c-0.854-0.536-1.979-0.278-2.517,0.576l-1.334,2.123l6.474,4.066l1.335-2.122C26.42,4.533,26.164,3.407,25.31,2.872zM6.555,21.786l6.474,4.066L23.581,9.054l-6.477-4.067L6.555,21.786zM5.566,26.952l-0.143,3.819l3.379-1.787l3.14-1.658l-6.246-3.925L5.566,26.952z";var y="M-5,0H5 M0,-5V5 M-5,0l1,1 M-4,-1l-1,1l1,1 M4,-1l1,1l-1,1 M-1,-4l1,-1l1,1 M-1,4l1,1l1,-1";function c(){var M=d3.event,L;while(L=M.sourceEvent){M=L}return M}function x(){c().stopPropagation()}function d(){var L=c();L.stopPropagation();L.preventDefault()}function b(M,L){return M[0]*L[1]-M[1]*L[0]}function K(M,L){return M[0]*L[0]+M[1]*L[1]}function E(U,O,R,M,T,S){var L=(O)?O.length-O.replace(/^\s+/,"").length:0;var P="";var N="";if(L>0){P=O.substring(0,L);for(var Q=0;Q<L;Q++){N+="#"}O=O.replace(O.substring(0,L),N)}if(T&&O.length>0){U.text(null).append("tspan").attr("width",160).attr("height",40).attr("x",0).attr("dy",-140-o/2).text(O);return}U.each(function(){var ac=d3.select(this),X=(O===null)?[""]:O.split(/\s+/).reverse(),V,ae=[],W=0,aa=1.1,Z=10+o,ad=R.node().transform.baseVal.getItem(0).matrix.f;var Y=ac.text(null).append("tspan").attr("x",15+S).attr("y",Z);var ab=X[X.length-1];if(ab.substring(0,L)==N){ab=ab.replace(N,P);X[X.length-1]=ab}while(V=X.pop()){ae.push(V+" ");Y.text(ae.join(" "));if(Y.node().getComputedTextLength()>M-15-2*S){if(ae.length<2){ae=[];++W;Z+=o;Y=ac.append("tspan").attr("x",15+S).attr("y",Z)}else{ae.pop();Y.text(ae.join(" "));ae=[V+" "];++W;Z+=o;Y=ac.append("tspan").attr("x",15+S).attr("y",Z).text(V)}}}})}function F(M){var L=M.select("text")[0][0];if(L){L.parentNode.removeChild(L)}}function s(M){var L=1;if(j){try{var O=d3.select("#defaultView").attr("viewBox").split(" ");if(O.length===1){O=d3.select("#defaultView").attr("viewBox").split(",")}var N=(Number(O[2])-Number(O[0]));L=N/M.node().ownerSVGElement.viewBox.baseVal.width}catch(P){}}return L}})(redline={});var PlacementSvg=DrawingSvg.extend({onEdit:null,onDrop:null,constructor:function(a,c,d,b){this.inherit(a,c,b);this.legendId=d},loadLegend:function(a){if(a.onEdit){this.onEdit=a.onEdit}if(a.onDrop){this.onDrop=a.onDrop}this.loadSvgFile(a)},setup:function(e,j,b){var f=d3.select("#"+this.divId);var c=this;f.classed("no-selection",true);var a=placement.move(),i=placement.edit();if(this.onEdit){placement.onClickEditGrip=function(){c.onEdit(node)}}var d=f.select("#"+c.divId+"-svg");if(this.isModernBrowser()){d.style("cursor","move")}var h=d3.select("#"+this.legendId).select("svg");h.attr("height",d3.select("#"+this.legendId).select("svg").node().getBBox().height);this.patchFloorplanElements(j,d.selectAll("#"+j).selectAll("use"),a,i);this.patchLegendElements(d3.select("#"+this.legendId).selectAll("."+b));d3.select("#"+this.legendId).selectAll(".draggable").call(placement.drag().on("drop",function(){d3.select(this).classed("dropped",true).call(a).call(i);c.copyDefintion(d3.select(this).select("use"),c.legendId,c.divId);if(c.onDrop){c.onDrop(d3.select(this).node())}}).target(function(l){var k=c.createGroupIfNotExists(f.selectAll("#assets"),j,b).node();if(f.select("#"+c.divId+"-svg").node().parentNode.contains(l.correspondingUseElement||l)){return k}}));this.attachGroupListener()},attachGroupListener:function(){var e=this;var b=placement.move(),c=placement.edit();var d=placement.group().on("clone",function(){d3.select(this).call(b).call(c)});var a=d3.select("#"+e.divId).select("#"+e.divId+"-svg").call(d);d3.select("#"+e.legendId+"_group").on("change",function(){d.active(this.checked);var f=d3.select("#"+e.divId);a=f.select("#"+e.divId+"-svg");if(this.checked){f.on(".viewboxzoom",null).on(".zoom",null);if(e.isModernBrowser()){a.style("cursor","crosshair")}}else{a.call(viewBoxZoom());if(e.isModernBrowser()){a.style("cursor","move")}}})},copyDefintion:function(d,e,f){var b=d;if(!b.empty()){var j=b.attr("xlink:href");var i=d3.select("#"+f).selectAll("defs");if(i.selectAll(j).empty()){var a=d3.select("#"+e).select("defs");var c=a.select(j);var h=c.node().cloneNode(true);i.node().appendChild(h)}}},patchFloorplanElements:function(a,d,b,c){d.each(function(){if(d3.select(this.parentNode).attr("id")===a){var f=d3.select(this.parentNode).append("g").attr("class","editable draggable groupable").call(b).call(c).append("g").attr("transform","translate(0)rotate(0)");f.node().appendChild(this);var e=f.node().getBBox();f.append("rect").attr("class","background").attr("x",e.x).attr("y",e.y).attr("width",e.width).attr("height",e.height)}})},patchLegendElements:function(a){var b=this;a.each(function(){var e=d3.select(this.parentNode).append("g").attr("class","editable draggable groupable").append("g").attr("transform","translate(0)rotate(0)");e.node().appendChild(this);var d=e.node().getBBox();if(b.isSafari5()){var c=(this.parentNode.parentNode.parentNode.nextSibling.y)?(this.parentNode.parentNode.parentNode.nextSibling.y.baseVal.value-this.y.baseVal.value):50;e.append("rect").attr("class","background").attr("y",this.y.baseVal.value).attr("width",c).attr("height",(d.height>10)?d.height:c-4)}else{e.append("rect").attr("class","background").attr("x",d.x).attr("y",d.y).attr("width",d.width).attr("height",d.height)}})},copyAssets:function(a,e){var d=this;var b=[];var c=d3.select("#"+a).selectAll("#"+e).selectAll(".dropped");c.each(function(){var f=d3.select(this).node().cloneNode(true);d.hideGrips(f,true);b.push(f)});return b},hideGrips:function(b,a){var c=(a)?"none":"";d3.select(b).selectAll(".edit").each(function(){this.style.display=c})},pasteAssets:function(j,c,l,h,e){var f=this;var b=d3.selectAll("#"+j);if(c){var k=f.createGroupIfNotExists(b.selectAll("#assets"),l,h).node();for(var d=0;d<c.length;d++){var a=d3.select(k).append("g").node().appendChild(c[d]);d3.select(a).call(placement.edit()).call(placement.move())}b.selectAll("#assets").selectAll("#"+l).selectAll("use").each(function(){f.copyDefintion(d3.select(this),e,j)})}return c},loadSvgFile:function(a){var c=a.legend;var b=a.file;var d=a.afterLoad;c.html("");if(a.useService){DrawingSvgService.loadSvg(b,{async:false,callback:function(e){c.html(e);d()},errorHandler:function(f){}})}else{d3.text(b,function(e,f){c.html(f);d(e)})}},createGroupIfNotExists:function(a,d,b){var c=a.selectAll("#"+d);if(c.empty()){c=a.append("g").attr("id",d).attr("class",b)}return c},isSafari5:function(){return !!navigator.userAgent.match(" Safari/")&&!navigator.userAgent.match(" Chrom")&&!!navigator.userAgent.match(" Version/5.")},getRotation:function(c){var b=/rotate\((.*)\)/.exec(c),a=this.getPatternValues(b,[0,0,0]);return[Number(a[0]),Number(a[1])||0,Number(a[2])||0]},getTranslation:function(c){var a=/translate\((.*?)\)/.exec(c),b=this.getPatternValues(a,[0,0]);return[Number(b[0])||0,Number(b[1])||0]},getPatternValues:function(b,c){if(!b){return c}var a=[];if(b[1].indexOf(",")>-1){a=b[1].replace(/\s/g,"").split(",")}else{a=b[1].replace(/[\s]+/g," ").split(" ")}return a},serializeXmlNode:function(a){if(typeof window.XMLSerializer!=="undefined"){return(new window.XMLSerializer()).serializeToString(a)}else{if(typeof a.xml!=="undefined"){return a.xml}}return""}},{});var RedlineSvg=DrawingSvg.extend({redlineTypes:["cloud","line","textbox","arrow","area","swatch","arrowTextbox","textOnly"],onDrop:null,onChange:null,currentColor:"#FF0000",legendWidth:"75",legendHeight:"75",legendMargin:"5px 0px 0px 5px",legendTitle:"",colorPickerId:"",colorPickerControl:null,scaleFactor:2,currentFontSize:10,constructor:function(a,c,d,b){this.inherit(a,b);this.readConfig(b);this.panelId=c;this.legendId=d},readConfig:function(a){if(!a||!a.redlineLegend){return}if(a.redlineLegend.panelId){this.panelId=a.redlineLegend.panelId}if(a.redlineLegend.divId){this.legendId=a.redlineLegend.divId}if(a.redlineLegend.title){this.legendTitle=a.redlineLegend.title}if(a.redlineLegend.style){if(a.redlineLegend.style.legendWidth){this.legendWidth=a.redlineLegend.style.legendWidth}if(a.redlineLegend.style.legendHeight){this.legendHeight=a.redlineLegend.style.legendHeight}if(a.redlineLegend.style.legendMargin){this.legendMargin=a.redlineLegend.style.legendMargin}}if(a.redlineLegend.colorPickerId){this.colorPickerId=a.redlineLegend.colorPickerId}if(a.redlineTypes&&a.redlineTypes.length>0){this.redlineTypes=a.redlineTypes}},loadLegend:function(a){if(a.onDrop){this.onDrop=a.onDrop}this.readConfig(a);this.setup()},setup:function(){var c=d3.select("#"+this.divId);c.classed("no-selection",true);var f=this;var b=placement.move(f.onChange),d=placement.edit(),e=placement.group().on("clone",function(){d3.select(this).call(b).call(d)});var a=c.select("#"+this.divId+"-svg").call(e);if(this.isModernBrowser()){a.style("cursor","move")}this.setupRedlining(c,this.divId)},loadColorPicker:function(a){if(this.colorPickerId&&document.getElementById(this.colorPickerId)!=null){this.colorPickerControl=new Ab.svg.ColorPicker(this.colorPickerId,this.legendTitle,a)}},getColorPickerControl:function(){return this.colorPickerControl},setupRedlining:function(d,c){var b=d3.select("#"+c);var e=this;redline.z_MESSAGE_ENTER_TEXT=this.z_MESSAGE_ENTER_TEXT;redline.z_MESSAGE_DELETE=this.z_MESSAGE_DELETE;redline.z_TITLE=this.z_TITLE;var a=d3.select(".redline-legend").selectAll(".draggable").data(this.redlineTypes).enter().append("svg").attr("width",this.legendWidth).attr("height",this.legendHeight).style("margin",this.legendMargin).attr("class","draggable").append("g").attr("transform","scale(0.5)").attr("class",function(f){return"redline "+f}).call(placement.drag().on("drop",function(h,i){var f=placement.move(e.onChange);d3.select(this.parentNode).call(f).on("touchstart.redline-edit",function(){d3.event.stopPropagation();if(d3.event.defaultPrevented){return}}).on("click",function(){d3.event.stopPropagation();if(d3.event.defaultPrevented){return}});if(h=="textbox"||h=="textOnly"){d3.select(this).select(".letterA").remove()}else{if(h=="arrowTextbox"){d3.select(this).select(".letter1").remove()}}d3.select(this).classed("dropped",true).call(redline[h].edit,[true,e.currentFontSize,e.onChange]).style("left",i+"px");if(e.onDrop){e.onDrop(d3.select(this).node())}}).target(function(h){var f=e.createGroupIfNotExists(b.selectAll("#viewer"),"redlines","redlines").node();if(d.select("#"+c+"-svg").node().parentNode.contains(h.correspondingUseElement||h)){return f}}));a.append("rect").style("pointer-events","all").style("fill","none").attr("width",e.legendWidth*e.scaleFactor).attr("height",e.legendHeight*e.scaleFactor-15);a.each(function(h){d3.select(this).call(redline[h]);var f;if(h=="textbox"||h=="textOnly"){f=(36*e.scaleFactor)+"px";d3.select(this).append("g").attr("transform","translate("+(12*e.scaleFactor+5)+", "+(36*e.scaleFactor+5)+")").classed({letterA:true}).style({"font-family":"Arial",fill:"#f00","font-size":f}).append("text").text("A")}else{if(h=="arrowTextbox"){f=(20*e.scaleFactor)+"px";d3.select(this).append("g").attr("transform","translate("+(23*e.scaleFactor)+", "+(36*e.scaleFactor)+")").classed({letter1:true}).style({"font-family":"Arial",fill:"#f00","font-size":f}).append("text").text("1")}}d3.select(this).append("text").attr("width",e.legendWidth*e.scaleFactor).attr("height",15*e.scaleFactor).attr("x",function(i){return Math.max(0,(e.legendWidth*e.scaleFactor-i.length*10)/(2*e.scaleFactor))}).attr("y",(e.legendHeight-10)*e.scaleFactor).style({"font-family":"Arial","font-size":(10*e.scaleFactor)+"px",align:"center"}).text(function(i){if(i=="arrowTextbox"){return"Arrow Textbox"}else{if(i=="textOnly"){return"Text Only"}else{return i.toLowerCase().replace(/\b[a-z]/g,function(j){return j.toUpperCase()})}}})});this.setCurrentColor(this.currentColor)},setCurrentColor:function(a){if(!a){return}var b=a.search("#");if(b==-1){a="#"+a}this.currentColor=a;d3.select(".redline-legend").selectAll(".redline-path").style("stroke",this.currentColor);d3.select(".redline-legend").selectAll(".arrow-path").style("fill",this.currentColor).style("stroke",this.currentColor);d3.select(".redline-legend").selectAll(".area-path").style("fill",this.currentColor).style("stroke",this.currentColor).style("fill-opacity",0.3);d3.select(".redline-legend").selectAll(".swatch-path").style("fill",this.currentColor).style("stroke",this.currentColor);d3.select(".redline-legend").select(".textbox-arrow > path").style("fill",this.currentColor).style("stroke",this.currentColor);d3.select(".redline-legend").select(".textbox-arrow > circle").style("stroke",this.currentColor);d3.select(".redline-legend").selectAll(".letterA").style("fill",this.currentColor);d3.select(".redline-legend").selectAll(".letter1").style("fill",this.currentColor);if(this.colorPickerControl){this.colorPickerControl.updateCustomColor(this.currentColor)}},setCurrentFontSize:function(a){var b=(this.currentFontSize-10)/5;if(a){b++}else{b--}this.currentFontSize=(10+5*b)>0?(10+5*b):0},retrieveRedmarks:function(){var a=d3.selectAll("#"+this.divId).selectAll("#redlines").selectAll(".dropped");a.selectAll(".edit").remove();var b="";var c=this;a.each(function(){var d=d3.select(this).node().cloneNode(true);c.removeGrips(d);b+="<g>"+c.serializeXmlNode(d)+"</g>"});if(b){b='<svg xmlns="http://www.w3.org/2000/svg">'+b+"</svg>"}return b},createGroupIfNotExists:function(a,d,b){var c=a.selectAll("#"+d);if(c.empty()){c=a.append("g").attr("id",d).attr("class",b)}return c},copyAssets:function(b){var d=this;var c=[];var a=d3.selectAll("#"+b).selectAll("#redlines").selectAll(".dropped");a.selectAll(".edit").remove();a.each(function(){var e=d3.select(this).node().cloneNode(true);d.removeGrips(e);c.push(e)});return c},removeGrips:function(a){d3.select(a).selectAll(".edit").each(function(){d3.select(this).remove()})},hideGrips:function(b,a){var c=(a)?"none":"";d3.select(b).selectAll(".edit").each(function(){this.style.display=c})},attachRedlineEvents:function(){var c=this;var d=function(){d3.event.stopPropagation();if(d3.event.defaultPrevented){return}};var b=d3.selectAll("#"+this.divId).selectAll("#redlines").selectAll(".dropped");var a=placement.move(c.onChange);b.each(function(){for(var e=0;e<c.redlineTypes.length;++e){var f=c.redlineTypes[e];if(d3.select(this).classed(f)){var h=[false,c.currentFontSize,c.onChange];d3.select(this).call(redline.attachEvent,[f,h]).on("click",d).on("touchstart.redline-edit",d);d3.select(this.parentNode).call(a).on("click",d).on("touchstart.redline-edit",d)}}})},pasteAssets:function(o,f,p,d,k){var c=d3.selectAll("#"+o);d3.selectAll("#"+k).selectAll("#"+p);if(!f){return}var n=this.createGroupIfNotExists(c.selectAll("#viewer"),"redlines","redlines").node();var l=this;var b=placement.move(l.onChange);var a=function(){d3.event.stopPropagation();if(d3.event.defaultPrevented){return}};for(var h=0;h<f.length;h++){var m=d3.select(n).append("g").node();m.appendChild(f[h]);for(var e=0;e<this.redlineTypes.length;++e){if(d3.select(m).select("g").classed(this.redlineTypes[e])){d3.select(m).select("g").call(redline[this.redlineTypes[e]].edit,[true,l.currentFontSize,l.onChange]);d3.select(m).call(b).on("click",a).on("touchstart.redline-edit",a)}}}},serializeXmlNode:function(a){if(typeof window.XMLSerializer!=="undefined"){return(new window.XMLSerializer()).serializeToString(a)}else{if(typeof a.xml!=="undefined"){return a.xml}}return""}},{});