<view version="2.0">
	<!--title translatable="true">Plan Move Scenario</title-->
	
	<message name="selectBeforeUnassign" translatable="true">You must select at least one employee before pressing Unassign</message>
	<message name="msg_project_updated" translatable="true">The move project has been updated from the employee assignments in Scenario:</message>
	<message name="countOver" translatable="true">Employee Count will exceed Employee Capacity, Do you wish to continue?</message>
    <message name="selectFloor" translatable="true">Select a floor</message>
    <message name="selectEm" translatable="true">Select employees</message>
    <message name="selectRm" translatable="true">Select a room to assign selected employees to</message>
    <message name="selectAnotherEm" translatable="true">Select other employee</message>
    <message name="saving" translatable="true">Saving changes...</message>
    <message name="confirmMessage" translatable="true">Are you sure you want to unassign the selected employees?</message>
    <message name="legendLevel1" translatable="true">Non-Occupiable</message>
    <message name="legendLevel2" translatable="true">Vacant</message>
    <message name="legendLevel3" translatable="true">Under-Capacity</message>
    <message name="legendLevel4" translatable="true">At Capacity</message>
    <message name="legendLevel5" translatable="true">Exceeds Capacity</message>
    <message name="legendLevel6" translatable="true">No Capacity Info</message>
	<message name="showCurrentMsg" translatable="true">Current Only</message>
	<message name="showCurrentPendingMsg" translatable="true">Current and Pending</message>
	
	<layout type="borderLayout" id="mainLayout">
		<north split="false" initialSize="5%" autoScroll="false"/>
		<west initialSize="250" split="true"/>
		<center autoScroll="true"/>
	</layout>
	<layout type="borderLayout" id="nestedLayout" containingLayout="mainLayout" region="west">
		<north id="treePosition" initialSize="250" split="true"/>
		<center id="emPosition" autoScroll="true"/>
	</layout>
    <layout id="nestedCenter" containingLayout="mainLayout" region="center">
        <center/>
        <south id="emAssignPosition" initialSize="20%" split="true"/>
    </layout>
    <layout id="nestedDwg" containingLayout="nestedCenter" region="center">
        <center id="drawingPosition" />
        <east id="legendPosition" initialSize="15%" split="true"/>
    </layout>
	
	<panel type="html" id="emptyPanel_abPlanMoveScenario" layout="mainLayout" region="north">
		<title translatable="false"></title>
	</panel>

	<dataSource id="ds_moveproject">
		<table name="project" role="main"/>
		<field table="project" name="project_id"/>
		<field table="project" name="date_start"/>
	</dataSource>

	<dataSource id="ds_abPlanMoveScenario_bl">
		<table name="bl" role="main"/>
		<field table="bl" name="bl_id"/>
		<field table="bl" name="name"/>
		<restriction type="sql" sql="EXISTS (SELECT 1 FROM rm WHERE rm.dwgname IS NOT NULL AND rm.bl_id = bl.bl_id)"/>
	</dataSource>

	<dataSource id="ds_abPlanMoveScenario_fl">
        <sql dialect="generic">
            SELECT rm.bl_id ${sql.as} bl_id, rm.fl_id ${sql.as} fl_id, rm.dwgname ${sql.as} dwgname FROM rm WHERE rm.dwgname IS NOT NULL GROUP BY rm.bl_id,rm.fl_id,rm.dwgname
        </sql>
        <table name="fl" role="main"/>
        <field name="fl_id"/>
        <field name="dwgname"/>
        <sortField name="fl_id" table="fl" ascending="true"/>
	</dataSource>

	<panel type="tree" id="tree_abPlanMoveScenario_bl" dataSource="ds_abPlanMoveScenario_bl" layoutRegion="treePosition">
		<title translatable="true">Select Floor</title>
		<panel type="tree" id="tree_abPlanMoveScenario_fl" dataSource="ds_abPlanMoveScenario_fl">
	        <event type="onClickNode">
	            <command type="callFunction" functionName="onClickTreeNode"/>
	        </event>
	        <field name="fl_id"/>
	        <field name="dwgname"/>
		</panel>
		<field table="bl" name="bl_id"/>
		<field table="bl" name="name"/>
	</panel>
	
	<dataSource id="ds_abPlanMoveScenario_em">
		<table name="mo_scenario_em" role="main"/>
		<table name="em" role="standard"/>
		<field table="mo_scenario_em" name="em_id"/>
        <field table="em" name="em_std"/>
        <field table="em" name="bl_id"/>
        <field table="em" name="fl_id"/>
        <field table="em" name="rm_id"/>
        <field table="em" name="dv_id"/>
        <field table="em" name="dp_id"/>
		<field table="mo_scenario_em" name="scenario_id"/>
		<field table="mo_scenario_em" name="project_id"/>
		<field table="mo_scenario_em" name="to_bl_id"/>
		<field table="mo_scenario_em" name="to_fl_id"/>
		<field table="mo_scenario_em" name="to_rm_id"/>
		<field table="mo_scenario_em" name="date_start"/>
		<field table="mo_scenario_em" name="date_end"/>
	</dataSource>
	
	<panel type="grid" id="list_abPlanMoveScenario_em" showOnLoad="false" multipleSelectionEnabled="true" dataSource="ds_abPlanMoveScenario_em"  layoutRegion="emPosition">
		<sortField table="mo_scenario_em" name="em_id" ascending="true"/>
		<title translatable="true">Employee to Locate</title>
		<field table="mo_scenario_em" name="em_id">
			<title translatable="true">Employee Name</title>
		</field>
        <field table="em" name="em_std"/>
        <field table="em" name="bl_id"/>
        <field table="em" name="fl_id"/>
        <field table="em" name="rm_id"/>
        <field table="em" name="dv_id"/>
        <field table="em" name="dp_id"/>
	</panel>

    <dataSource id="ds_abPlanMoveScenario_rmLabel1" type="DrawingControlLabels">
        <title translatable="true">Category-Type</title>
        <table name="rm" role="main"/>
        <field name="bl_id" hidden="true"/>
        <field name="fl_id" hidden="true"/>
        <field name="rm_id"/>
 		<field name="count_scenario_em" dataType="number" hidden="true">
			<sql dialect="generic">
				(SELECT COUNT(mo_scenario_em.em_id) FROM mo_scenario_em WHERE mo_scenario_em.project_id = ${parameters['projectId']} AND mo_scenario_em.scenario_id = ${parameters['scenarioId']} AND mo_scenario_em.to_bl_id = rm.bl_id AND mo_scenario_em.to_fl_id = rm.fl_id AND mo_scenario_em.to_rm_id = rm.rm_id)
			</sql>
		</field>
        <field name="count_em" dataType="number">
        	<sql dialect="generic">
				((SELECT COUNT(*) FROM em WHERE em.bl_id = rm.bl_id AND em.fl_id = rm.fl_id AND em.rm_id = rm.rm_id) + (SELECT COUNT(mo_scenario_em.em_id) FROM mo_scenario_em WHERE mo_scenario_em.project_id = ${parameters['projectId']} AND mo_scenario_em.scenario_id = ${parameters['scenarioId']} AND mo_scenario_em.to_bl_id = rm.bl_id AND mo_scenario_em.to_fl_id = rm.fl_id AND mo_scenario_em.to_rm_id = rm.rm_id))
        	</sql>
        </field>
        <field name="cap_em"/>
        <field name="rm_cat"/>
        <field name="rm_type"/>
 		<parameter name="projectId" dataType="text" value=""/>
		<parameter name="scenarioId" dataType="text" value=""/>
    </dataSource>
    
    <dataSource id="ds_abPlanMoveScenario_rmLabel2" type="DrawingControlLabels">
        <title translatable="true">Standard</title>
        <table name="rm" role="main"/>
        <field name="bl_id" hidden="true"/>
        <field name="fl_id" hidden="true"/>
        <field name="rm_id"/>
 		<field name="count_scenario_em" dataType="number" hidden="true">
			<sql dialect="generic">
				(SELECT COUNT(mo_scenario_em.em_id) FROM mo_scenario_em WHERE mo_scenario_em.project_id = ${parameters['projectId']} AND mo_scenario_em.scenario_id = ${parameters['scenarioId']} AND mo_scenario_em.to_bl_id = rm.bl_id AND mo_scenario_em.to_fl_id = rm.fl_id AND mo_scenario_em.to_rm_id = rm.rm_id)
			</sql>
		</field>
        <field name="count_em" dataType="number">
        	<sql dialect="generic">
				((SELECT COUNT(*) FROM em WHERE em.bl_id = rm.bl_id AND em.fl_id = rm.fl_id AND em.rm_id = rm.rm_id) + (SELECT COUNT(mo_scenario_em.em_id) FROM mo_scenario_em WHERE mo_scenario_em.project_id = ${parameters['projectId']} AND mo_scenario_em.scenario_id = ${parameters['scenarioId']} AND mo_scenario_em.to_bl_id = rm.bl_id AND mo_scenario_em.to_fl_id = rm.fl_id AND mo_scenario_em.to_rm_id = rm.rm_id))
        	</sql>
        </field>
        <field name="cap_em"/>
        <field name="rm_std"/>
 		<parameter name="projectId" dataType="text" value=""/>
		<parameter name="scenarioId" dataType="text" value=""/>
    </dataSource>
    
    <dataSource id="ds_abPlanMoveScenario_rmLabel3" type="DrawingControlLabels">
        <title translatable="true">Division-Department</title>
        <table name="rm" role="main"/>
        <field name="bl_id" hidden="true"/>
        <field name="fl_id" hidden="true"/>
        <field name="rm_id"/>
 		<field name="count_scenario_em" dataType="number" hidden="true">
			<sql dialect="generic">
				(SELECT COUNT(mo_scenario_em.em_id)  FROM mo_scenario_em WHERE mo_scenario_em.project_id = ${parameters['projectId']} AND mo_scenario_em.scenario_id = ${parameters['scenarioId']} AND mo_scenario_em.to_bl_id = rm.bl_id AND mo_scenario_em.to_fl_id = rm.fl_id AND mo_scenario_em.to_rm_id = rm.rm_id)
			</sql>
		</field>
        <field name="count_em" dataType="number">
        	<sql dialect="generic">
				((SELECT COUNT(*) FROM em WHERE em.bl_id = rm.bl_id AND em.fl_id = rm.fl_id AND em.rm_id = rm.rm_id) + (SELECT COUNT(mo_scenario_em.em_id) FROM mo_scenario_em WHERE mo_scenario_em.project_id = ${parameters['projectId']} AND mo_scenario_em.scenario_id = ${parameters['scenarioId']} AND mo_scenario_em.to_bl_id = rm.bl_id AND mo_scenario_em.to_fl_id = rm.fl_id AND mo_scenario_em.to_rm_id = rm.rm_id))
        	</sql>
        </field>
        <field name="cap_em"/>
        <field name="dv_id"/>
        <field name="dp_id"/>
 		<parameter name="projectId" dataType="text" value=""/>
		<parameter name="scenarioId" dataType="text" value=""/>
   </dataSource>

    <dataSource id="ds_abPlanMoveScenario_rmLabel4" type="DrawingControlLabels">
        <title translatable="true">Employee Names</title>
    	<sql dialect="generic">  		
			SELECT 
			    rm.bl_id ${sql.as} bl_id,
			    rm.fl_id ${sql.as} fl_id,
			    rm.rm_id ${sql.as} rm_id,
			    rm.cap_em  ${sql.as}  cap_em,
			    (SELECT COUNT(mo_scenario_em.em_id) 							         
			        FROM mo_scenario_em 							         
			        WHERE mo_scenario_em.project_id = ${parameters['projectId']} 					 	
			            AND mo_scenario_em.scenario_id = ${parameters['scenarioId']}						
			            AND mo_scenario_em.to_bl_id = rm.bl_id AND mo_scenario_em.to_fl_id = rm.fl_id 						
			            AND mo_scenario_em.to_rm_id = rm.rm_id)	 ${sql.as}  count_scenario_em,	
				((SELECT COUNT(*) FROM em WHERE em.bl_id = rm.bl_id AND em.fl_id = rm.fl_id AND em.rm_id = rm.rm_id) + 
				 (SELECT COUNT(mo_scenario_em.em_id) FROM mo_scenario_em WHERE mo_scenario_em.project_id = ${parameters['projectId']}
			            AND mo_scenario_em.scenario_id = ${parameters['scenarioId']}						
			            AND mo_scenario_em.to_bl_id = rm.bl_id AND mo_scenario_em.to_fl_id = rm.fl_id 						
			            AND mo_scenario_em.to_rm_id = rm.rm_id)) ${sql.as}  count_em,
				(SELECT MIN(em_id) 
					FROM 
					 (
					 	SELECT em.em_id ${sql.as} em_id,  em.bl_id ${sql.as} bl_id, em.fl_id ${sql.as} fl_id, em.rm_id ${sql.as} rm_id FROM em 
					 	UNION
					    SELECT mo_scenario_em.em_id ${sql.as} em_id, mo_scenario_em.to_bl_id ${sql.as} bl_id, mo_scenario_em.to_fl_id ${sql.as} fl_id, mo_scenario_em.to_rm_id ${sql.as} rm_id FROM mo_scenario_em 
							WHERE mo_scenario_em.project_id = ${parameters['projectId']} AND mo_scenario_em.scenario_id = ${parameters['scenarioId']}
					 ) ${sql.as} tmp_em
					 WHERE tmp_em.bl_id = rm.bl_id AND tmp_em.fl_id = rm.fl_id AND tmp_em.rm_id = rm.rm_id
				) ${sql.as} option1,
				(SELECT MIN(em_id)
					FROM
					 (
					 	SELECT em.em_id ${sql.as} em_id,  em.bl_id ${sql.as} bl_id, em.fl_id ${sql.as} fl_id, em.rm_id ${sql.as} rm_id FROM em
					 	UNION
					    SELECT mo_scenario_em.em_id ${sql.as} em_id, mo_scenario_em.to_bl_id ${sql.as} bl_id, mo_scenario_em.to_fl_id ${sql.as} fl_id, mo_scenario_em.to_rm_id ${sql.as} rm_id FROM mo_scenario_em 
							WHERE mo_scenario_em.project_id = ${parameters['projectId']} AND mo_scenario_em.scenario_id = ${parameters['scenarioId']}
					 ) ${sql.as} tmp_em
					 WHERE tmp_em.bl_id = rm.bl_id AND tmp_em.fl_id = rm.fl_id AND tmp_em.rm_id = rm.rm_id
					   AND em_id &lt;&gt; ( SELECT MIN(em_id) 
												FROM 
												 (
												 	SELECT em.em_id ${sql.as} em_id,  em.bl_id ${sql.as} bl_id, em.fl_id ${sql.as} fl_id, em.rm_id ${sql.as} rm_id FROM em
												 	UNION
												    SELECT mo_scenario_em.em_id ${sql.as} em_id, mo_scenario_em.to_bl_id ${sql.as} bl_id, mo_scenario_em.to_fl_id ${sql.as} fl_id, mo_scenario_em.to_rm_id ${sql.as} rm_id FROM mo_scenario_em 
														WHERE mo_scenario_em.project_id = ${parameters['projectId']} AND mo_scenario_em.scenario_id = ${parameters['scenarioId']}
												 ) ${sql.as} tmp_em 
												 WHERE tmp_em.bl_id = rm.bl_id AND tmp_em.fl_id = rm.fl_id AND tmp_em.rm_id = rm.rm_id )
				) ${sql.as} option2,
				(SELECT MIN(em_id)
					FROM
					 (
					 	SELECT em.em_id ${sql.as} em_id,  em.bl_id ${sql.as} bl_id, em.fl_id ${sql.as} fl_id, em.rm_id ${sql.as} rm_id FROM em
					 	UNION
					    SELECT mo_scenario_em.em_id ${sql.as} em_id, mo_scenario_em.to_bl_id ${sql.as} bl_id, mo_scenario_em.to_fl_id ${sql.as} fl_id, mo_scenario_em.to_rm_id ${sql.as} rm_id FROM mo_scenario_em 
						WHERE mo_scenario_em.project_id = ${parameters['projectId']} AND mo_scenario_em.scenario_id = ${parameters['scenarioId']}
					 ) ${sql.as} tmp_em
					 WHERE tmp_em.bl_id = rm.bl_id AND tmp_em.fl_id = rm.fl_id AND tmp_em.rm_id = rm.rm_id
					   AND em_id &lt;&gt; ( SELECT MIN(em_id) 
												FROM 
												 (
												 	SELECT em.em_id ${sql.as} em_id,  em.bl_id ${sql.as} bl_id, em.fl_id ${sql.as} fl_id, em.rm_id ${sql.as} rm_id FROM em
												 	UNION
												    SELECT mo_scenario_em.em_id ${sql.as} em_id, mo_scenario_em.to_bl_id ${sql.as} bl_id, mo_scenario_em.to_fl_id ${sql.as} fl_id, mo_scenario_em.to_rm_id ${sql.as} rm_id FROM mo_scenario_em 
													 WHERE mo_scenario_em.project_id = ${parameters['projectId']} AND mo_scenario_em.scenario_id = ${parameters['scenarioId']}
												 ) ${sql.as} tmp_em 
												 WHERE tmp_em.bl_id = rm.bl_id AND tmp_em.fl_id = rm.fl_id AND tmp_em.rm_id = rm.rm_id )
						AND em_id &lt;&gt;( SELECT MIN(em_id)
												FROM
												 (
												 	SELECT em.em_id ${sql.as} em_id,  em.bl_id ${sql.as} bl_id, em.fl_id ${sql.as} fl_id, em.rm_id ${sql.as} rm_id FROM em
												 	UNION
												    SELECT mo_scenario_em.em_id ${sql.as} em_id, mo_scenario_em.to_bl_id ${sql.as} bl_id, mo_scenario_em.to_fl_id ${sql.as} fl_id, mo_scenario_em.to_rm_id ${sql.as} rm_id FROM mo_scenario_em 
													WHERE mo_scenario_em.project_id = ${parameters['projectId']} AND mo_scenario_em.scenario_id = ${parameters['scenarioId']}
												 ) ${sql.as} tmp_em
												 WHERE tmp_em.bl_id = rm.bl_id AND tmp_em.fl_id = rm.fl_id AND tmp_em.rm_id = rm.rm_id
												   AND em_id &lt;&gt; ( SELECT MIN(em_id) 
																			FROM 
																			 (
																			 	SELECT em.em_id ${sql.as} em_id,  em.bl_id ${sql.as} bl_id, em.fl_id ${sql.as} fl_id, em.rm_id ${sql.as} rm_id FROM em
																			 	UNION
																			    SELECT mo_scenario_em.em_id ${sql.as} em_id, mo_scenario_em.to_bl_id ${sql.as} bl_id, mo_scenario_em.to_fl_id ${sql.as} fl_id, mo_scenario_em.to_rm_id ${sql.as} rm_id FROM mo_scenario_em 
																				 WHERE mo_scenario_em.project_id = ${parameters['projectId']} AND mo_scenario_em.scenario_id = ${parameters['scenarioId']}
																			 ) ${sql.as} tmp_em 
																			 WHERE tmp_em.bl_id = rm.bl_id AND tmp_em.fl_id = rm.fl_id AND tmp_em.rm_id = rm.rm_id))						
				) ${sql.as} phone
			FROM rm
    	</sql>
		<table name="rm" role="main"/>
        <field table="rm" name="bl_id" hidden="true"/>
        <field table="rm" name="fl_id" hidden="true"/>
        <field table="rm" name="rm_id" />
        <field table="rm" name="count_em" />
        <field table="rm" name="cap_em" hidden="true"/>
        <field table="rm" name="option1" />
        <field table="rm" name="option2" />
        <field table="rm" name="phone" />
		<parameter name="projectId" dataType="text" value=""/>
		<parameter name="scenarioId" dataType="text" value=""/>
    </dataSource>

	<dataSource id="ds_abPlanMoveScenario_legend" distinct="true">
		<table name="rm" role="main"/>
	</dataSource>
	
    <dataSource id="ds_abPlanMoveScenario_availRm">
        <table name="rm" role="main"/>
        <table name="rmcat" role="standard"/>
        <field table="rm" name="bl_id"/>
        <field table="rm" name="fl_id"/>
        <field table="rm" name="rm_id"/>
        <field table="rm" name="area"/>
        <field table="rm" name="cap_em"/>
        <field table="rm" name="count_em"/>
		<field table="rm" name="count_scenario_em" dataType="number">
			<sql dialect="generic">
				(SELECT COUNT(mo_scenario_em.em_id) FROM mo_scenario_em WHERE mo_scenario_em.project_id = ${parameters['projectId']} 
					AND mo_scenario_em.scenario_id = ${parameters['scenarioId']} 
					AND mo_scenario_em.to_bl_id = rm.bl_id AND mo_scenario_em.to_fl_id = rm.fl_id AND mo_scenario_em.to_rm_id = rm.rm_id)
			</sql>
		</field>
        <field table="rmcat" name="occupiable"/>
        <field table="rmcat" name="used_in_calcs"/>
        <field table="rm" name="legend_level" dataType="text" legendKey="true">
            <sql dialect="generic">
				(CASE 
			        WHEN rmcat.occupiable = 0 THEN '1'
			        WHEN
							(rm.cap_em > 0 AND
							((SELECT COUNT(*) FROM em WHERE em.bl_id = rm.bl_id AND em.fl_id = rm.fl_id AND em.rm_id = rm.rm_id) +
							 (SELECT COUNT(mo_scenario_em.em_id) FROM mo_scenario_em WHERE mo_scenario_em.project_id = ${parameters['projectId']} 
							 AND mo_scenario_em.scenario_id = ${parameters['scenarioId']} 
							 AND mo_scenario_em.to_bl_id = rm.bl_id AND mo_scenario_em.to_fl_id = rm.fl_id AND mo_scenario_em.to_rm_id = rm.rm_id)) = 0)
						THEN '2'
			        WHEN
							(rm.cap_em > 0 AND
							(rm.cap_em - 
							((SELECT COUNT(*) FROM em WHERE em.bl_id = rm.bl_id AND em.fl_id = rm.fl_id AND em.rm_id = rm.rm_id) + 
							 (SELECT COUNT(mo_scenario_em.em_id) FROM mo_scenario_em WHERE mo_scenario_em.project_id = ${parameters['projectId']} 
							 AND mo_scenario_em.scenario_id = ${parameters['scenarioId']} 
							 AND mo_scenario_em.to_bl_id = rm.bl_id AND mo_scenario_em.to_fl_id = rm.fl_id AND mo_scenario_em.to_rm_id = rm.rm_id))) &gt; 0)
						THEN '3'
			        WHEN
							(rm.cap_em > 0 AND
							(rm.cap_em -
							((SELECT COUNT(*) FROM em WHERE em.bl_id = rm.bl_id AND em.fl_id = rm.fl_id AND em.rm_id = rm.rm_id) +
							 (SELECT COUNT(mo_scenario_em.em_id) FROM mo_scenario_em WHERE mo_scenario_em.project_id = ${parameters['projectId']} 
							 AND mo_scenario_em.scenario_id = ${parameters['scenarioId']} 
							 AND mo_scenario_em.to_bl_id = rm.bl_id AND mo_scenario_em.to_fl_id = rm.fl_id 
							 AND mo_scenario_em.to_rm_id = rm.rm_id))) = 0)
						THEN '4'
			        WHEN
							(rm.cap_em > 0 AND
							(rm.cap_em -
							((SELECT COUNT(*) FROM em WHERE em.bl_id = rm.bl_id AND em.fl_id = rm.fl_id AND em.rm_id = rm.rm_id) +
							 (SELECT COUNT(mo_scenario_em.em_id) FROM mo_scenario_em WHERE mo_scenario_em.project_id = ${parameters['projectId']} 
							 AND mo_scenario_em.scenario_id = ${parameters['scenarioId']} 
							 AND mo_scenario_em.to_bl_id = rm.bl_id AND mo_scenario_em.to_fl_id = rm.fl_id AND mo_scenario_em.to_rm_id = rm.rm_id))) &lt; 0)
						THEN '5'
					WHEN rm.cap_em = 0 AND rmcat.occupiable = 1 THEN '6'
			    END)      
            </sql>
        </field>
		<parameter name="projectId" dataType="text" value=""/>
		<parameter name="scenarioId" dataType="text" value=""/>
		<parameter name="moveDate" dataType="date" value=""/>
        <parameter name="rmCat" dataType="verbatim" value=""/>
        <restriction type="sql" sql="${parameters['rmCat']} rmcat.used_in_calcs IN('all_totals', 'dp_comn_ocup_totals')"/>
    </dataSource>

    <dataSource id="ds_abPlanMoveScenario_availRm_useTrans">
        <table name="rm" role="main"/>
        <table name="rmcat" role="standard"/>
        <field table="rm" name="bl_id"/>
        <field table="rm" name="fl_id"/>
        <field table="rm" name="rm_id"/>
        <field table="rm" name="area"/>
        <field table="rm" name="cap_em"/>
        <field table="rm" name="count_em"/>
		<field table="rm" name="count_scenario_em" dataType="number">
			<sql dialect="generic">
				(SELECT COUNT(mo_scenario_em.em_id) FROM mo_scenario_em WHERE mo_scenario_em.project_id = ${parameters['projectId']} 
					AND mo_scenario_em.scenario_id = ${parameters['scenarioId']} 
					AND mo_scenario_em.to_bl_id = rm.bl_id AND mo_scenario_em.to_fl_id = rm.fl_id AND mo_scenario_em.to_rm_id = rm.rm_id)
			</sql>
		</field>
        <field table="rmcat" name="occupiable"/>
        <field table="rmcat" name="used_in_calcs"/>
        <field table="rm" name="legend_level" dataType="text" legendKey="true">
			<sql dialect="generic">
				(CASE WHEN rmcat.occupiable = 0 then '1'
				WHEN (rm.cap_em > 0 AND rmcat.occupiable = 1 and 
				(0.5 * (select count(*) FROM rmpct where rmpct.bl_id=rm.bl_id and rmpct.fl_id=rm.fl_id and rmpct.rm_id=rm.rm_id
				and rmpct.em_id is not null AND rmpct.em_id NOT IN (SELECT mo.em_id FROM mo WHERE mo.project_id= ${parameters['projectId']})
				and rmpct.day_part != 0 and rmpct.status=1 and (rmpct.date_start IS NULL OR rmpct.date_start &lt;= ${parameters['moveDate']}) 
				and (rmpct.date_end IS NULL OR rmpct.date_end &gt;= ${parameters['moveDate']})
				) +
				(select count(*) FROM rmpct where rmpct.bl_id=rm.bl_id and rmpct.fl_id=rm.fl_id and rmpct.rm_id=rm.rm_id
				and rmpct.em_id is not null AND rmpct.em_id NOT IN (SELECT mo.em_id FROM mo WHERE mo.project_id= ${parameters['projectId']})
				and rmpct.day_part = 0 and rmpct.status=1 and (rmpct.date_start IS NULL OR rmpct.date_start &lt;= ${parameters['moveDate']}) 
				and (rmpct.date_end IS NULL OR rmpct.date_end &gt;= ${parameters['moveDate']})
				) + 
				(SELECT COUNT(mo_scenario_em.em_id) FROM mo_scenario_em WHERE mo_scenario_em.project_id = ${parameters['projectId']} 
							AND mo_scenario_em.scenario_id = ${parameters['scenarioId']} 
							AND mo_scenario_em.to_bl_id = rm.bl_id AND mo_scenario_em.to_fl_id = rm.fl_id AND mo_scenario_em.to_rm_id = rm.rm_id)
				)
				= 0 )  then '2'
				WHEN (rm.cap_em > 0 AND rmcat.occupiable = 1 and
				(0.5 * (select count(*) FROM rmpct where rmpct.bl_id=rm.bl_id and rmpct.fl_id=rm.fl_id and rmpct.rm_id=rm.rm_id
				and rmpct.em_id is not null AND rmpct.em_id NOT IN (SELECT mo.em_id FROM mo WHERE mo.project_id= ${parameters['projectId']})
				and rmpct.day_part != 0 and rmpct.status=1 and (rmpct.date_start IS NULL OR rmpct.date_start &lt;= ${parameters['moveDate']}) 
				and (rmpct.date_end IS NULL OR rmpct.date_end &gt;= ${parameters['moveDate']})
				) +
				(select count(*) FROM rmpct where rmpct.bl_id=rm.bl_id and rmpct.fl_id=rm.fl_id and rmpct.rm_id=rm.rm_id
				and rmpct.em_id is not null AND rmpct.em_id NOT IN (SELECT mo.em_id FROM mo WHERE mo.project_id= ${parameters['projectId']})
				and rmpct.day_part = 0 and rmpct.status=1 and (rmpct.date_start IS NULL OR rmpct.date_start &lt;= ${parameters['moveDate']}) 
				and (rmpct.date_end IS NULL OR rmpct.date_end &gt;= ${parameters['moveDate']})
				) +
				(SELECT COUNT(mo_scenario_em.em_id) FROM mo_scenario_em WHERE mo_scenario_em.project_id = ${parameters['projectId']} 
							AND mo_scenario_em.scenario_id = ${parameters['scenarioId']} 
							AND mo_scenario_em.to_bl_id = rm.bl_id AND mo_scenario_em.to_fl_id = rm.fl_id AND mo_scenario_em.to_rm_id = rm.rm_id)
				)
				&gt; 0 and 
				(0.5 * (select count(*) FROM rmpct where rmpct.bl_id=rm.bl_id and rmpct.fl_id=rm.fl_id and rmpct.rm_id=rm.rm_id
				and rmpct.em_id is not null AND rmpct.em_id NOT IN (SELECT mo.em_id FROM mo WHERE mo.project_id= ${parameters['projectId']})
				and rmpct.day_part != 0 and rmpct.status=1 and (rmpct.date_start IS NULL OR rmpct.date_start &lt;= ${parameters['moveDate']}) 
				and (rmpct.date_end IS NULL OR rmpct.date_end &gt;= ${parameters['moveDate']})
				) +
				(select count(*) FROM rmpct where rmpct.bl_id=rm.bl_id and rmpct.fl_id=rm.fl_id and rmpct.rm_id=rm.rm_id
				and rmpct.em_id is not null AND rmpct.em_id NOT IN (SELECT mo.em_id FROM mo WHERE mo.project_id= ${parameters['projectId']})
				and rmpct.day_part = 0 and rmpct.status=1 and (rmpct.date_start IS NULL OR rmpct.date_start &lt;= ${parameters['moveDate']}) 
				and (rmpct.date_end IS NULL OR rmpct.date_end &gt;= ${parameters['moveDate']})
				) + 
				(SELECT COUNT(mo_scenario_em.em_id) FROM mo_scenario_em WHERE mo_scenario_em.project_id = ${parameters['projectId']} 
							AND mo_scenario_em.scenario_id = ${parameters['scenarioId']} 
							AND mo_scenario_em.to_bl_id = rm.bl_id AND mo_scenario_em.to_fl_id = rm.fl_id AND mo_scenario_em.to_rm_id = rm.rm_id)
				)
				&lt; rm.cap_em ) then '3'
				when (rm.cap_em > 0 AND rmcat.occupiable = 1 and 
				(0.5 * (select count(*) FROM rmpct where rmpct.bl_id=rm.bl_id and rmpct.fl_id=rm.fl_id and rmpct.rm_id=rm.rm_id
				and rmpct.em_id is not null AND rmpct.em_id NOT IN (SELECT mo.em_id FROM mo WHERE mo.project_id= ${parameters['projectId']})
				and rmpct.day_part != 0 and rmpct.status=1 and (rmpct.date_start IS NULL OR rmpct.date_start &lt;= ${parameters['moveDate']}) 
				and (rmpct.date_end IS NULL OR rmpct.date_end &gt;= ${parameters['moveDate']})
				) +
				(select count(*) FROM rmpct where rmpct.bl_id=rm.bl_id and rmpct.fl_id=rm.fl_id and rmpct.rm_id=rm.rm_id
				and rmpct.em_id is not null AND rmpct.em_id NOT IN (SELECT mo.em_id FROM mo WHERE mo.project_id= ${parameters['projectId']})
				and rmpct.day_part = 0 and rmpct.status=1 and (rmpct.date_start IS NULL OR rmpct.date_start &lt;= ${parameters['moveDate']}) 
				and (rmpct.date_end IS NULL OR rmpct.date_end &gt;= ${parameters['moveDate']})
				) +
				(SELECT COUNT(mo_scenario_em.em_id) FROM mo_scenario_em WHERE mo_scenario_em.project_id = ${parameters['projectId']} 
							AND mo_scenario_em.scenario_id = ${parameters['scenarioId']} 
							AND mo_scenario_em.to_bl_id = rm.bl_id AND mo_scenario_em.to_fl_id = rm.fl_id AND mo_scenario_em.to_rm_id = rm.rm_id)
				)
				&gt; 0 and 
				(0.5 * (select count(*) FROM rmpct where rmpct.bl_id=rm.bl_id and rmpct.fl_id=rm.fl_id and rmpct.rm_id=rm.rm_id
				and rmpct.em_id is not null AND rmpct.em_id NOT IN (SELECT mo.em_id FROM mo WHERE mo.project_id= ${parameters['projectId']})
				and rmpct.day_part != 0 and rmpct.status=1 and (rmpct.date_start IS NULL OR rmpct.date_start &lt;= ${parameters['moveDate']}) 
				and (rmpct.date_end IS NULL OR rmpct.date_end &gt;= ${parameters['moveDate']})
				) +
				(select count(*) FROM rmpct where rmpct.bl_id=rm.bl_id and rmpct.fl_id=rm.fl_id and rmpct.rm_id=rm.rm_id
				and rmpct.em_id is not null AND rmpct.em_id NOT IN (SELECT mo.em_id FROM mo WHERE mo.project_id= ${parameters['projectId']})
				and rmpct.day_part = 0 and rmpct.status=1 and (rmpct.date_start IS NULL OR rmpct.date_start &lt;= ${parameters['moveDate']}) 
				and (rmpct.date_end IS NULL OR rmpct.date_end &gt;= ${parameters['moveDate']})
				) + 
				(SELECT COUNT(mo_scenario_em.em_id) FROM mo_scenario_em WHERE mo_scenario_em.project_id = ${parameters['projectId']} 
							AND mo_scenario_em.scenario_id = ${parameters['scenarioId']} 
							AND mo_scenario_em.to_bl_id = rm.bl_id AND mo_scenario_em.to_fl_id = rm.fl_id AND mo_scenario_em.to_rm_id = rm.rm_id)
				)
				= rm.cap_em ) then '4'
				when (rm.cap_em > 0 AND rmcat.occupiable = 1 and 
				(0.5 * (select count(*) FROM rmpct where rmpct.bl_id=rm.bl_id and rmpct.fl_id=rm.fl_id and rmpct.rm_id=rm.rm_id
				and rmpct.em_id is not null AND rmpct.em_id NOT IN (SELECT mo.em_id FROM mo WHERE mo.project_id= ${parameters['projectId']})
				and rmpct.day_part != 0 and rmpct.status=1 and (rmpct.date_start IS NULL OR rmpct.date_start &lt;= ${parameters['moveDate']}) 
				and (rmpct.date_end IS NULL OR rmpct.date_end &gt;= ${parameters['moveDate']})
				) +
				(select count(*) FROM rmpct where rmpct.bl_id=rm.bl_id and rmpct.fl_id=rm.fl_id and rmpct.rm_id=rm.rm_id
				and rmpct.em_id is not null AND rmpct.em_id NOT IN (SELECT mo.em_id FROM mo WHERE mo.project_id= ${parameters['projectId']})
				and rmpct.day_part = 0 and rmpct.status=1 and (rmpct.date_start IS NULL OR rmpct.date_start &lt;= ${parameters['moveDate']}) 
				and (rmpct.date_end IS NULL OR rmpct.date_end &gt;= ${parameters['moveDate']})
				) + 
				(SELECT COUNT(mo_scenario_em.em_id) FROM mo_scenario_em WHERE mo_scenario_em.project_id = ${parameters['projectId']} 
							AND mo_scenario_em.scenario_id = ${parameters['scenarioId']} 
							AND mo_scenario_em.to_bl_id = rm.bl_id AND mo_scenario_em.to_fl_id = rm.fl_id AND mo_scenario_em.to_rm_id = rm.rm_id)
				)
				&gt; rm.cap_em ) then '5'
				WHEN rm.cap_em = 0 AND rmcat.occupiable = 1 THEN '6'
				END)
            </sql>
        </field>
		<parameter name="projectId" dataType="text" value=""/>
		<parameter name="scenarioId" dataType="text" value=""/>
		<parameter name="moveDate" dataType="date" value=""/>
        <parameter name="rmCat" dataType="verbatim" value=""/>
        <restriction type="sql" sql="${parameters['rmCat']} rmcat.used_in_calcs IN('all_totals', 'dp_comn_ocup_totals')"/>
    </dataSource>

	<dataSource id="ds_abPlanMoveScenario_availRm_useTrans_pending">
		<table name="rm" role="main"/>
		<table name="rmcat" role="standard"/>
		<field table="rm" name="bl_id"/>
		<field table="rm" name="fl_id"/>
		<field table="rm" name="rm_id"/>
		<field table="rmcat" name="occupiable"/>
        <field table="rmcat" name="used_in_calcs"/>
        <field table="rm" name="legend_level" dataType="text" legendKey="true">
            <sql dialect="generic">               
              (CASE 
                WHEN rmcat.occupiable = 0 THEN '1'
				WHEN
                    rm.cap_em > 0 AND 
                    0 =  (
                        (SELECT COUNT(DISTINCT(rmpct.em_id)) 
                        FROM rmpct 
                        WHERE 
                        rmpct.bl_id=rm.bl_id AND rmpct.fl_id=rm.fl_id AND rmpct.rm_id=rm.rm_id 
                        AND rmpct.em_id IS NOT NULL AND rmpct.em_id NOT IN (SELECT mo.em_id FROM mo WHERE mo.project_id= ${parameters['projectId']})
                        AND ((   (rmpct.date_start IS NULL OR rmpct.date_start &lt;= ${parameters['moveDate']})
                        AND (rmpct.date_end IS NULL OR rmpct.date_end &gt;=${parameters['moveDate']}))
                        OR rmpct.date_start &gt;= ${parameters['moveDate']})
                        AND rmpct.status IN (0, 1) 
                        AND rmcat.occupiable = 1) +
						(SELECT COUNT(mo_scenario_em.em_id) FROM mo_scenario_em WHERE mo_scenario_em.project_id = ${parameters['projectId']} 
						AND mo_scenario_em.scenario_id = ${parameters['scenarioId']} 
						AND mo_scenario_em.to_bl_id = rm.bl_id AND mo_scenario_em.to_fl_id = rm.fl_id AND mo_scenario_em.to_rm_id = rm.rm_id)
						) 
              THEN '2'
                  WHEN 
                    rm.cap_em > 0 AND 
                    rm.cap_em > (
                        (SELECT COUNT(DISTINCT(rmpct.em_id)) 
                        FROM rmpct 
                        WHERE 
                        rmpct.bl_id = rm.bl_id AND rmpct.fl_id = rm.fl_id AND rmpct.rm_id = rm.rm_id 
                        AND rmpct.em_id IS NOT NULL AND rmpct.em_id NOT IN (SELECT mo.em_id FROM mo WHERE mo.project_id= ${parameters['projectId']})
                        AND ((   (rmpct.date_start IS NULL OR rmpct.date_start &lt;= ${parameters['moveDate']})
                        AND (rmpct.date_end IS NULL OR rmpct.date_end &gt;=${parameters['moveDate']}))
                        OR rmpct.date_start &gt;= ${parameters['moveDate']})
                        AND rmpct.status IN (0, 1) 
                        AND rmcat.occupiable = 1) +
						(SELECT COUNT(mo_scenario_em.em_id) FROM mo_scenario_em WHERE mo_scenario_em.project_id = ${parameters['projectId']} 
						AND mo_scenario_em.scenario_id = ${parameters['scenarioId']} 
						AND mo_scenario_em.to_bl_id = rm.bl_id AND mo_scenario_em.to_fl_id = rm.fl_id AND mo_scenario_em.to_rm_id = rm.rm_id)
						) AND 
                    0!= (
                        (SELECT COUNT(DISTINCT(rmpct.em_id)) 
                        FROM rmpct 
                        WHERE 
                        rmpct.bl_id = rm.bl_id AND rmpct.fl_id = rm.fl_id AND rmpct.rm_id = rm.rm_id
                        AND rmpct.em_id IS NOT NULL AND rmpct.em_id NOT IN (SELECT mo.em_id FROM mo WHERE mo.project_id= ${parameters['projectId']})
                        AND ((   (rmpct.date_start IS NULL OR rmpct.date_start &lt;= ${parameters['moveDate']})
                        AND (rmpct.date_end IS NULL OR rmpct.date_end &gt;=${parameters['moveDate']}))
                        OR rmpct.date_start &gt;= ${parameters['moveDate']})
                        AND rmpct.status IN (0, 1)
                        AND rmcat.occupiable = 1) +
						(SELECT COUNT(mo_scenario_em.em_id) FROM mo_scenario_em WHERE mo_scenario_em.project_id = ${parameters['projectId']}
						AND mo_scenario_em.scenario_id = ${parameters['scenarioId']} 
						AND mo_scenario_em.to_bl_id = rm.bl_id AND mo_scenario_em.to_fl_id = rm.fl_id AND mo_scenario_em.to_rm_id = rm.rm_id)
						)
              THEN '3' 
                  WHEN 
                    rm.cap_em > 0 AND 
                    rm.cap_em = (
                        (SELECT COUNT(DISTINCT(rmpct.em_id)) 
                        FROM rmpct 
                        WHERE 
                        rmpct.bl_id = rm.bl_id AND rmpct.fl_id = rm.fl_id AND rmpct.rm_id = rm.rm_id 
                        AND rmpct.em_id IS NOT NULL AND rmpct.em_id NOT IN (SELECT mo.em_id FROM mo WHERE mo.project_id= ${parameters['projectId']})
                        AND ((   (rmpct.date_start IS NULL OR rmpct.date_start &lt;= ${parameters['moveDate']})
                        AND (rmpct.date_end IS NULL OR rmpct.date_end &gt;=${parameters['moveDate']}))
                        OR rmpct.date_start &gt;= ${parameters['moveDate']})
                        AND rmpct.status IN (0, 1) 
                        AND rmcat.occupiable = 1) +
						(SELECT COUNT(mo_scenario_em.em_id) FROM mo_scenario_em WHERE mo_scenario_em.project_id = ${parameters['projectId']}
						AND mo_scenario_em.scenario_id = ${parameters['scenarioId']} 
						AND mo_scenario_em.to_bl_id = rm.bl_id AND mo_scenario_em.to_fl_id = rm.fl_id AND mo_scenario_em.to_rm_id = rm.rm_id)
						)
              THEN '4' 
                  WHEN 
                    rm.cap_em > 0 AND 
                    rm.cap_em &lt; (
                        (SELECT COUNT(DISTINCT(rmpct.em_id)) 
                        FROM rmpct 
                        WHERE 
                        rmpct.bl_id = rm.bl_id AND rmpct.fl_id = rm.fl_id AND rmpct.rm_id = rm.rm_id 
                        AND rmpct.em_id IS NOT NULL AND rmpct.em_id NOT IN (SELECT mo.em_id FROM mo WHERE mo.project_id= ${parameters['projectId']})
                        AND ((   (rmpct.date_start IS NULL OR rmpct.date_start &lt;= ${parameters['moveDate']})
                        AND (rmpct.date_end IS NULL OR rmpct.date_end &gt;=${parameters['moveDate']}))
                        OR rmpct.date_start &gt;= ${parameters['moveDate']})
                        AND rmpct.status IN (0, 1) 
                        AND rmcat.occupiable = 1) +
						(SELECT COUNT(mo_scenario_em.em_id) FROM mo_scenario_em WHERE mo_scenario_em.project_id = ${parameters['projectId']}
						AND mo_scenario_em.scenario_id = ${parameters['scenarioId']} 
						AND mo_scenario_em.to_bl_id = rm.bl_id AND mo_scenario_em.to_fl_id = rm.fl_id AND mo_scenario_em.to_rm_id = rm.rm_id)
						)
              THEN '5' 
					WHEN rm.cap_em = 0 AND rmcat.occupiable = 1 THEN '6'
               END)
            </sql>
		</field>
		<parameter name="projectId" dataType="text" value=""/>
		<parameter name="scenarioId" dataType="text" value=""/>
		<parameter name="moveDate" dataType="date" value=""/>
        <parameter name="rmCat" dataType="verbatim" value=""/>
	</dataSource>

    <dataSource id="ds_abPlanMoveScenario_rmCnt">
        <table name="rm" role="main"/>
        <field table="rm" name="bl_id"/>
        <field table="rm" name="fl_id"/>
        <field table="rm" name="rm_id"/>
        <field name="count_em" dataType="integer">
        	<sql dialect="generic">
				(SELECT COUNT(*) FROM em WHERE em.bl_id = rm.bl_id AND em.fl_id = rm.fl_id AND em.rm_id = rm.rm_id)
        	</sql>
        </field>
        <field table="rm" name="cap_em"/>
		<parameter name="moveDate" dataType="date" value=""/>
    </dataSource>

    <dataSource id="ds_abPlanMoveScenario_rmCnt_useTrans">
        <table name="rm" role="main"/>
        <field table="rm" name="bl_id"/>
        <field table="rm" name="fl_id"/>
        <field table="rm" name="rm_id"/>
        <field name="count_em" dataType="number">
        	<sql dialect="generic">
				(
				0.5 * (select count(*) FROM rmpct where rmpct.bl_id=rm.bl_id and rmpct.fl_id=rm.fl_id and rmpct.rm_id=rm.rm_id
				and rmpct.em_id is not null AND rmpct.em_id NOT IN (SELECT mo.em_id FROM mo WHERE mo.project_id= ${parameters['projectId']})
				and rmpct.day_part != 0 and rmpct.status=1 and (rmpct.date_start IS NULL OR rmpct.date_start &lt;= ${parameters['moveDate']}) 
				and (rmpct.date_end IS NULL OR rmpct.date_end &gt;= ${parameters['moveDate']}) ) +
				(select count(*) FROM rmpct where rmpct.bl_id=rm.bl_id and rmpct.fl_id=rm.fl_id and rmpct.rm_id=rm.rm_id
				and rmpct.em_id is not null AND rmpct.em_id NOT IN (SELECT mo.em_id FROM mo WHERE mo.project_id= ${parameters['projectId']})
				and rmpct.day_part = 0 and rmpct.status=1 and (rmpct.date_start IS NULL OR rmpct.date_start &lt;= ${parameters['moveDate']}) 
				and (rmpct.date_end IS NULL OR rmpct.date_end &gt;= ${parameters['moveDate']}) )
				)
        	</sql>
        </field>
        <field table="rm" name="cap_em"/>
		<parameter name="projectId" dataType="text" value=""/>
		<parameter name="moveDate" dataType="date" value=""/>
    </dataSource>

    <dataSource id="ds_abPlanMoveScenario_rmCnt_useTrans_pending">
        <table name="rm" role="main"/>
        <table name="rmcat" role="standard"/>
        <field table="rm" name="bl_id"/>
        <field table="rm" name="fl_id"/>
        <field table="rm" name="rm_id"/>
        <field table="rmcat" name="occupiable"/>
        <field name="count_em" dataType="number">
        	<sql dialect="generic">
				(SELECT COUNT(DISTINCT(rmpct.em_id)) 
				FROM rmpct 
				WHERE 
				rmpct.bl_id = rm.bl_id AND rmpct.fl_id = rm.fl_id AND rmpct.rm_id = rm.rm_id 
				AND rmpct.em_id IS NOT NULL AND rmpct.em_id NOT IN (SELECT mo.em_id FROM mo WHERE mo.project_id= ${parameters['projectId']}) 
				AND ((   (rmpct.date_start IS NULL OR rmpct.date_start &lt;= ${parameters['moveDate']})
				AND (rmpct.date_end IS NULL OR rmpct.date_end &gt;=${parameters['moveDate']}))
				OR rmpct.date_start &gt;= ${parameters['moveDate']})
				AND rmpct.status IN (0, 1) 
				AND rmcat.occupiable = 1)
        	</sql>
        </field>
        <field table="rm" name="cap_em"/>
		<parameter name="projectId" dataType="text" value=""/>
		<parameter name="moveDate" dataType="date" value=""/>
    </dataSource>

	<dataSource id="ds_abPlanMoveScenario_rmPendingRequestHighlightDS">
		<sql dialect="generic">
			SELECT
			RTRIM(rm.bl_id) ${sql.concat} ';' ${sql.concat} RTRIM(rm.fl_id) ${sql.concat} ';' ${sql.concat} RTRIM(rm.rm_id) ${sql.as} asset_id,
			'0x00ffff' ${sql.as} color
			FROM rm 
			where rm.bl_id = ${parameters['blId']} and rm.fl_id = ${parameters['flId']} 
			and exists(select 1 from rmpct where ((rmpct.bl_id = rm.bl_id and rmpct.fl_id = rm.fl_id and rmpct.rm_id = rm.rm_id) OR 
            (rmpct.from_bl_id = rm.bl_id and rmpct.from_fl_id = rm.fl_id and rmpct.from_rm_id = rm.rm_id))
			and (rmpct.activity_log_id IS NOT NULL OR rmpct.mo_id IS NOT NULL) and
			(rmpct.status = 0 OR (rmpct.status = 1 AND rmpct.date_start &gt; ${parameters['moveDate']})) )
        </sql>
		<table name="rm" role="main"/>
		<field table="rm" name="asset_id" dataType="text"/>
		<field table="rm" name="color" dataType="text"/>
		<parameter name="moveDate" dataType="date" value=""/>
		<parameter name="blId" dataType="text" value=""/>
		<parameter name="flId" dataType="text" value=""/>
	</dataSource>

	<dataSource id="ds_abPlanMoveScenario_rmPendingRequestList">
		<table name="rmpct" role="main"/>
		<table name="activity_log" role="standard"/>
		<field table="activity_log" name="activity_log_id"/>
		<field table="activity_log" name="activity_type"/>
		<field table="activity_log" name="status"/>
		<table name="mo" role="standard"/>
		<field table="mo" name="mo_id"/>
		<field table="mo" name="project_id"/>
		<field table="mo" name="status"/>
		<field table="rmpct" name="em_id"/>
		<field table="rmpct" name="date_start"/>
		<field table="rmpct" name="bl_id"/>
		<field table="rmpct" name="fl_id"/>
		<field table="rmpct" name="rm_id"/>
		<restriction type="sql" sql="((rmpct.bl_id = ${parameters['blId']} and rmpct.fl_id = ${parameters['flId']}) OR (rmpct.from_bl_id =${parameters['blId']} AND rmpct.from_fl_id = ${parameters['flId']})) 
		AND (rmpct.activity_log_id IS NOT NULL OR rmpct.mo_id IS NOT NULL) and (rmpct.status = 0 
		OR (rmpct.status = 1 AND rmpct.date_start &gt; ${parameters['moveDate']}))"/>
		<parameter name="moveDate" dataType="date" value=""/>
		<parameter name="blId" dataType="text" value=""/>
		<parameter name="flId" dataType="text" value=""/>
	</dataSource>
	
	<panel type="grid" columns="2" id="abPlanMoveScenario_rmPendingRequestList" dataSource="ds_abPlanMoveScenario_rmPendingRequestList" showOnLoad="false">
		<title>Pending Requests</title>
		<field table="rmpct" name="bl_id"/>
		<field table="rmpct" name="fl_id"/>
		<field table="rmpct" name="rm_id"/>
		<field table="rmpct" name="em_id"/>
		<field table="rmpct" name="date_start"/>
		<field table="mo" name="mo_id"/>
		<field table="mo" name="status"/>
		<field table="mo" name="project_id"/>
		<field table="activity_log" name="activity_log_id"/>
		<field table="activity_log" name="status"/>
		<field table="activity_log" name="activity_type"/>
	</panel>

    <dataSource id="ds_abPlanMoveScenario_scenRmCnt" type="grouping">
        <table name="mo_scenario_em" role="main"/>
        <field table="mo_scenario_em" name="project_id" groupBy="true"/>
        <field table="mo_scenario_em" name="scenario_id" groupBy="true"/>
        <field table="mo_scenario_em" name="to_bl_id" groupBy="true"/>
        <field table="mo_scenario_em" name="to_fl_id" groupBy="true"/>
        <field table="mo_scenario_em" name="to_rm_id" groupBy="true"/>
        <field table="mo_scenario_em" name="count_em" dataType="number">
        	<sql dialect="generic">
        		COUNT(mo_scenario_em.em_id)
        	</sql>
        </field>
    </dataSource>

	<panel type="drawing" id="dwg_abPlanMoveScenario_fl" multiple="false"  layoutRegion="drawingPosition" 
		selectionMode="1" 
		assignMode="3"
	    labelsDataSource="ds_abPlanMoveScenario_rmLabel4"
     	legendPanel="dwg_abPlanMoveScenario_legend">
     	<title></title>
		<action id="updateScenario">
			<title translatable="true">Update Scenario</title>
		</action>
		<action id="updateProject">
			<title translatable="true">Update Move Project</title>
		</action>
		<action id="showCurrent">
			<title translatable="true">Show Current Only</title>
      		<command type="callFunction" functionName="showCurrent"/>
			<tooltip>Highlight availability based on current space.</tooltip>
		</action>
		<action id="showCurrentPending">
			<title translatable="true">Show Current and Pending</title>
      		<command type="callFunction" functionName="showCurrentPending"/>
			<tooltip>Highlight availability based on current space and on changes from pending requests or moves.</tooltip>
		</action>
        <action type="menu" id="exportDrawingPanelMenu" imageName="/schema/ab-core/graphics/icons/view/export.png">
            <title></title>
            <action id="exportLoadedDrawingToDOCX">
                <title>Export What You See to DOCX</title>
                <command type="exportPanel" outputType="docx" panelId="dwg_abPlanMoveScenario_fl"/>
            </action>
            <action id="exportDrawingToPDF">
                <title>Generate PDF of Floors in Scenario</title>
                <command type="callFunction" functionName="abPlanMoveScenarioCtrl.onExportDrawing('pdf')"/>
            </action>
            <action id="exportDrawingToDOCX">
                <title>Generate DOCX of Floors in Scenario</title>
                <command type="callFunction" functionName="abPlanMoveScenarioCtrl.onExportDrawing('docx')"/>
            </action>
        </action>
	</panel>

    <panel type="grid" controlType="reportGrid" id="dwg_abPlanMoveScenario_legend" dataSource="ds_abPlanMoveScenario_legend"  layoutRegion="legendPosition" showOnLoad="false">
        <title translatable="true">Legend</title>
		<action id="listPending">
			<title translatable="true">List Pending</title>
			<command type="openDialog" panelId="abPlanMoveScenario_rmPendingRequestList"/>
			<tooltip>List spaces with pending requests or moves.</tooltip>
		</action>
        <field table="legend" name="color" controlType="color"/>
        <field table="legend" name="value" width="80%">
            <title translatable="true">Value</title>
        </field>
    </panel>
	
    <panel type="grid" id="list_abPlanMoveScenario_emAssigned" multipleSelectionEnabled="true" dataSource="ds_abPlanMoveScenario_em"  layoutRegion="emAssignPosition" showOnLoad="false">
        <title translatable="true">Employees Located</title>
        <action id="unassign">
            <title translatable="true">Unassign</title>
         </action>
		<field table="mo_scenario_em" name="em_id">
			<title translatable="true">Employee Name</title>
		</field>
        <field table="em" name="em_std"/>
		<field table="mo_scenario_em" name="to_bl_id"/>
		<field table="mo_scenario_em" name="to_fl_id"/>
		<field table="mo_scenario_em" name="to_rm_id"/>
        <field table="em" name="dv_id"/>
        <field table="em" name="dp_id"/>
		<field table="mo_scenario_em" name="project_id" hidden="true"/>
		<field table="mo_scenario_em" name="scenario_id" hidden="true"/>
    </panel>

	<js file="ab-mo-gp-plan-move-scenario.js"/>
	<js file="ab-mo-gp-plan-move-scenario-print.js"/>
</view>
