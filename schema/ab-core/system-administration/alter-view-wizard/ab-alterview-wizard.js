/**
* Generated by Yong Shao (2008/06/22)
*/
var alterviewizard = View.createController('alterviewizard',{	
	afterInitialDataFetch: function() {	
		var tabsFrame = this.tabsFrame;
		//XXX: isAlter will be used by VDW to handle Alter Wizard	
		tabsFrame.isAlter = true;
		//XXX: clean tabsFrame object
		clearSettings(tabsFrame);
		tabsFrame.fileName="";
		tabsFrame.fileFullName="";
		
		//XX: from opener.view, get target view's content and initalize all required properties based on the content
		var openerView = View.getOpenerView();
		tabsFrame.openerView = openerView;
		
		var originalRequestURL = openerView.originalRequestURL;
		var fileName = originalRequestURL.substr(originalRequestURL.lastIndexOf("/")+1, originalRequestURL.length -1);
		/*
		var fileName = '';
		if((openerView.taskRecord != null) && openerView.taskRecord.getTaskFile()){
			fileName = openerView.taskRecord.getTaskFile();
		} else {
			var originalRequestURL = openerView.originalRequestURL;				
			fileName = originalRequestURL.substr(originalRequestURL.lastIndexOf("/")+1, originalRequestURL.length -1);
		}
		*/
		/*
		var fileName = openerView.viewName;
		var fileFullName = fileName;
		var pos = fileFullName.lastIndexOf("/");
		if(pos > 0){
			fileName = fileName.substring(pos + 1, fileName.length);
			tabsFrame.fileName = fileName;
		}
		*/

		//XXX: assgin alter view's file name to tabsFrame.fileToConvert
		tabsFrame.fileToConvert = fileName;		

		//XXX: defualt values
 		tabsFrame.patternRestriction = "ab-viewdef-report-drilldown-two-level";
		tabsFrame.typeRestriction = "reports";    		
	
		//XXX: pattern
		var pattern = openerView.designInfo.pattern;
		if(typeof pattern!="undefined" && pattern!=null && pattern!="null" && pattern!=""){
			tabsFrame.patternRestriction = pattern;
		}
	
		//XXX: type
		var type = openerView.designInfo.type;
		if(typeof type!="undefined" && type!=null && type!="null" && type!=""){
			if(openerView.type.indexOf("edit")>=0){
				tabsFrame.typeRestriction="editForms";
			}else if (type.indexOf("summary") >= 0) {
				tabsFrame.typeRestriction = "summaryReports";
			}else if (type.indexOf("paginated") >= 0) {
					tabsFrame.typeRestriction = "paginated";
			}
		}		
		
		//XXX: defined in ab-viewdef-type-helper.js		
        loadSelectedView(tabsFrame);
    }
});

function clearSettings(tabsFrame){
    var view = new Object();
    var tgrp = new Array();
    view.tableGroups = tgrp;
    view.chartProperties = new Array();
    view.paginatedProperties = new Array();
    tabsFrame.newView = view;
    
    tabsFrame.fileToConvert = "";
    tabsFrame.fileContents = "";
    tabsFrame.typeRestriction = "";
    tabsFrame.patternRestriction = "";
    tabsFrame.restriction = "";
    tabsFrame.viewType = "";
    tabsFrame.tablegroupsRestriction = 0;
    tabsFrame.disableFileSelect = false;
    //XXX: new grid multiple selection  over pages
    tabsFrame.clearFieldsSelection = false;
	
	tabsFrame.datagrpRestriction = '';
	tabsFrame.ownergrpRestriction = '';
	tabsFrame.owner2grpRestriction = '';
}



