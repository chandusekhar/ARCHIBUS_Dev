!function(t){t.drag=function(t,e,r,l,o,s){var c,d=null,n=d3.select("body"),a=d3.dispatch("drop"),i=[0,0],u=d3.behavior.drag().on("dragstart",function(t){if(r(t,l)!==!1){var e=this.cloneNode(!0),o=d3.select(this).select(".graph-rect").node().getBBox();point=[this.getBoundingClientRect().left,this.getBoundingClientRect().top],c=this,i=point,d3.select(this).classed({selected:!0}),d3.select(e).classed({drag:!0}).attr("transform",null),d=d3.select("body").append("svg").classed({dragging:"true"}).attr("width",Math.round(o.width)).attr("height",Math.round(o.height)).style("position","absolute").style("pointer-events","none").style("left",point[0]+"px").style("top",point[1]+"px").style("font-family","Arial"),d3.select(e).select(".graph-rect").style("stroke","#000").style("stroke-width","2").style("opacity","0.8"),d.classed({shadow:!0}).node().appendChild(e)}}).on("drag",function(e){d3.select("#"+t);if(r(e,l)===!1)return void n.style("cursor","not-allowed");var o=d3.select("body").node(),c=d3.touch(o)?d3.touch(o):d3.mouse(o),a=document.elementFromPoint(c[0],c[1]),i=d3.select(a),u=!1;i.empty()||null==i.attr("class")||i.attr("class").indexOf("graph-rect")>-1&&a!=d3.select(this).select(".graph-rect").node()&&s(i,l)===!0&&(u=!0),d.style("left",c[0]+"px").style("top",c[1]+"px"),i.empty()||null==i.attr("class")||0==u?n.style("cursor","not-allowed"):n.style("cursor","default")}).on("dragend",function(){if(null==d){{d3.select("#"+t)}return void n.style("cursor","default")}var r=(document.body.getBoundingClientRect(),d3.select("#"+t),d3.touch(document.body)?d3.touch(document.body):d3.mouse(document.body)),o=d.style("left").replace("px",""),i=d.style("top").replace("px",""),u=document.elementFromPoint(r[0],r[1]),p=d3.select(u);if(n.style("cursor","default"),p.empty()||null==p.attr("class")||u==d3.select(this).select(".graph-rect").node()||s(p,l)===!1)return void d.transition().duration(200).ease("linear").each("end",function(){d3.select(this).transition().style({left:c.getBoundingClientRect().left+"px",top:c.getBoundingClientRect().top+"px"}).each("end",function(){d3.select(c).classed({selected:!1}),d3.select(this).transition().delay(0).remove()})});if(p.attr("class").indexOf("graph-rect")>-1){var h=o,g=i,y=(p.attr("row"),p.attr("col"),p.attr("stackNumber")),m=(d.select("rect").attr("x",h).attr("y",g).style("opacity",null),d.select("g").node(),d3.select(this).select(".graph-rect")),f=(m.attr("row"),m.attr("col"),m.attr("stackNumber")),b=e[f-1],v=e[y-1],x=m.attr("recordNumber"),w=b[x],N=p.attr("recordNumber"),R=v[N],k=p.attr("row"),B=p.attr("col")-1,C=d3.select(u.ownerSVGElement).selectAll(".row"+k+" ").filter(".col"+B),S=null;C.empty()||(S=v[C.attr("recordNumber")]),d.remove(),a.drop.call(u,{targetEl:u,targetRecord:R,sourceRecord:w,previousRecord:S,targetStackNumber:y,targetRecordNumber:N,sourceRecordNumber:x,sourceStackNumber:f})}else d.remove()});return d3.rebind(u,a,"on")}}(stackplacement={});