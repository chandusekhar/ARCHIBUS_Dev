<view version="2.0">
    <js file="ab-cb-rpt-assess-loc.js"/>
    <js file="ab-cb-rpt-common.js"/>
    <js file="ab-cb-select-values-common.js"/>
    
    <message name="building" translatable="true">Building</message>
    <message name="floor" translatable="true">Floor</message>
    <message name="room" translatable="true">Room</message>
    <message name="selectValidDates" translatable="true">Please select a valid date range</message>
    <message name="titleSubstanceCode" translatable="true">Substance Code</message>
    <message name="titleSubstanceDescription" translatable="true">Substance Description</message>
    <message name="titleHazardResponseCode" translatable="true">Hazard Response Code</message>
    <message name="titleHazardResponseDescription" translatable="true">Hazard Response Description</message>
 
    <layout type="borderLayout" id="mainLayout">
        <north autoScroll="true" split="true" initialSize="182px"/>
        <center autoScroll="true"/>
    </layout>
    <layout type="borderLayout" id="centerLayout" containingLayout="mainLayout" region="center">
        <west autoScroll="true" split="true" initialSize="20%"/>
        <center autoScroll="true"/>
    </layout>
    <title translatable="true">View Hazard Assessment Items by Location</title>



    <!-- Filter -->
    <dataSource id="abCbRptAssessLoc_ds">
        <table name="activity_log" role="main"/>
        <field table="activity_log" name="site_id"/>
        <field table="activity_log" name="prob_type"/>
        <field table="activity_log" name="hcm_is_hazard"/>
        <field table="activity_log" name="hcm_haz_rank_id"/>
        <field table="activity_log" name="bl_id"/>
        <field table="activity_log" name="hcm_haz_status_id"/>
        <field table="activity_log" name="hcm_cond_id"/>
        <field table="activity_log" name="hcm_haz_rating_id"/>
        <field table="activity_log" name="fl_id"/>
        <field table="activity_log" name="hcm_friable"/>
        <field table="activity_log" name="hcm_pending_act"/>
        <field table="activity_log" name="repair_type"/>
        <field table="activity_log" name="project_id"/>
        <field table="activity_log" name="hcm_loc_typ_id"/>
        <field table="activity_log" name="date_assessed"/>
    </dataSource>

    <panel type="console" id="abCbRptAssessLoc_filter" dataSource="abCbRptAssessLoc_ds" columns="5" layout="mainLayout" region="north">
        <title translatable="true">Filter</title>
        <action id="show">
            <title translatable="true">Show</title>
        </action>
        <action id="clear">
            <title translatable="true">Clear</title>
            <command type="clearPanel" panelId="abCbRptAssessLoc_filter"/>
        </action>
        <field table="activity_log" name="site_id">
            <title translatable="true">Site</title>
            <action>
                <title translatable="false">...</title>
                <tooltip translatable="true">Select Value</tooltip>
                <command type="selectValue" selectValueType="multiple" fieldNames="activity_log.site_id" selectFieldNames="site.site_id" visibleFieldNames="site.ctry_id,site.state_id, site.city_id, site.site_id, site.name"/>
            </action>
        </field>
        <field table="activity_log" name="prob_type">
            <title translatable="true">Substance</title>
            <action>
                <title translatable="false">...</title>
                <tooltip translatable="true">Select Value</tooltip>
                <command type="callFunction" functionName="selectValue_Substance('abCbRptAssessLoc_filter', 'activity_log.prob_type', null, 'multiple')"/>
            </action>
        </field>
        <field table="activity_log" name="hcm_is_hazard" alias="hcm_is_hazard_or1">
            <title translatable="true">Contains Hazard?</title>
        </field>
        <field table="activity_log" name="hcm_is_hazard" alias="hcm_is_hazard_or2">
            <title translatable="true">Or</title>
        </field>
        <field table="activity_log" name="hcm_haz_rank_id">
            <title translatable="true">Hazard Rank</title>
            <action>
                <title translatable="false">...</title>
                <tooltip translatable="true">Select Value</tooltip>
                <command type="selectValue" selectValueType="multiple" fieldNames="activity_log.hcm_haz_rank_id" selectFieldNames="cb_hazard_rank.hcm_haz_rank_id" visibleFieldNames="cb_hazard_rank.hcm_haz_rank_id,cb_hazard_rank.name"/>
            </action>
        </field>
        <field table="activity_log" name="bl_id">
            <title translatable="true">Building</title>
            <action>
                <title translatable="false">...</title>
                <tooltip translatable="true">Select Value</tooltip>
                <command type="selectValue" selectValueType="multiple" fieldNames="activity_log.site_id,activity_log.bl_id" selectFieldNames="bl.site_id,bl.bl_id" visibleFieldNames="bl.site_id,bl.bl_id, bl.name"/>
            </action>
        </field>
        <field table="activity_log" name="hcm_haz_status_id">
            <title translatable="true">Status</title>
            <action>
                <title translatable="false">...</title>
                <tooltip translatable="true">Select Value</tooltip>
                <command type="selectValue" selectValueType="multiple" fieldNames="activity_log.hcm_haz_status_id" selectFieldNames="cb_hazard_status.hcm_haz_status_id" visibleFieldNames="cb_hazard_status.hcm_haz_status_id,cb_hazard_status.name"/>
            </action>
        </field>
        <field table="activity_log" name="hcm_cond_id" colspan="2" style="width:150px">
            <title translatable="true">Material Condition</title>
            <action>
                <title translatable="false">...</title>
                <tooltip translatable="true">Select Value</tooltip>
                <command type="selectValue" selectValueType="multiple" fieldNames="activity_log.hcm_cond_id" selectFieldNames="cb_hcm_cond.hcm_cond_id" visibleFieldNames="cb_hcm_cond.hcm_cond_id,cb_hcm_cond.name"/>
            </action>
        </field>
        <field table="activity_log" name="hcm_haz_rating_id">
            <title translatable="true">Hazard Rating</title>
            <action>
                <title translatable="false">...</title>
                <tooltip translatable="true">Select Value</tooltip>
                <command type="selectValue" selectValueType="multiple" fieldNames="activity_log.hcm_haz_rating_id" selectFieldNames="cb_hazard_rating.hcm_haz_rating_id" visibleFieldNames="cb_hazard_rating.hcm_haz_rating_id,cb_hazard_rating.name"/>
            </action>
        </field>
        <field table="activity_log" name="fl_id">
            <title translatable="true">Floor</title>
            <action>
                <title translatable="false">...</title>
                <tooltip translatable="true">Select Value</tooltip>
                <command type="callFunction" functionName="selectValue()"/>
            </action>
        </field>
        <field table="activity_log" name="hcm_friable"/>
        <field table="activity_log" name="hcm_pending_act" colspan="2" style="width:150px">
            <action>
                <title translatable="false">...</title>
                <tooltip translatable="true">Select Value</tooltip>
                <command type="selectValue" selectValueType="multiple" fieldNames="activity_log.hcm_pending_act" selectFieldNames="probtype.prob_type" visibleFieldNames="probtype.prob_type,probtype.description" restriction=" probtype.prob_class = 'CB-ACTION'"/>
            </action>
        </field>
        <field table="activity_log" name="repair_type">
            <title translatable="true">Hazard Response</title>
            <action>
                <title translatable="false">...</title>
                <tooltip translatable="true">Select Value</tooltip>
                <command type="callFunction" functionName="selectValue_HazardResponse('abCbRptAssessLoc_filter', 'activity_log.repair_type', null, 'multiple')"/>
            </action>
        </field>
        
        <field table="activity_log" name="project_id">
            <title translatable="true">Project</title>
            <action>
                <title translatable="false">...</title>
                <tooltip translatable="true">Select Value</tooltip>
                <command type="selectValue" selectValueType="multiple" fieldNames="activity_log.project_id" selectFieldNames="project.project_id" visibleFieldNames="project.project_id,project.summary" restriction="project_type = 'ASSESSMENT - HAZMAT'"/>
            </action>
        </field>
        <field table="activity_log" name="hcm_loc_typ_id">
            <title translatable="true">Location</title>
            <action>
                <title translatable="false">...</title>
                <tooltip translatable="true">Select Value</tooltip>
                <command type="selectValue" selectValueType="multiple" fieldNames="activity_log.hcm_loc_typ_id" selectFieldNames="cb_hcm_loc_typ.hcm_loc_typ_id" visibleFieldNames="cb_hcm_loc_typ.hcm_loc_typ_id,cb_hcm_loc_typ.name"/>
            </action>
        </field>
        <field table="activity_log" name="date_assessed" alias="dateFrom" colspan="2">
            <title translatable="true">Date Assessed From</title>
        </field>
        <field table="activity_log" name="date_assessed" alias="dateTo">
            <title translatable="true">Date Assessed To</title>
        </field>
    </panel>


    <dataSource id="abCbRptAssessLocSiteTree_ds" distinct="true">
        <table name="activity_log" role="main"/>
        <table name="site" role="standard"/>

        <field table="activity_log" name="site_id"/>
        <field table="site" name="name"/>
        <sortField table="activity_log" name="site_id" ascending="true"/>
        <restriction type="sql" sql="activity_log.activity_type = 'ASSESSMENT - HAZMAT' AND activity_log.site_id is not null and activity_log.project_id in (select project_id from project where project_type = 'ASSESSMENT - HAZMAT')  and ${parameters['filterRestriction']}"/>
        <parameter name="filterRestriction" dataType="verbatim" value="1=1"/>
    </dataSource>

    <dataSource id="abCbRptAssessLocBlTree_ds" distinct="true">
        <table name="activity_log" role="main"/>
        <table name="bl" role="standard"/>
        <field table="activity_log" name="site_id" hidden="true"/>
        <field table="activity_log" name="bl_id"/>
        <field table="bl" name="name"/>
        <sortField table="activity_log" name="bl_id" ascending="true"/>
        <restriction type="sql" sql="activity_log.activity_type = 'ASSESSMENT - HAZMAT' AND activity_log.bl_id is not null and activity_log.project_id in (select project_id from project where project_type = 'ASSESSMENT - HAZMAT')  and ${parameters['filterRestriction']}"/>
        <parameter name="filterRestriction" dataType="verbatim" value="1=1"/>
    </dataSource>


    <dataSource id="abCbRptAssessLocFlTree_ds" distinct="true">
        <table name="activity_log" role="main"/>
        <table name="fl" role="standard"/>
        <field table="activity_log" name="site_id" hidden="true"/>
        <field table="activity_log" name="bl_id"/>
        <field table="activity_log" name="fl_id"/>
        <field table="fl" name="name"/>
        <sortField table="activity_log" name="fl_id" ascending="true"/>
        <restriction type="sql" sql="activity_log.activity_type = 'ASSESSMENT - HAZMAT' AND activity_log.fl_id is not null and activity_log.project_id in (select project_id from project where project_type = 'ASSESSMENT - HAZMAT')  and ${parameters['filterRestriction']}"/>
        <parameter name="filterRestriction" dataType="verbatim" value="1=1"/>
    </dataSource>

    <dataSource id="abCbRptAssessLocRmTree_ds" distinct="true">
        <table name="activity_log" role="main"/>
        <table name="rm" role="standard"/>
        <field table="activity_log" name="site_id" hidden="true"/>
        <field table="activity_log" name="bl_id"/>
        <field table="activity_log" name="fl_id"/>
        <field table="activity_log" name="rm_id"/>
        <field table="rm" name="name"/>
        <sortField table="activity_log" name="rm_id" ascending="true"/>
        <restriction type="sql" sql="activity_log.activity_type = 'ASSESSMENT - HAZMAT' AND activity_log.rm_id is not null and activity_log.project_id in (select project_id from project where project_type = 'ASSESSMENT - HAZMAT')  and ${parameters['filterRestriction']}"/>
        <parameter name="filterRestriction" dataType="verbatim" value="1=1"/>
    </dataSource>

    <panel type="tree" id="abCbRptAssessLocSiteTree" dataSource="abCbRptAssessLocSiteTree_ds" layout="centerLayout" region="west">
        <title translatable="true">Assessments by Site, Building, Floor, or Room</title>
        <event type="onClickNode">
            <command type="callFunction" functionName="View.controllers.get('abCbRptAssessLoc').onClickTreeNode()"/>
        </event>
        <panel type="tree" id="abCbRptAssessLocBlTree" dataSource="abCbRptAssessLocBlTree_ds">
            <event type="onClickNode">
                <command type="callFunction" functionName="View.controllers.get('abCbRptAssessLoc').onClickTreeNode()"/>
            </event>
        </panel>
        <panel type="tree" id="abCbRptAssessLocFlTree" dataSource="abCbRptAssessLocFlTree_ds">
            <event type="onClickNode">
                <command type="callFunction" functionName="View.controllers.get('abCbRptAssessLoc').onClickTreeNode()"/>
            </event>
        </panel>
        <panel type="tree" id="abCbRptAssessLocRmTree" dataSource="abCbRptAssessLocRmTree_ds">
            <event type="onClickNode">
                <command type="callFunction" functionName="View.controllers.get('abCbRptAssessLoc').onClickTreeNode()"/>
            </event>
        </panel>
    </panel>

    <tabs id="abCbRptAssessLoc_tabs" workflow="free" tabRefreshPolicy="refreshOnLoad" layout="centerLayout" region="center" cssClass="wizard">
        <tab name="abCbRptAssessLoc_tabAssessments" selected="true">
            <title translatable="true">Hazard Assessments</title>
            <dataSource id="abCbRptAssessLocHazAssess_ds">
                <table name="activity_log" role="main"/>
                <field name="activity_log_id">
                    <title translatable="true">Item ID</title>
                </field>
                <field name="project_id">
                    <title translatable="true">Project</title>
                </field>
                <field name="hcm_is_hazard">
                	<title translatable="true">Contains Hazard?</title>
                </field>
                <field name="hcm_haz_status_id">
                	<title translatable="true">Hazard Status</title>
                </field>
                <field name="prob_type">
                    <title translatable="true">Substance</title>
                </field>
                <field name="date_assessed"/>
                <field name="repair_type">
                    <title translatable="true">Hazard Response</title>
                </field>
                <field name="site_id">
                    <title translatable="true">Site</title>
                </field>
                <field name="bl_id">
                    <title translatable="true">Building</title>
                </field>
                <field name="fl_id">
                    <title translatable="true">Floor</title>
                </field>
                <field name="rm_id">
                    <title translatable="true">Room</title>
                </field>
                <field name="hcm_loc_typ_id">
                	<title translatable="true">Location of Material</title>
                </field>
                <field name="hcm_id"/>
                <field name="hcm_cond_id">
                    <title translatable="true">Material Condition</title>
                </field>
                <field name="hcm_friable"/>
                <field name="hcm_qty">
                    <title translatable="true">Quantity</title>
                </field>
                <field name="cb_units_id">
                    <title translatable="true">Units</title>
                </field>
                <field name="action_title">
                    <title translatable="true">Material Description</title>
                </field>
                <field name="hcm_haz_rank_id">
                    <title translatable="true">Hazard Rank</title>
                </field>
                <field name="hcm_haz_rating_id">
                    <title translatable="true">Hazard Rating</title>
                </field>
                <field name="vf_samples" dataType="number" size="12" decimals="0">
                    <title translatable="true">Samples Count</title>
                    <sql dialect="generic">
                            (SELECT COUNT(a.activity_log_id) FROM cb_samples ${sql.as} a WHERE a.activity_log_id = activity_log.activity_log_id)
                    </sql>
                </field>
                <field name="location">
                    <title translatable="true">Location Detail</title>
                </field>
                <field name="hcm_harea_id"/>
                <field name="rec_action"/>
                <field name="hcm_pending_act"/>
                <field name="assessed_by"/>
                <field name="assigned_to">
                    <title translatable="true">Inspector/ Assigned To</title>
                </field>
                <field name="hcm_abate_by"/>
                <field name="hcm_class1_id">
                    <title translatable="true">Classification I</title>
                </field>
                <field name="hcm_class2_id">
                    <title translatable="true">Classification II</title>
                </field>
                <field name="hcm_class3_id">
                    <title translatable="true">Classification III</title>
                </field>
                <field name="date_required"/>
                <field name="date_review">
                    <title translatable="true">Date Inspected</title>
                </field>
                <field name="date_installed">
                    <title translatable="true">Date Abated</title>
                </field>
                <field name="date_completed"/>
                <field name="date_closed"/>
                <field name="hcm_pipe_cnt">
                    <title translatable="true">Pipes Count</title>
                </field>
                <field name="hcm_fittings_num">
                    <title translatable="true">Fittings Count</title>
                </field>
                <field name="hcm_labeled"/>
                <field name="cause_type">
                    <title translatable="true">Abatement Reason</title>
                </field>
                <field name="assessment_id">
                    <title translatable="true">Initial Item ID</title>
                </field>
                <field name="cost_estimated"/>
                <field name="cost_est_cap"/>
                <field name="cost_actual"/>
                <field name="cost_act_cap"/>
                <restriction type="sql" sql="activity_log.activity_type = 'ASSESSMENT - HAZMAT' AND activity_log.project_id in (select project_id from project where project_type = 'ASSESSMENT - HAZMAT') and ${parameters['filterRestriction']}"/>
                <parameter name="filterRestriction" dataType="verbatim" value="1=1"/>
            </dataSource>
            
            <panel id="abCbRptAssessLocHazAssess" dataSource="abCbRptAssessLocHazAssess_ds" type="grid"  showOnLoad="false">
                <title translatable="true">Hazard Assessments</title>
                <action id="doc">
                    <title translatable="true">DOC</title>
                </action>
                <field id="viewAssessment" controlType="button">
                    <title translatable="true">View</title>
                    <tooltip translatable="true">View Assessment</tooltip>
                    <command type="openDialog" panelId="abCbRptAssessLocHazAssessDialog" applyParentRestriction="true"/>
                </field>
                <field id="viewSamples" controlType="button" onclick="onClickViewSamples">
                    <title translatable="true">Samples</title>
                    <tooltip translatable="true">View Samples</tooltip>
                </field>
                <field id="viewAssessLabResults" controlType="button" onclick="onClickAssessLabResults">
                    <title translatable="true">Lab Results</title>
                    <tooltip translatable="true">View Lab Results</tooltip>
                </field>   
                
        				<sortField table="activity_log" name="date_assessed" ascending="false"/>
        				<sortField table="activity_log" name="hcm_is_hazard" ascending="false"/>
				        <sortField table="activity_log" name="prob_type" ascending="true"/>
				        <sortField table="activity_log" name="project_id" ascending="true"/>
				        <sortField table="activity_log" name="site_id" ascending="true"/>
				        <sortField table="activity_log" name="bl_id" ascending="true"/>
				        <sortField table="activity_log" name="hcm_harea_id" ascending="true"/>
				        <sortField table="activity_log" name="fl_id" ascending="true"/>
				        <sortField table="activity_log" name="rm_id" ascending="true"/>
				        <sortField table="activity_log" name="hcm_loc_typ_id" ascending="true"/>
            </panel>
     
            <dataSource id="abCbRptAssessLocHazAssessDialog_ds">
                <table name="activity_log"/>
                <field name="activity_log_id"/>
                <field name="project_id"/>
                <field name="assessment_id"/>
                <field name="site_id"/>
                <field name="bl_id"/>
                <field name="fl_id"/>
                <field name="rm_id"/>
                <field name="hcm_loc_typ_id"/>
                <field name="hcm_harea_id"/>
                <field name="location"/>
                <field name="doc"/>
                <field name="lat"/>
                <field name="lon"/>
                <field name="doc1"/>
                <field name="doc2"/>
                <field name="hcm_loc_notes"/>
                <field name="date_assessed"/>
                <field name="date_review"/>
                <field name="date_installed"/>
                <field name="date_closed"/>
                <field name="assessed_by"/>
                <field name="cond_priority"/>
                <field name="assigned_to"/>
                <field name="hcm_abate_by"/>
                <field name="inspect_certificate" dataType="text">
                    <title translatable="true">Inspector Certificate #</title>
                    <sql dialect="generic">
                        (SELECT cb_accredit_person.cert_num FROM cb_accredit_person WHERE cb_accredit_person.person_id = activity_log.assigned_to)
                            </sql>
                </field>
                <field name="inspect_certificate_exp" dataType="date">
                    <title translatable="true">Expiration Date</title>
                    <sql dialect="generic">
                        (SELECT cb_accredit_person.date_expire FROM cb_accredit_person WHERE cb_accredit_person.person_id = activity_log.assigned_to)
                            </sql>
                </field>
                <field name="worker_certificate" dataType="text">
                    <title translatable="true">Worker Certificate #</title>
                    <sql dialect="generic">
                        (SELECT cb_accredit_person.cert_num FROM cb_accredit_person WHERE cb_accredit_person.person_id = activity_log.hcm_abate_by)
                            </sql>
                </field>
                <field name="worker_certificate_exp" dataType="date">
                    <title translatable="true">Expiration Date</title>
                    <sql dialect="generic">
                        (SELECT cb_accredit_person.date_expire FROM cb_accredit_person WHERE cb_accredit_person.person_id = activity_log.hcm_abate_by)
                            </sql>
                </field>
                <field name="prob_type"/>
                <field name="hcm_haz_status_id"/>
                <field name="hcm_id"/>
                <field name="hcm_qty"/>
                <field name="action_title"/>
                <field name="cb_units_id"/>
                <field name="hcm_is_hazard"/>
                <field name="hcm_pipe_cnt"/>
                <field name="hcm_friable"/>
                <field name="hcm_fittings_num"/>
                <field name="hcm_haz_rank_id"/>
                <field name="hcm_class1_id"/>
                <field name="hcm_haz_rating_id"/>
                <field name="hcm_class2_id"/>
                <field name="hcm_cond_id"/>
                <field name="hcm_class3_id"/>
                <field name="cond_value"/>
                <field name="hcm_pending_act"/>
                <field name="repair_type"/>
                <field name="rec_action"/>
                <field name="cause_type"/>
                <field name="hcm_labeled"/>
                <field name="doc3"/>
                <field name="doc4"/>
                <field name="description"/>
        
                <field name="date_required"/>
                <field name="date_started"/>
                <field name="date_verified"/>
                <field name="date_completed"/>
                <field name="cost_estimated"/>
                <field name="cost_actual"/>
                <field name="cost_est_cap"/>
                <field name="cost_act_cap"/>
        
                <field name="activity_type"/>
                <field name="activity_log_id"/>
            </dataSource>

            <panel type="form" id="abCbRptAssessLocHazAssessDialog" dataSource="abCbRptAssessLocHazAssessDialog_ds" columns="2" showOnLoad="false" hidden="true">
                <title translatable="true">Assessment Details</title>
        
                <field name="project_id" readOnly="true"/>
                <field name="assessment_id" readOnly="true">
                    <title translatable="true">Initial Assessment ID</title>
                </field>
                <field id="labelLocation" cssClass="label" readOnly="true">
                    <title translatable="true">Location Information</title>
                </field>
                <field cssClass="label" readOnly="true"/>
                <field name="site_id" readOnly="true"/>
                <field name="bl_id" readOnly="true"/>
                <field name="fl_id" readOnly="true"/>
                <field name="rm_id" readOnly="true"/>
                <field name="hcm_loc_typ_id" readOnly="true">
                    <title translatable="true">Location of Material</title>
                </field>
                <field name="hcm_harea_id" readOnly="true"/>
                <field name="location" readOnly="true">
                    <title translatable="true">Location Detail</title>
                </field>
                <field name="doc" readOnly="true">
                    <title translatable="true">Location Drawing</title>
                </field>
                <field name="lat" readOnly="true"/>
                <field name="lon" readOnly="true"/>
                <field name="doc1" readOnly="true">
                    <title translatable="true">Location Photo</title>
                </field>
                <field name="doc2" readOnly="true">
                    <title translatable="true">Location Document</title>
                </field>
                <field name="hcm_loc_notes" colspan="2" readOnly="true"/>
        
                <field id="labelSurvey" readOnly="true">
                    <title translatable="true">Survey Information</title>
                </field>
                <field/>
        
                <field name="date_assessed" readOnly="true"/>
                <field name="date_review" readOnly="true">
                    <title translatable="true">Date Inspected</title>
                </field>
                <field name="date_installed" readOnly="true">
                    <title translatable="true">Date Abated</title>
                </field>
                <field name="date_closed" readOnly="true"/>
                <field name="assessed_by" readOnly="true"/>
                <field name="hcm_pending_act" readOnly="true"/>
                <field name="assigned_to" readOnly="true">
                    <title translatable="true">Inspector/Assigned To</title>
                </field>
                <field name="hcm_abate_by" readOnly="true">
                    <title translatable="true">Abatement Worker</title>
                </field>
                <field name="inspect_certificate" readOnly="true" dataType="text">
                    <title translatable="true">Inspector Certificate #</title>
                </field>
                <field name="inspect_certificate_exp" readOnly="true" dataType="date">
                    <title translatable="true">Expiration Date</title>
                </field>
                <field name="worker_certificate" readOnly="true" dataType="text">
                    <title translatable="true">Worker Certificate #</title>
                </field>
                <field name="worker_certificate_exp" readOnly="true" dataType="date">
                    <title translatable="true">Expiration Date</title>
                </field>
        
                <field id="labelHazard" readOnly="true">
                    <title translatable="true">Hazard Information</title>
                </field>
                <field/>
        
                <field name="prob_type" readOnly="true">
                    <title translatable="true">Substance</title>
                </field>
                <field name="hcm_haz_status_id" readOnly="true">
                    <title translatable="true">Hazard Status</title>
                </field>
                <field name="hcm_id" readOnly="true"/>
                <field name="hcm_qty" readOnly="true">
                    <title translatable="true">Quantity</title>
                </field>
                <field name="action_title" readOnly="true">
                    <title translatable="true">Material Description</title>
                </field>
                <field name="cb_units_id" readOnly="true">
                    <title translatable="true">Units</title>
                </field>
                <field name="hcm_is_hazard" readOnly="true"/>
                <field name="hcm_pipe_cnt" readOnly="true"/>
                <field name="hcm_friable" readOnly="true">
                    <title translatable="true">Friability</title>
                </field>
                <field name="hcm_fittings_num" readOnly="true"/>
                <field name="hcm_cond_id" readOnly="true">
                    <title translatable="true">Material Condition</title>
                </field>
                <field name="hcm_class1_id" readOnly="true">
                    <title translatable="true">Classification I</title>
                </field>
                <field name="hcm_haz_rating_id" readOnly="true">
                    <title translatable="true">Hazard Rating</title>
                </field>
                <field name="hcm_class2_id" readOnly="true">
                    <title translatable="true">Classification II</title>
                </field>
                <field name="hcm_haz_rank_id" readOnly="true">
                    <title translatable="true">Hazard Rank</title>
                </field>
                <field name="hcm_class3_id" readOnly="true">
                    <title translatable="true">Classification III</title>
                </field>
                <field name="cond_value" readOnly="true">
                    <title translatable="true">Condition Value (Scoreboard)</title>
                </field>
                 <field name="cond_priority" readOnly="true">
                    <title translatable="true">Condition Priority (Scoreboard)</title>
                </field>
                <field name="repair_type" readOnly="true">
                    <title translatable="true">Hazard Response</title>
                </field>
                <field name="rec_action" readOnly="true"/>
                <field name="cause_type" readOnly="true">
                    <title translatable="true">Abatement Reason</title>
                </field>
                <field name="hcm_labeled" readOnly="true"/>
                <field name="doc3" readOnly="true">
                    <title translatable="true">Material Photo</title>
                </field>
                <field name="doc4" readOnly="true">
                    <title translatable="true">Material Document</title>
                </field>
                <field name="description" colspan="2" readOnly="true">
                    <title translatable="true">Material Notes</title>
                </field>
        
                <field id="labelDates" readOnly="true">
                    <title translatable="true">Dates and Costs</title>
                </field>
                <field/>
        
                <field name="date_required" readOnly="true"/>
                <field name="date_started" readOnly="true"/>
                <field name="date_verified" readOnly="true"/>
                <field name="date_completed" readOnly="true"/>
                <field name="cost_estimated" readOnly="true"/>
                <field name="cost_actual" readOnly="true"/>
                <field name="cost_est_cap" readOnly="true"/>
                <field name="cost_act_cap" readOnly="true"/>
                <field name="activity_log_id" hidden="true"/>
            </panel>
        </tab>

        <tab name="abCbRptAssessLocSamples_tabSamples">
        <title translatable="true">Hazard Samples</title>
            <dataSource id="abCbRptAssessLocSamples_ds">
                <table name="cb_samples" role="main"/>
                <table name="activity_log" role="standard"/>
    
                 <field name="activity_log_id" table="activity_log" hidden="true"/>
                 <field name="sample_id" table="cb_samples" hidden="true"/>
    
                 <field name="vf_lab_results" dataType="number" size="12" decimals="0">
                    <title translatable="true"># Lab Results</title>
                    <sql dialect="generic">
                            (SELECT COUNT(a.sample_id) FROM cb_sample_result ${sql.as} a WHERE a.sample_id = cb_samples.sample_id)
                    </sql>
                 </field>
                 <field name="date_collected"/>
                 <field name="analysis_requested"/>
                 <field name="requested_by"/>
                 <field name="sample_code"/>
                 <field name="sample_desc"/>
                 <field name="sample_loc"/>
                 <field name="lab_id"/>
                 <field name="lab_log_num"/>
                 <field name="date_received"/>
                 <field name="date_analysis"/>
                 <field name="analyst_name"/>
                 <field name="sample_prefix_num"/>
                 <field name="sample_archive"/>
    
                 <restriction type="parsed">
                 	<clause table="activity_log" name="activity_type" op="=" value="ASSESSMENT - HAZMAT"/>
                 </restriction>
            </dataSource>

            <panel type="grid" id="abCbRptAssessLocSamples" dataSource="abCbRptAssessLocSamples_ds" showOnLoad="false">
                <title translatable="true">Hazard Samples</title>
                <field id="viewHazSamples" controlType="button">
                    <title translatable="true">View</title>
                    <tooltip translatable="true">View Sample</tooltip>
                    <command type="openDialog" panelId="abCbRptAssessLocSamplesDialog" applyParentRestriction="true"/>
                </field>
                <field id="viewHazSampleLabResults" controlType="button" onclick="onClickSampleLabResults">
                    <title translatable="true">Lab Results</title>
                    <tooltip translatable="true">View Lab Results</tooltip>
                </field>

                <sortField name="date_collected" ascending="false"/>
            </panel>
    
            <panel type="form" id="abCbRptAssessLocSamplesDialog" dataSource="abCbRptAssessLocSamples_ds" showOnLoad="false"  hidden="true" columns="2">
                <title translatable="true">Material Sample</title>
                <field name="analysis_requested" readOnly="true"/>
                <field name="requested_by" readOnly="true"/>
                <field name="date_collected" readOnly="true" required="false"/>
                <field name="sample_code" readOnly="true" required="false"/>
                <field name="sample_desc" readOnly="true"/>
                <field name="sample_doc" readOnly="true"/>
                <field name="lab_id" readOnly="true"/>
                <field name="lab_log_num" readOnly="true"/>
                <field name="date_received" readOnly="true"/>
                <field name="date_analysis" readOnly="true"/>
                <field name="analyst_name" readOnly="true"/>
                <field name="sample_prefix_num" readOnly="true"/>
                <field name="sample_loc" readOnly="true"/>
                <field name="sample_loc_code" readOnly="true"/>
                <field name="sample_archive" readOnly="true"/>
                <field name="sample_type" readOnly="true"/>
            </panel>
        </tab>

        <tab name="abCbRptAssessLocSamplesResultList_tab">
            <title translatable="true">Sample Lab Results</title>
            <dataSource id="abCbRptAssessLocSamplesResult_ds">
                <table name="cb_sample_result" role="main"/>
                <table name="cb_samples" role="standard"/>
                <table name="cb_sample_comp" role="standard"/>

                <field name="sample_code" table="cb_samples"/>
                <field name="sample_prefix_num" table="cb_samples"/>
                <field name="sample_comp_id"/>
                <field name="is_hazard" table="cb_sample_comp"/>
                <field name="qualifier"/>
                <field name="result_1"/>
                <field name="cb_units_id"/>
                <field name="result_2"/>     
                <field name="cas_num" table="cb_sample_comp"/>
                                
                <field name="result_id" hidden="true"/>

                <restriction type="sql"
                        sql="EXISTS (SELECT activity_log_id FROM activity_log
                                    WHERE activity_log.activity_log_id = cb_samples.activity_log_id
                                        AND activity_log.activity_type = 'ASSESSMENT - HAZMAT' 
                                        AND ${parameters['consoleRestriction']})"/>
                <parameter name="consoleRestriction" dataType="verbatim" value="1=1"/>
            </dataSource>
    
            <panel type="grid" id="abCbRptAssessLocSamplesResultList" dataSource="abCbRptAssessLocSamplesResult_ds" layout="centerLayout" region="center" showOnLoad="false">
                <title translatable="true">Sample Lab Results</title>
                <field id="viewSampleResult" controlType="button">
                    <title translatable="true">View</title>
                    <tooltip translatable="true">View Lab Result</tooltip>
                    <command type="openDialog" panelId="abCbRptAssessLocSamplesResultDialog" applyParentRestriction="true"/>
                </field>
        
                <sortField name="sample_code" table="cb_samples"/>
                <sortField name="sample_comp_id"/>
            </panel>
    
            <panel type="form" id="abCbRptAssessLocSamplesResultDialog" dataSource="abCbRptAssessLocSamplesResult_ds" columns="2" showOnLoad="false" hidden="true">
                <title translatable="true">Material Sample Lab Result</title>
                <field name="sample_comp_id" readOnly="true" required="false"/>
                <field name="result_1" readOnly="true" required="false"/>
                <field name="result_2" readOnly="true"/>
                <field name="cb_units_id" readOnly="true" required="false"/>
                <field name="qualifier" readOnly="true"/>
                <field/>
            </panel>
        </tab>

        <tab name="abCbRptAssessLoc_tabResultsSum">
            <title translatable="true">Results Summary</title>

            <dataSource id="abCbRptAssessLoc_dsResultsSum" type="grouping">
                <table name="cb_sample_result" role="main"/>
                <table name="cb_samples" role="standard"/>

                <field name="vf_sample_info" dataType="text" baseField="cb_samples.sample_code" groupBy="true">
                    <title translatable="true">Sample Code / Prefix / Lab Log / Date</title>
                    <sql dialect="generic">
                        RTRIM(cb_samples.sample_code)
                        ${sql.concat} ' / ' ${sql.concat} ${sql.isNull('RTRIM(cb_samples.sample_prefix_num)', '\'\'')}
                        ${sql.concat} ' / ' ${sql.concat} ${sql.isNull('RTRIM(cb_samples.lab_log_num)', '\'\'')}
                        ${sql.concat} ' / ' ${sql.concat} ${sql.yearMonthDayOf('cb_samples.date_collected')}
                    </sql>
                </field>
                <field name="sample_comp_id" groupBy="true"/>
                <field name="vf_result" baseField="cb_sample_result.result_1" dataType="text" showTotals="false">
                    <title translatable="true">Result</title>
                    <sql dialect="generic">
                        MAX(CASE WHEN result_2 IS NULL
                            THEN qualifier ${sql.concat} ' ' ${sql.concat} CAST(CAST(result_1 AS NUMERIC(20,1)) AS VARCHAR(30)) ${sql.concat} RTRIM(cb_units_id)
                            ELSE CAST(CAST(result_1 AS NUMERIC(20,1)) AS VARCHAR(30)) ${sql.concat} RTRIM(cb_units_id)
                                ${sql.concat} ' - '
                                ${sql.concat} CAST(CAST(result_2 AS NUMERIC(20,1)) AS VARCHAR(30)) ${sql.concat} RTRIM(cb_units_id)
                            END)
                    </sql>
                </field>

                <restriction type="sql"
                        sql="EXISTS (SELECT activity_log_id FROM activity_log
                                    WHERE activity_log.activity_log_id = cb_samples.activity_log_id
                                        AND activity_log.activity_type = 'ASSESSMENT - HAZMAT' 
                                        AND ${parameters['consoleRestriction']})"/>
                <parameter name="consoleRestriction" dataType="verbatim" value="1=1"/>

                <sortField name="vf_sample_info" ascending="true"/>
                <sortField name="sample_comp_id" ascending="true"/>
            </dataSource>

            <panel type="crossTable" id="abCbRptAssessLoc_panelResultsSum" dataSource="abCbRptAssessLoc_dsResultsSum" showOnLoad="false">
                <title translatable="true">Results Summary</title>
                
                <action id="exportXLS">
                    <title translatable="true">XLS</title>
                    <command type="exportPanel" outputType="xls" panelId="abCbRptAssessLoc_panelResultsSum"/>
                </action>
            </panel>
        </tab>    
    </tabs>
</view>
